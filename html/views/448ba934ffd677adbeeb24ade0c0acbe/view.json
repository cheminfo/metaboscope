{"version":"2.136.0","grid":{"layers":{"Default layer":{"name":"Default layer"},"OPLS":{"name":"OPLS"},"OPLS Admin":{"name":"OPLS Admin"},"OPLS PC":{"name":"OPLS PC"},"Preferences":{"name":"Preferences"},"Ellipse":{"name":"Ellipse"},"Debug":{"name":"Debug"},"Save Load Preferences":{"name":"Save Load Preferences"},"Load and Process":{"name":"Load and Process"},"OPLS Offline":{"name":"OPLS Offline"},"OPLS Offline Admin":{"name":"OPLS Offline Admin"},"SelectCategory":{"name":"SelectCategory"}},"xWidth":10,"yHeight":10},"modules":[{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/db85d9cc12c6204e4a3afb69bba6d695f6f8bad5/src/modules/types/edition/slick_grid/view.js#L918-L940"],"customJpaths":["jcamp.dUrl,pdf.dUrl,file.dUrl,jcamp.data,experiment,instrument"]}],"cols":[[{"name":"Filename","jpath":[],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"twig:'{{text.filename|split(\"/\",3)[2]}}{{jcamp.filename|split(\"/\",3)[2]}}{{file.filename|split(\"/\",3)[2]}}{{filename|split(\"/\",3)[2]}}{{txt.filename|split(\"/\",3)[2]}}'","editorOptions":"","width":91,"hideColumn":[]},{"name":"Experiment","jpath":["info"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","hideColumn":[]}]],"actionCols":[[{"name":"Add","tooltip":"Add spectrum","icon":"fa-plus","backgroundColor":[255,255,255,1],"color":[0,0,0,1],"action":"addSpectrum","position":"end","clickMode":"background","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":54},"size":{"width":27,"height":23},"zIndex":0,"display":true,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":56},"size":{"width":27,"height":23},"zIndex":0,"display":true,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":0,"top":56},"size":{"width":36,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":0,"top":56},"size":{"width":36,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":56},"size":{"width":27,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":39},"size":{"width":28,"height":42},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Debug":{"position":{"left":0,"top":56},"size":{"width":36,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":0,"top":56},"size":{"width":27,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":39},"size":{"width":28,"height":42},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":0,"top":56},"size":{"width":27,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":0,"top":56},"size":{"width":27,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":0,"top":54},"size":{"width":27,"height":23},"zIndex":0,"display":false,"title":"Available spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":1,"vars_in":[{"rel":"list","name":"spectra"}],"actions_in":[{"rel":"unsetActiveRow","name":"unsetSelectedSpectrum"}],"title":"Available spectra","vars_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"oneSpectrum"}],"actions_out":[{"jpath":[]}],"zindex":6,"toolbar":{"custom":[[{"title":"Unselect","icon":"fa-eraser","action":"addSpectrum","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}]},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["{% if legend2d.nucleus %}\n  Nucleus: {{ legend2d.nucleus }} <br>\n{% endif %}\n{% if legend2d.red %}\n  <span style=\"color: red\">———</span> {{ legend2d.red }} <br>\n{% endif %}\n{% if legend2d.green %}\n  <span style=\"color: lightgreen\">———</span> {{ legend2d.green }} <br>\n{% endif %}\n{% if legend2d.blue %}\n  <span style=\"color: blue\">———</span> {{ legend2d.blue }}\n{% endif %}"]}]}},"layers":{"Default layer":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Debug":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":119,"top":75},"size":{"width":72,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":2,"vars_in":[{"rel":"value","name":"legend2d"}],"actions_in":[{}],"title":"","vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin"}]],"common":[{"toolbar":[["Open Preferences"]]}]},"zindex":3},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["xy"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":["none"],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[["track"]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[["yes"]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip","main","sec"]],"label":["Wavelength [cm-1]"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display","main","sec"]],"label":["Absorbance"],"beforeSpacing":["0.05"],"afterSpacing":["0.05"],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"chart","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]},{"variable":"correlationChart","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":28,"top":33},"size":{"width":80,"height":44},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":28,"top":48},"size":{"width":69,"height":31},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":61,"top":48},"size":{"width":47,"height":29},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":0,"top":46},"size":{"width":53,"height":35},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":28,"top":30},"size":{"width":69,"height":49},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":116,"top":54},"size":{"width":44,"height":34},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Debug":{"position":{"left":61,"top":48},"size":{"width":47,"height":29},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":28,"top":48},"size":{"width":69,"height":31},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":107,"top":39},"size":{"width":31,"height":42},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":28,"top":48},"size":{"width":77,"height":37},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":6,"top":0},"size":{"width":69,"height":31},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":28,"top":33},"size":{"width":80,"height":44},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":3,"vars_in":[{"rel":"chart","name":"chart"},{"rel":"annotations","name":"filterAnnotations"},{"rel":"chart","name":"boxPlotChart"},{"rel":"annotations","name":"trackAnnotations"},{"rel":"chart","name":"correlationChart"},{"rel":"annotations","name":"correlationAnnotations"}],"actions_in":[{"rel":"_editPreferences","name":"setChartPreferences"}],"actions_out":[{"event":"onZoomChange","rel":"fromToX","jpath":[],"name":"zoomX"},{"event":"onTrackMouse","rel":"dataAndEvent","jpath":[],"name":"trackMove"},{"event":"onTrackClick","rel":"dataAndEvent","jpath":[],"name":"trackClicked"}],"vars_out":[{"event":"onTrackClick","rel":"trackData","jpath":[],"name":"clickedPoint"}],"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"zindex":2,"css":[{"fontSize":[""],"fontFamily":[""]}]},{"url":"modules/types/client_interaction/button_action/","configuration":{"sections":{},"groups":{"group":[{"toggle":["click"],"label":["Hide options"],"onLabel":["Toggle action off"],"offLabel":["Toggle action on"],"onColor":[[0,0,0,1]],"offColor":[[0,0,0,1]],"startState":["off"],"text":["Default layer"],"askConfirm":[[]],"confirmText":["Are you sure?"],"okLabel":["Ok"],"cancelLabel":["Cancel"],"content":[""],"contentType":["content"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":4,"vars_in":[],"actions_in":[{}],"title":"","vars_out":[],"actions_out":[{"event":"onClick","rel":"actionText","jpath":[],"name":"switchLayer"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin"}]],"common":[{"toolbar":[["Open Preferences"]]}]},"zindex":4},{"url":"modules/types/client_interaction/button_action/","configuration":{"sections":{},"groups":{"group":[{"toggle":["click"],"label":["Back to main"],"onLabel":["Toggle action off"],"offLabel":["Toggle action on"],"onColor":[[0,0,0,1]],"offColor":[[0,0,0,1]],"startState":["off"],"text":["Default layer"],"askConfirm":[[]],"confirmText":["Are you sure?"],"okLabel":["Ok"],"cancelLabel":["Cancel"],"content":[""],"contentType":["content"]}]}},"layers":{"Default layer":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Debug":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":113,"top":16},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":5,"vars_in":[],"actions_in":[{}],"title":"","vars_out":[],"actions_out":[{"event":"onClick","rel":"actionText","jpath":[],"name":"switchLayer"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin"}]],"common":[{"toolbar":[["Open Preferences"]]}]},"zindex":4},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","editable","filterColumns"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[["select"]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/db85d9cc12c6204e4a3afb69bba6d695f6f8bad5/src/modules/types/edition/slick_grid/view.js#L918-L940"],"customJpaths":[""]}],"cols":[[{"name":"Reference","jpath":["value","reference"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":157,"hideColumn":[]},{"name":"Nb spectra","jpath":["value","nbSpectra"],"editor":"none","forceType":"number","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":73,"hideColumn":[]}]],"actionCols":[[{"name":"add","tooltip":"Add all spectra for this sample","icon":"fa-plus","backgroundColor":[255,255,255,1],"color":[0,0,0,1],"action":"addSample","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":17},"size":{"width":27,"height":36},"zIndex":0,"display":true,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":13},"size":{"width":27,"height":42},"zIndex":0,"display":true,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":0,"top":12},"size":{"width":36,"height":43},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":0,"top":12},"size":{"width":36,"height":43},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":13},"size":{"width":27,"height":42},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":28,"height":38},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Debug":{"position":{"left":0,"top":12},"size":{"width":36,"height":43},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":0,"top":13},"size":{"width":27,"height":41},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":28,"height":38},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":0,"top":13},"size":{"width":27,"height":41},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":0,"top":13},"size":{"width":27,"height":41},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":0,"top":17},"size":{"width":27,"height":36},"zIndex":0,"display":false,"title":"List of selected samples","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":6,"vars_in":[{"rel":"list","name":"sampleTocFiltered"}],"actions_in":[{}],"title":"List of selected samples","vars_out":[{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"tocSelected"},{"event":"onRowActive","rel":"row","jpath":[],"name":"tocClicked"},{"event":"onHover","rel":"row","jpath":[],"name":"tocHovered"}],"actions_out":[{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"clickedSample"}],"toolbar":{"custom":[[{"title":"Refresh","icon":"fa-sync","action":"refresh","position":"begin","color":[100,100,100,1]},{"title":"Add selected","icon":"fa-plus","action":"addSelectedSamples","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"zindex":4,"css":[{"fontSize":[""],"fontFamily":[""]}]},{"url":"modules/types/array_search/smart_array_filter/","configuration":{"sections":{},"groups":{"group":[{"debounce":[100],"limit":[0],"initialValue":[""],"placeholder":["Enter filter"],"fontSize":[20]}]}},"layers":{"Default layer":{"position":{"left":0,"top":10},"size":{"width":27,"height":6},"zIndex":0,"display":true,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":6},"size":{"width":27,"height":6},"zIndex":0,"display":true,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":0,"top":4},"size":{"width":36,"height":7},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":0,"top":4},"size":{"width":36,"height":7},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":6},"size":{"width":27,"height":6},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":29,"height":7},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Debug":{"position":{"left":0,"top":4},"size":{"width":36,"height":7},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":0,"top":6},"size":{"width":27,"height":6},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":29,"height":7},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":0,"top":6},"size":{"width":27,"height":6},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":0,"top":6},"size":{"width":27,"height":6},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":0,"top":10},"size":{"width":27,"height":6},"zIndex":0,"display":false,"title":"Search specific entry","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":7,"vars_in":[{"rel":"input","name":"sampleToc"}],"actions_in":[{}],"title":"Search specific entry","vars_out":[{"event":"onQuery","rel":"output","jpath":[],"name":"sampleTocFiltered"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"zindex":2},{"url":"modules/types/edition/onde/","configuration":{"sections":{},"groups":{"group":[{"hasButton":[[]],"button_text":["Export"],"debouncing":[0],"output":["modified"],"mode":["schema"],"schemaSource":["variable"],"schema":["{}"],"onchangeFilter":[null]}],"data":[{"saveInView":[[]],"varname":[""],"data":["{}"]}]}},"layers":{"Default layer":{"position":{"left":6,"top":0},"size":{"width":21,"height":6},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":6,"top":1},"size":{"width":21,"height":6},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":7,"top":0},"size":{"width":21,"height":8},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":7,"top":0},"size":{"width":21,"height":8},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":6,"top":1},"size":{"width":21,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":8},"size":{"width":19,"height":8},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Debug":{"position":{"left":7,"top":0},"size":{"width":21,"height":8},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":6,"top":1},"size":{"width":21,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":8},"size":{"width":19,"height":8},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":6,"top":1},"size":{"width":21,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":6,"top":1},"size":{"width":21,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":6,"top":0},"size":{"width":21,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":8,"vars_in":[{"rel":"schema","name":"groupFormSchema"},{"rel":"inputValue","name":"groupForm"}],"actions_in":[{}],"title":"","actions_out":[{"jpath":[]}],"vars_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"zindex":2},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":109,"top":0},"size":{"width":53,"height":32},"zIndex":0,"display":true,"title":"","bgColor":[255,242,204,1],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":139,"top":6},"size":{"width":36,"height":73},"zIndex":0,"display":true,"title":"","bgColor":[255,242,204,1],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":107,"top":0},"size":{"width":43,"height":79},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":139,"top":23},"size":{"width":36,"height":58},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":98,"top":0},"size":{"width":43,"height":79},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":107,"top":0},"size":{"width":43,"height":79},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":139,"top":35},"size":{"width":36,"height":44},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":106,"top":6},"size":{"width":44,"height":27},"zIndex":0,"display":true,"title":"","bgColor":[255,242,204,1],"wrapper":false,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":42,"top":33},"size":{"width":30,"height":31},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":109,"top":0},"size":{"width":53,"height":32},"zIndex":0,"display":false,"title":"","bgColor":[255,242,204,1],"wrapper":false,"created":true,"name":"Default layer"}},"id":9,"vars_in":[{"rel":"tpl","name":"twigTemplate"},{"rel":"value","name":"tocHovered"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["console.log(this.action);\nconst roc=API.cache('roc');\n\nconst spectraDataSet=API.cache('spectraDataSet');\n\nswitch (this.action.name) {\n    case 'oplsaddSpectraToSelection': {\n        let scatterSelected=API.getData('scatterSelected').map( entry => String(entry.id));\n        let spectraInDataset=API.getData('spectraInDataset').filter( entry => scatterSelected.includes(String(entry.id)));\n        API.createData('currentlySelectedSpectra', spectraInDataset);\n        window.setTimeout( () => {\n            API.doAction('addSpectraToSelection');\n        });\n        break;\n    }\n    case 'oplsselectCurrentSpectraSelection': {\n        let scatterSelected=API.getData('scatterSelected').map( entry => String(entry.id));\n        let spectraInDataset=API.getData('spectraInDataset').filter( entry => scatterSelected.includes(String(entry.id)));\n        API.createData('currentlySelectedSpectra', spectraInDataset);\n        window.setTimeout( () => {\n            API.doAction('selectCurrentSpectraSelection');\n        });\n        break;\n    }\n    case 'oplsHideSpectra': {\n        let scatterSelected=API.getData('scatterSelected').map( entry => String(entry.id));\n        let spectraInDataset=API.getData('spectraInDataset').filter( entry => scatterSelected.includes(String(entry.id)));\n        API.createData('currentlySelectedSpectra', spectraInDataset);\n        window.setTimeout( () => {\n            API.doAction('hideSpectra');\n        });\n        break;\n    }\n    case 'clickedOPLSShape':\n        if (this.action.value.event.altKey) {\n            let spectraInDataset = API.getData('spectraInDataset');\n            let entry=spectraInDataset.filter(entry => String(entry.id) === String(this.action.value.data.info.id))[0];\n            entry.selected = DataObject.resurrect(entry.selected) ? false : true;\n            spectraInDataset.triggerChange();\n        }\n        break;\n    case 'deleteOPLSSelection': {\n\n            let spectraInDataset = API.getData('spectraInDataset');\n            let scatterSelected=API.getData('scatterSelected');\n\n            for (let selected of scatterSelected) {\n                for (let i=0; i<spectraInDataset.length; i++) {\n                    let spectrum=spectraInDataset[i];\n                    if (String(selected.id)===String(spectrum.id)) {\n                        spectraInDataset.splice(i,1);\n                        break;\n                    }\n                }\n            }\n            spectraInDataset.triggerChange();\n        }\n        break;\n    default:\n        await spectraDataSet.processAction(this.action);\n}\n\n"]}],"libs":[[{"lib":"vh/eln/Sample","alias":"Sample"},{"lib":"src/util/color","alias":"Color"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":141,"top":51},"size":{"width":52,"height":39},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":29,"top":39},"size":{"width":86,"height":42},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":0,"top":39},"size":{"width":69,"height":40},"zIndex":0,"display":true,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":141,"top":51},"size":{"width":52,"height":39},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":141,"top":51},"size":{"width":52,"height":39},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":10,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"clickedSample"},{"rel":"execute","name":"addSelectedSamples"},{"rel":"execute","name":"addSample"},{"rel":"execute","name":"addSpectrum"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"clearSelectedSamples"},{"rel":"execute","name":"clickedOPLSShape"},{"rel":"execute","name":"deleteOPLSSelection"},{"rel":"execute","name":"addSpectraToSelection"},{"rel":"execute","name":"selectAllSpectra"},{"rel":"execute","name":"hideAllSpectra"},{"rel":"execute","name":"hideSpectra"},{"rel":"execute","name":"selectCurrentSpectraSelection"},{"rel":"execute","name":"forceRecolor"},{"rel":"execute","name":"oplsaddSpectraToSelection"},{"rel":"execute","name":"oplsselectCurrentSpectraSelection"},{"rel":"execute","name":"oplsHideSpectra"},{"rel":"execute","name":"selectCategory"},{"rel":"execute","name":"resetMinMax"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Deal with actions","zindex":2},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[["remove"]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/db85d9cc12c6204e4a3afb69bba6d695f6f8bad5/src/modules/types/edition/slick_grid/view.js#L918-L940"],"customJpaths":["jcamp.dUrl,pdf.dUrl,file.dUrl,jcamp.data,experiment,instrument"]}],"cols":[[{"name":"Identifier","jpath":["id"],"editor":"string","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":254,"hideColumn":[]},{"name":"Category","jpath":["category"],"editor":"string","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":140,"hideColumn":[]},{"name":"Experiment","jpath":["experiment"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":240,"hideColumn":[]},{"name":"☑️","jpath":["selected"],"editor":"boolean","forceType":"boolean","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":40,"minWidth":"40","maxWidth":"40","hideColumn":[]},{"name":"OPLS","jpath":["oplsModel"],"editor":"none","forceType":"boolean","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":40,"minWidth":"40","maxWidth":"40","hideColumn":[]},{"name":"Color","jpath":["color"],"editor":"color","forceType":"color","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":39,"minWidth":"40","maxWidth":"40","hideColumn":[]}]],"actionCols":[[{"backgroundColor":[255,255,255,0],"color":[0,0,0,1],"position":"end","clickMode":"text"}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":28,"top":8},"size":{"width":80,"height":24},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":98,"top":48},"size":{"width":40,"height":31},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Admin":{"position":{"left":37,"top":0},"size":{"width":69,"height":23},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS PC":{"position":{"left":98,"top":0},"size":{"width":40,"height":81},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":28,"top":6},"size":{"width":69,"height":23},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":116,"top":0},"size":{"width":56,"height":25},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Debug":{"position":{"left":37,"top":0},"size":{"width":69,"height":23},"zIndex":0,"display":false,"title":"Selected spectra","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Save Load Preferences":{"position":{"left":98,"top":6},"size":{"width":40,"height":41},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Load and Process":{"position":{"left":139,"top":0},"size":{"width":29,"height":38},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline":{"position":{"left":106,"top":48},"size":{"width":44,"height":37},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS Offline Admin":{"position":{"left":1,"top":33},"size":{"width":40,"height":31},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"SelectCategory":{"position":{"left":11,"top":4},"size":{"width":66,"height":35},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":11,"vars_in":[{"rel":"list","name":"spectraInDataset"}],"actions_in":[{}],"title":"List of spectra in dataset","vars_out":[{"event":"onHover","rel":"row","jpath":["toc"],"name":"tocHovered"},{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"currentlySelectedSpectra"}],"actions_out":[{"event":"onHover","rel":"row","jpath":[],"name":"hoverRow"}],"zindex":6,"toolbar":{"custom":[[{"title":"Remove all spectra from dataset","icon":"fa-eraser","action":"clearSelectedSamples","position":"begin","color":[100,100,100,1]},{"title":"Select category","icon":"fa-dot-circle","action":"selectCategory","position":"begin","color":[100,100,100,1]},{"title":"Download normalized matrix","icon":"fa-download","action":"downloadNormalizedMatrix","position":"begin","color":[100,100,100,1]},{"title":"Recolor spectra based on category","icon":"fa-palette","action":"forceRecolor","position":"begin","color":[103,78,167,1]},{"title":"Select all spectra","icon":"fa-eye","action":"selectAllSpectra","position":"begin","color":[56,118,29,1]},{"title":"Append to selected spectra","icon":"fa-plus","action":"addSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Select only current spectra","icon":"fa-bullseye","action":"selectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Remove spectra from current selection","icon":"fa-minus","action":"hideSpectra","position":"begin","color":[153,0,0,1]},{"title":"Unselect all spectra","icon":"fa-eye-slash","action":"hideAllSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}]},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let OPLS = ML.OPLS;\nconst Matrix = ML.Matrix;\nlet spectraInDataset=API.getData('spectraInDataset');\nAPI.cache('spectraProcessor')\n\nspectraInDataset.forEach( (spectrum) => spectrum.oplsModel=false);\n\nconst ids = spectraInDataset.filter( spectrum => DataObject.resurrect(spectrum.selected))\n    .map(spectrum => {\n        spectrum.oplsModel=true;\n        return String(spectrum.id);\n    });\n\nconst normalized = spectraProcessor.getNormalizedData({ids});\nconst classes = spectraProcessor.getClasses({ids})\n\nconsole.log('Calculate OPLS');\n\nlet data=normalized.matrix;\nlet preferences=API.getData('preferences').resurrect();\n\nlet opls;\n\nconst numberOfComponents = 4;\ntry {\n    opls = new OPLS(new Matrix(data), classes, { nComp: numberOfComponents });;\n} catch (error) {\n    UI.showNotification(error, 'error');\n    return;\n}\n\nconsole.timeEnd('OPLS '+data.length+'x'+data[0].length);\nAPI.cache('opls', opls);\n\nspectraInDataset.triggerChange();\n"]}],"libs":[[{"lib":"ML","alias":"ML"},{"lib":"chroma","alias":"Chroma"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Calculate / Recalculate OPLS","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":148,"top":14},"size":{"width":27,"height":15},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":72,"top":0},"size":{"width":25,"height":5},"zIndex":0,"display":true,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":57,"top":0},"size":{"width":71,"height":36},"zIndex":0,"display":true,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":114,"top":0},"size":{"width":61,"height":82},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":148,"top":14},"size":{"width":27,"height":15},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":16,"top":44},"size":{"width":61,"height":20},"zIndex":0,"display":true,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":105,"top":0},"size":{"width":59,"height":36},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":82,"top":0},"size":{"width":18,"height":5},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":74,"top":0},"size":{"width":23,"height":5},"zIndex":0,"display":true,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":82,"top":0},"size":{"width":18,"height":5},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":148,"top":14},"size":{"width":27,"height":15},"zIndex":0,"display":false,"title":"Calculate the OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":12,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"calculateOPLS"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Calculate the OPLS","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["xy"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[["yes"]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"opls","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"0.0000001","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":["markers"],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":true,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":56,"height":36},"zIndex":0,"display":true,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":0,"top":6},"size":{"width":53,"height":39},"zIndex":0,"display":false,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":77,"height":43},"zIndex":0,"display":true,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":110,"top":5},"size":{"width":42,"height":46},"zIndex":0,"display":true,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":false,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":139,"top":39},"size":{"width":34,"height":42},"zIndex":0,"display":true,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":false,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":false,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":13,"vars_in":[{"rel":"chart","name":"opls"},{"rel":"annotations","name":"oplsAnnotations"},{"rel":"annotations","name":"ellipsis"}],"actions_in":[{}],"vars_out":[{"event":"onMouseOverShape","rel":"shapeInfos","jpath":["info","toc"],"name":"tocHovered"},{"event":"onSelectScatter","rel":"selectedData","jpath":[],"name":"scatterSelected"},{"event":"onClickMarker","rel":"markerInfos","jpath":[],"name":"markerData"}],"actions_out":[{"event":"onShapeClick","rel":"dataAndEvent","jpath":[],"name":"clickedOPLSShape"}],"toolbar":{"custom":[[{"title":"Load OPLS model","icon":"fa-tasks","action":"selectResultTemplate","position":"begin","color":[100,100,100,1]},{"title":"Save OPLS model","icon":"fa-save","action":"saveResultTemplate","position":"begin","color":[100,100,100,1]},{"title":"Remove selected spectra","icon":"fa-trash","action":"deleteOPLSSelection","position":"begin","color":[100,100,100,1]},{"title":"Select all spectra","icon":"fa-eye","action":"selectAllSpectra","position":"begin","color":[56,118,29,1]},{"title":"Show spectra","icon":"fa-plus","action":"oplsaddSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Only show selected spectra","icon":"fa-bullseye","action":"oplsselectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Unselect spectra","icon":"fa-minus","action":"oplsHideSpectra","position":"begin","color":[153,0,0,1]},{"title":"Unselect all spectra","icon":"fa-eye-slash","action":"hideAllSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Principal component analysis. Filled if part of OPLS model. Large if selected.","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pc1","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":70,"top":0},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Reconstructed Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":61,"top":0},"size":{"width":43,"height":23},"zIndex":0,"display":false,"title":"Reconstructed Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":103,"top":0},"size":{"width":33,"height":22},"zIndex":0,"display":true,"title":"Reconstructed Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":61,"top":0},"size":{"width":43,"height":23},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":70,"top":0},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":70,"top":0},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":70,"top":0},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 1","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":14,"vars_in":[{"rel":"chart","name":"reconstructedLoadings1"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Reconstructed Loadings 1","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pc2","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":61,"top":2},"size":{"width":43,"height":23},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":137,"top":0},"size":{"width":33,"height":22},"zIndex":0,"display":true,"title":"Reconstructed Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":61,"top":24},"size":{"width":43,"height":23},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 2","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":15,"vars_in":[{"rel":"chart","name":"reconstructedLoadings2"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Reconstructed Loadings 2","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["if (! this.button) {\n    if((typeof IframeBridge)!=='undefined') {\n        this.showButton('default');\n        this.showButton('opls');\n        this.disableButton('default');\n        this.button='default';\n    } else {\n        this.showButton('oplsOffline');\n        this.button='oplsOffline';\n        this.disableButton('oplsOffline');\n    }\n    return;\n}\n\nconsole.log('Continue init');\n\nvar layers={\n    'default': {\n        layer:'Default layer'\n    },\n    'opls': {\n        layer: 'OPLS',\n        callback: () => {\n            // we don't calculate automatically because we don't ALWAYS want calculations\n            // API.doAction('calculateOPLS', '');\n        }\n    },\n    'oplsOffline': {\n        layer: 'OPLS Offline'\n    },\n    'oplspc': {\n        layer: 'OPLS PC',\n        callback: () => {\n            API.doAction('calculateOPLSDerivedCharts');\n            API.getData('oplsGridTemplate').triggerChange();\n        }\n    }\n}\n\nif (layers[this.button]) {\n    for (var key of Object.keys(layers)) {\n       this.enableButton(key);\n    }\n    API.switchToLayer(layers[this.button].layer);\n    if (layers[this.button].callback) {\n        layers[this.button].callback();\n    }\n    this.disableButton(this.button);\n}\n\n\n"]}],"libs":[[{}]],"buttons":[[{"name":"default","label":"Home","hide":["hide"],"disable":["disable"]},{"name":"opls","label":"OPLS","hide":["hide"],"disable":[]},{"name":"oplsOffline","label":"OPLS","hide":["hide"],"disable":["disable"]},{"name":"oplspc","label":"OPLS PC","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":28,"top":0},"size":{"width":41,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":28,"top":0},"size":{"width":69,"height":5},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":16,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["console.log('Generate OPLS annotations', this.action);\nif (! API.getData('preferences')) return;\nlet preferences=API.getData('preferences').resurrect();\n\nif (this.action && this.action.name==='oplsPreferencesChanged') { // preferences changed\n    preferences=this.action.value.resurrect();\n    let hash=preferences.opls.x+'-'+preferences.opls.y;\n    if (API.cache('previousOPLSprefs')===hash) return;\n    API.cache('previousOPLSprefs',hash);\n}\n\nlet opls = API.cache('opls');\nif (! opls) return;\n\nconst normalized = API.cache('spectraProcessor').getNormalizedData();\nif (! normalized) return;\nlet spectraInDataset=API.getData('spectraInDataset');\nlet data=new ML.Matrix(normalized.matrix);\nconsole.log(normalized);\nlet selectedInfo={\n    nbSpectra: spectraInDataset.length,\n    nbSelected: spectraInDataset.reduce( (previous, entry) => previous+entry.selected, 0 ),\n    nbOPLS: spectraInDataset.reduce( (previous, entry) => previous+entry.oplsModel, 0 ),\n}\nAPI.createData('selectedInfo',selectedInfo);\nlet projection = opls.predict(data);\n\nlet x = projection.getColumn(preferences.opls.x);\nlet y = projection.getColumn(preferences.opls.y);\nlet oplsAnnotations=[];\nfor (let i=0; i<normalized.ids.length; i++) {\n    let currentID=normalized.ids[i];\n    let spectrum = spectraInDataset.filter( spectrum => String(spectrum.id)===currentID)[0];\n    spectrum.opls={\n        x:x[i],\n        y:y[i]\n    }\n    let label=undefined;\n    if (preferences.opls.displayID && spectrum.selected) {\n        label = {\n            text: spectrum.id,\n            position: { x: x[i], y: y[i]},\n          }\n    }\n\n    oplsAnnotations.push({\n        _highlight: [spectrum._highlight],\n        \"type\": \"ellipse\",\n        \"position\": [\n          {\n            \"x\": x[i],\n            \"y\": y[i]\n          }\n        ],\n        \"props\": {\n          \"rx\": \"6px\",\n          \"ry\": \"6px\"\n        },\n        \"strokeWidth\": \"0px\",\n        \"fillColor\": \"rgba(0,0,0,0)\",\n        \"info\": spectrum,\n        label\n    })\n}\n\nAPI.createData('oplsAnnotations', oplsAnnotations);\n\nvar selected = normalized.meta.map(\n    entry => {\n         return {\n            shape: \"circle\",\n            stroke: entry.color,\n            r: 5\n        }\n    }\n)\n\nvar unselected = normalized.meta.map(\n    (entry,index) => {\n        let spectrum = DataObject.resurrect(spectraInDataset.filter( spectrum => String(spectrum.id)===normalized.ids[index])[0]);\n        if (spectrum.oplsModel) {\n            return {\n                shape: \"circle\",\n                fill: entry.color,\n                r: (spectrum.selected) ? 4 : 2,\n            }\n        }\n        return {\n            shape: \"circle\",\n            stroke: entry.color,\n            fill: 'white',\n            r: (spectrum.selected) ? 4 : 2,\n        }\n    }\n)\n\n\n\nlet styles={\n        unselected,\n        selected: selected\n}\n\nAPI.createData('opls', {x, y, styles, info: normalized.ids.map( (id,index) =>\n    {\n        return {\n            id,\n            meta: normalized.meta[index]\n        }\n    }), type: 'scatter'});\n\nif (this.variable==='preferences') return;\n\nvar explainedVariance = opls.getExplainedVariance();\n\nlet oplsGrid=[];\n\nlet rendererStyle={\n    marker: {\n        default: {},\n        modifiers: unselected\n    }\n}\n\n\nfor (let i=0; i<4; i++) {\n    oplsGrid[i]=[];\n    for (let j=0; j<4; j++) {\n        let x = projection.getColumn(i);\n        let y = projection.getColumn(j);\n        oplsGrid[i][j]={\n            title: 'OPLS PC '+(i+1)+' vs '+(j+1)+\n                ' ('+Number((explainedVariance[i]+explainedVariance[j])*100).toFixed(2)+'%)',\n            \"axes\": {\n                \"x\": {\n                  \"label\": \"PC \"+(i+1)+' ('+Number(explainedVariance[i]*100).toFixed(2)+'%)'\n                },\n                \"y\": {\n                  \"label\": \"PC \"+(j+1)+' ('+Number(explainedVariance[j]*100).toFixed(2)+'%)'\n                }\n            },\n            series: [\n                {\n                    type: 'scatter',\n                    data: {\n                        x,\n                        y\n                    },\n                    style:rendererStyle\n                }\n            ]\n        };\n    }\n}\n\nAPI.createData('oplsGrid', oplsGrid );\n\n\n\n\n\n\n"]}],"libs":[[{"lib":"ML","alias":"ML"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":57,"top":37},"size":{"width":56,"height":55},"zIndex":0,"display":true,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":38,"top":0},"size":{"width":71,"height":67},"zIndex":0,"display":true,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Generate OPLS annotations each time spectraInDataset changes","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":17,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"oplsPreferencesChanged"},{"rel":"execute","name":"changedSelectedSpectra"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Generate OPLS annotations each time spectraInDataset changes","zindex":2},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[2000],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":109,"top":33},"size":{"width":45,"height":44},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":98,"top":6},"size":{"width":40,"height":41},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":114,"top":39},"size":{"width":48,"height":50},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":139,"top":0},"size":{"width":36,"height":22},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":63,"top":0},"size":{"width":53,"height":22},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":166,"top":0},"size":{"width":28,"height":30},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":139,"top":6},"size":{"width":36,"height":28},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":106,"top":34},"size":{"width":44,"height":13},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":98,"top":6},"size":{"width":40,"height":41},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":109,"top":33},"size":{"width":36,"height":44},"zIndex":0,"display":false,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":18,"vars_in":[{"rel":"tpl","name":"twigPreferences"},{"rel":"form","name":"preferences"},{"rel":"value","name":"keepOriginal"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormChanged","rel":"form","jpath":[],"name":"changedPreferences"},{"event":"onFormSubmitted","rel":"form","jpath":[],"name":"UpdateChart"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Preferences","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pc3","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":64,"top":26},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":103,"top":23},"size":{"width":33,"height":22},"zIndex":0,"display":true,"title":"Reconstructed Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":64,"top":26},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 3","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":19,"vars_in":[{"rel":"chart","name":"reconstructedLoadings3"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Reconstructed Loadings 3","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["flip","display"]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pc4","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":66,"top":30},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Reconstructed Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":137,"top":23},"size":{"width":33,"height":22},"zIndex":0,"display":true,"title":"Reconstructed Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":66,"top":30},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":70,"top":23},"size":{"width":43,"height":22},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings 4","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":20,"vars_in":[{"rel":"chart","name":"reconstructedLoadings4"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Reconstructed Loadings 4","zindex":2},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":78},"size":{"width":87,"height":30},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":6},"size":{"width":102,"height":96},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":0,"top":78},"size":{"width":87,"height":30},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":21,"vars_in":[{"rel":"value","name":"oplsGrid"},{"rel":"tpl","name":"oplsGridTemplate"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[["track"]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","main","sec"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display","main","sec"]],"label":["Explained"],"beforeSpacing":["0"],"afterSpacing":["0"],"min":["0"],"max":["1"],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"explainedVariance","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"discrete","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]},{"variable":"cumulativeVariance","axis":"0","adaptTo":"none","plotcolor":[255,1,14,0.5],"strokewidth":"3","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":162,"top":37},"size":{"width":31,"height":33},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":103,"top":46},"size":{"width":67,"height":42},"zIndex":0,"display":true,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":162,"top":33},"size":{"width":31,"height":33},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Explained variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":22,"vars_in":[{"rel":"chart","name":"explainedVariance"},{"rel":"chart","name":"cumulativeVariance"}],"actions_in":[{}],"vars_out":[{"event":"onTrackMouse","rel":"trackData","jpath":[],"name":"varianceTracking"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Explained variance","zindex":2},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[1000],"script":["<style> \n#oplsGrid .grid {\n  display: flex;                       /* establish flex container */\n  flex-wrap: wrap;                     /* enable flex items to wrap */\n  max-width: 100%;\n  justify-content: space-around;\n  \n}\n#oplsGrid .cell {\n  flex: 0 0 25%;                  /* don't grow, don't shrink, width */\n  max-width: 25%;\n  height: 220px;\n  margin-bottom: 5px;\n}\n</style>\n<div id=\"oplsGrid\"> \n    <div class=\"grid\">\n        {% for i in 0..3 %}\n            {% for j in 0..3 %}\n                <div class=\"cell\">{{rendertypeBlock(oplsGrid[i][j],'chart')}}</div>\n            {% endfor %}\n        {% endfor %}\n    </div>\n</div>\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":37},"size":{"width":56,"height":32},"zIndex":0,"display":true,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":148,"top":74},"size":{"width":65,"height":41},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":61,"top":48},"size":{"width":43,"height":35},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Template for grid of OPLS","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":23,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"oplsGridTemplate"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Template for grid of OPLS","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["// may check: https://www.benjaminbell.co.uk/2018/02/principal-components-analysis-opls-in-r.html\n\nlet preferences=API.getData('preferences').resurrect();\nif (! preferences.opls.ellipse) {\n    API.createData('ellipsis', []);\n    return;\n}\n\nlet spectraInDataset = API.getData('spectraInDataset');\nlet categories={};\n\nfor (let spectrum of spectraInDataset) {\n    let category=String(spectrum.category);\n    if (! spectrum.opls) continue;\n    if (! categories[category]) {\n         categories[category]={\n             category: category,\n             color: spectrum.color,\n             data: []\n         }\n    }\n    categories[category].data.push(spectrum.opls);\n}\nconsole.log(categories);\nlet categoriesArray=Object.keys(categories).map( key => categories[key]);\ncategoriesArray=categoriesArray.filter( (entry) => entry.data.length>2);\n\nlet annotations=[];\nconsole.log({categoriesArray})\nfor (let category of categoriesArray) {\n    const x=category.data.map( datum => datum.x);\n    const y=category.data.map( datum => datum.y);\n    let annotation=Ellipse.getEllipse({x,y}, {\n        nbSD:Number(preferences.opls.sd),\n        props: {\n            fillOpacity: 0.2,\n            fillColor: String(category.color),\n            label: {\n                \n            }\n        }\n    });\n    if (preferences.opls.ellipseCategory) {\n        annotation.label=[\n          {\n            \"text\": String(category.category),\n            \"size\": 14,\n            \"anchor\": \"right\",\n            \"color\": String(category.color),\n            \"position\": {\n              \"x\": annotation.properties.position[0].x,\n              \"y\": annotation.properties.position[0].y\n            }\n          }\n        ];\n    }\n    annotations.push(annotation);\n}\n\nwindow.setTimeout( () => {  // need to force the redraw hover\n    console.log('RECREATE ellipsis');\n   API.createData('ellipsis', annotations);\n   API.getData('oplsAnnotations').triggerChange();\n})\n\n\n"]}],"libs":[[{"lib":"ML","alias":"ML"},{"lib":"Ellipse","alias":"Ellipse"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":78,"top":0},"size":{"width":87,"height":68},"zIndex":0,"display":true,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculate the ellipsis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":24,"vars_in":[{"rel":"inputValue","name":"opls"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Calculate the ellipsis","zindex":2},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style>\n    #selectedInfo {\n        zoom: 1.5\n    }\n</style>\n<div id=\"selectedInfo\">\n    In dataset: {{selectedInfo.nbSpectra}} - \n    Selected: {{selectedInfo.nbSelected}} - \n    Used for OPLS calculation: {{selectedInfo.nbOPLS}}\n</div>\n\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":98,"top":2},"size":{"width":49,"height":4},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS Admin"},"Save Load Preferences":{"position":{"left":98,"top":2},"size":{"width":40,"height":4},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":106,"top":2},"size":{"width":44,"height":4},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":98,"top":2},"size":{"width":40,"height":4},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":25,"vars_in":[{"rel":"value","name":"selectedInfo"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/edition/object_editor/","configuration":{"sections":{},"groups":{"group":[{"editable":["text"],"expanded":[[]],"storeObject":[[]],"displayValue":[[]],"searchBox":[["search"]],"sendButton":[[]],"output":["new"],"storedObject":["{}"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":8},"size":{"width":35,"height":52},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":26,"vars_in":[{"rel":"value","name":"opls"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["\nvar OPLS = ML.OPLS;\n\nif (this.button) { // just used for debug\n    this.action={\n        name:this.button\n    }\n}\n\nconst UI=await API.require('src/util/ui');\nlet currentAnalysisResults=API.getData('currentAnalysisResults');\n\nlet userAnalysisResults=API.cache(\"userAnalysisResults\");\n\nswitch (this.action.name) {\n    case 'saveResultTemplate': {\n        if (! API.getData('analysisTemplates')) {\n            UI.showNotification('Only available when linked to a database','warning');\n            return;\n        }\n        let value = (currentAnalysisResults) ? currentAnalysisResults.resurrect().$id[3] : '';\n        let name=await UI.enterValue({\n            label: 'Enter the preference name',\n            buttonLabel: 'Save',\n            value\n        });\n        if (!name) return;\n        \n        let opls=API.cache('opls');\n        let oplsModel=opls ? opls.toJSON() : undefined;\n        \n        let result = await userAnalysisResults.saveTemplate(name, API.getData('preferences').resurrect(), {\n            preferences: API.getData('preferences').resurrect(),\n            description: API.getData('description').resurrect(),\n            spectraInDataset: API.getData('spectraInDataset').resurrect(),\n            oplsModel\n        });\n        API.doAction('refreshResults');\n        break;\n    }\n    case 'saveResult': {\n        let value = (currentAnalysisResults) ? currentAnalysisResults.resurrect().$id[3] : '';\n        let name=await UI.enterValue({\n            label: 'Enter the name',\n            buttonLabel: 'Save',\n            value\n        });\n        if (!name) return;\n        await userAnalysisResults.save(name, API.getData('preferences').resurrect(), {\n            preferences: API.getData('preferences').resurrect(),\n            fragments: API.getData('fragments').resurrect(),\n            description: API.getData('description').resurrect()\n        });\n        API.doAction('refreshResults');\n        break;\n    }\n    case 'deleteResultTemplate':\n    case 'deleteResult': {\n        let result=await UI.confirm('Are you sure you want to delete this template ?', 'Delete', 'Cancel', {});\n        if (! result) return;\n        await userAnalysisResults.delete(this.action.value);\n        API.doAction('refreshResults');\n        break;\n    }\n    case 'loadResultTemplate': {\n        API.createData('opls', undefined);\n        API.createData('oplsAnnotations', []);\n        API.createData('ellipsis', []);\n        \n        let result = await userAnalysisResults.loadResult(this.action.value);\n        \n        let newPreferences=result.preferences;\n        let preferences=API.getData('preferences');\n        copyPreferences(newPreferences, preferences);\n        preferences.triggerChange();\n        API.getData('twigPreferences').triggerChange();\n        let newOPLS=OPLS.load(result.oplsModel);\n        API.cache('opls', newOPLS);\n        API.createData('description', result.description);\n        API.createData('spectraInDataset', result.spectraInDataset);\n        break;\n    }\n    case 'loadResult': {\n        let result = await userAnalysisResults.loadResult(this.action.value);\n        API.createData('description', result.description);\n        let preferences=API.getData('preferences');\n        copyPreferences(result.preferences, preferences);\n        preferences.triggerChange();\n        API.createData('fragments', result.fragments);\n        break;\n    }\n    case 'refreshResults':\n        await userAnalysisResults.refresh();\n        break;\n    case 'selectResultTemplate':\n        let templates=API.getData('analysisTemplates');\n        if (! templates) {\n            UI.showNotification('Only available when linked to a database','warning');\n            return;\n        }\n        let result = await UI.form(`\n            <div style=\"zoom: 1.5;\">\n                <form>\n                    <p style=\"padding-bottom: 10px\">\n                    Reload one of the previously saved preferences:\n                    </p>\n                    <select name='template'>\n                        ${templates.map( template => {\n                            let key=String(template.$id[3]);\n                            let _id=String(template._id);\n                            return `\n                                <option value=\"${_id}\">${key}</option>\n                            `\n                        })}\n                        \n                    </select>\n                    <input type=\"submit\" value=\"Load preferences\"/>\n                </form>\n            </div>\n        `)\n        \n        if (result.template) {\n            API.doAction('loadResultTemplate', {_id:result.template})\n        }\n        \n        break;\n}\n\nfunction copyPreferences(newPreferences, preferences) {\n    Object.keys(newPreferences).forEach( key => {\n        preferences[key]=JSON.parse(JSON.stringify(newPreferences[key]))\n    })\n}\n\n\n\n"]}],"libs":[[{"lib":"ML","alias":"ML"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":22,"top":0},"size":{"width":60,"height":79},"zIndex":0,"display":true,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load prefeferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load Save results and model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":27,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"saveResult"},{"rel":"execute","name":"loadResult"},{"rel":"execute","name":"deleteResult"},{"rel":"execute","name":"refreshResults"},{"rel":"execute","name":"saveResultTemplate"},{"rel":"execute","name":"deleteResultTemplate"},{"rel":"execute","name":"loadResultTemplate"},{"rel":"execute","name":"selectResultTemplate"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Load Save results and model","zindex":2},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Label","jpath":["$id","3"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","hideColumn":[]}]],"actionCols":[[{"name":"🗑","tooltip":"Delete result","icon":"fa-trash","backgroundColor":[255,255,255,0],"color":[0,0,0,1],"action":"deleteResult","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":135,"top":22},"size":{"width":22,"height":10},"zIndex":0,"display":false,"title":"Load / Save results","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":9},"size":{"width":20,"height":28},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":135,"top":22},"size":{"width":22,"height":10},"zIndex":0,"display":false,"title":"Load / Save results","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":28,"vars_in":[{"rel":"list","name":"analysisResults"}],"actions_in":[{}],"actions_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"loadResult"}],"vars_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"currentAnalysisResults"}],"toolbar":{"custom":[[{"title":"Save result","icon":"fa-save","action":"saveResult","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":4},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Label","jpath":["$id","3"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","hideColumn":[]}]],"actionCols":[[{"name":"🗑","tooltip":"Delete result","icon":"fa-trash","backgroundColor":[255,255,255,0],"color":[0,0,0,1],"action":"deleteResultTemplate","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":135,"top":22},"size":{"width":22,"height":10},"zIndex":0,"display":false,"title":"Load / Save preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":38},"size":{"width":20,"height":28},"zIndex":0,"display":true,"title":"Load / Save model","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":135,"top":22},"size":{"width":22,"height":10},"zIndex":0,"display":false,"title":"Load / Save preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":29,"vars_in":[{"rel":"list","name":"analysisTemplates"}],"actions_in":[{}],"actions_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"loadResultTemplate"}],"vars_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"currentTemplateResults"}],"toolbar":{"custom":[[{"title":"Save preferences as template","icon":"fa-save","action":"saveResultTemplate","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Load / Save model","zindex":4},{"url":"modules/types/edition/quill_editor/","configuration":{"sections":{},"groups":{"group":[{"editable":[["isEditable"]],"toolbarMode":["all"],"debouncing":[500],"storeInView":[["yes"]],"modifyVarIn":[["yes"]],"className":["quill"],"css":[".quill {}"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Analysis report","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Analysis report","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Analysis report","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":83,"top":1},"size":{"width":64,"height":58},"zIndex":0,"display":true,"title":"Analysis report","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Analysis report","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Analysis report","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":30,"vars_in":[{"rel":"html","name":"description"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Analysis report","richtext":{"ops":[{"insert":"\n"}]},"zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["console.log('Create OPLS related charts');\nlet opls=API.cache('opls');\n\nconst normalized = API.cache('spectraProcessor').getNormalizedData();\n\nconst data=normalized.matrix;\nconst explainedVariance = opls.getExplainedVariance().slice(0,10);\nAPI.createData('explainedVariance',{\n    x: Array(10).fill().map((item, index) => index+1), \n    y:explainedVariance}\n);\n\nconst cumulativeVariance = {\n    x: Array(10).fill().map((item, index) => index+1), \n    y: [0].concat(opls.getCumulativeVariance().slice(0,10))\n};\n\nAPI.createData('cumulativeVariance',cumulativeVariance);\nAPI.createData('CumulativeVariance10', cumulativeVariance.y[10])\n\nvar loadings = opls.getLoadings();\nconst normalizedX=JSON.parse(JSON.stringify(normalized.x)); // performance issue if not there\n\nAPI.createData('pc1', {x: normalizedX, y: loadings.getRow(0)});\nAPI.createData('pc2', {x: normalizedX, y: loadings.getRow(1)});\nAPI.createData('pc3', {x: normalizedX, y: loadings.getRow(2)});\nAPI.createData('pc4', {x: normalizedX, y: loadings.getRow(3)});\n\n\n// Reconstructed loadings\nconst correlation = ML.MatrixLib.correlation;\nconst covariance = ML.MatrixLib.covariance;\nconst Matrix = ML.Matrix;\n\nconst dataMatrix = Matrix.checkMatrix(data).center('column');\nconst scores = opls.predict(dataMatrix)\nconst covarianceLoadings = covariance(scores, dataMatrix);\nconst correlationLoadings = correlation(scores, dataMatrix).abs();\nconsole.log(covarianceLoadings)\nlet correlationData = [];\nfor (let i = 0; i < correlationLoadings.rows; i++) {\n    correlationData.push({\n        correlationLoading: correlationLoadings.getRow(i),\n        covarianceLoading: covarianceLoadings.getRow(i),\n        maxCorrelation: correlationLoadings.maxRow(i),\n        minCorrelation: correlationLoadings.minRow(i)\n    });\n}\n\nfor (let i = 0; i < Math.min(correlationData.length,4); i++) {\n    let unselectedScale = Chroma.scale(['blue', 'cyan',  'yellow', 'red'])\n    .domain([correlationData[i].minCorrelation, correlationData[i].maxCorrelation]).mode('lch');\n\n    let colorScale = correlationData[i].correlationLoading\n        .map((x, j) => unselectedScale(x));\n    \n    API.createData('reconstructedLoadings'+(i+1),{\n        data:[{\n            type: 'color',\n            x: normalizedX,\n            y: correlationData[i].covarianceLoading,\n            color: colorScale\n        }]\n    })\n}\n"]}],"libs":[[{"lib":"ML","alias":"ML"},{"lib":"chroma","alias":"Chroma"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":123,"top":0},"size":{"width":67,"height":38},"zIndex":0,"display":true,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create opls related charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":31,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"calculateOPLSDerivedCharts"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Create opls related charts","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["// just to spy the variable that are being updated\n\nif (this.variable) {\n    console.log('Update variable',this.variable);\n}\nif (this.action) {\n    console.log('Update action',this.action.name);\n}"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":70},"size":{"width":56,"height":22},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":32,"vars_in":[{"rel":"inputValue","name":"opls"},{"rel":"inputValue","name":"oplsAnnotations"},{"rel":"inputValue","name":"ellipsis"},{"rel":"inputValue","name":"spectraInDataset"},{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/edition/onde/","configuration":{"sections":{},"groups":{"group":[{"hasButton":[[]],"button_text":["Export"],"debouncing":[0],"output":["modified"],"mode":["schema"],"schemaSource":["variable"],"schema":["{}"],"onchangeFilter":[null]}],"data":[{"saveInView":[[]],"varname":[""],"data":["{}"]}]}},"layers":{"Default layer":{"position":{"left":6,"top":6},"size":{"width":21,"height":6},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":3,"top":6},"size":{"width":21,"height":6},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":6,"top":6},"size":{"width":21,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":33,"vars_in":[{"rel":"schema","name":"analysisKindSchema"},{"rel":"inputValue","name":"analysisKind"}],"actions_in":[{}],"title":"","actions_out":[{"jpath":[]}],"vars_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"zindex":2},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style>\n    #memoryInfo {\n        font-family: monospace;\n    }\n</style>\n<div id=\"memoryInfo\">\n    <b>Memory</b>: \n    Original data:\n    {{rendertype(memoryInfo.original+0.00001,{numeral:'0 b'})}}\n    - Normalized data: {{rendertype(memoryInfo.normalized,{numeral:'0 b'})}}\n    - Max allowed {{rendertype(memoryInfo.maxMemory,{numeral:'0 b'})}}\n    {% if memoryInfo.keepOriginal %}\n        &nbsp;<b style=\"color: green\">Original data present</b>\n    {% else %}\n        &nbsp;<b style=\"color: red\">Missing original data</b>\n    {% endif %}\n    \n</div>\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":29,"top":6},"size":{"width":79,"height":2},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":29,"top":6},"size":{"width":79,"height":2},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":34,"vars_in":[{"rel":"value","name":"memoryInfo"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Label","jpath":["$id","3"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","hideColumn":[]}]],"actionCols":[[{"name":"🗑","tooltip":"Delete result","icon":"fa-trash","backgroundColor":[255,255,255,0],"color":[0,0,0,1],"action":"deleteResultTemplate","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":155,"top":33},"size":{"width":16,"height":44},"zIndex":0,"display":true,"title":"Load / Save protocols","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":146,"top":33},"size":{"width":16,"height":44},"zIndex":0,"display":false,"title":"Load / Save protocols","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":35,"vars_in":[{"rel":"list","name":"analysisTemplates"}],"actions_in":[{}],"actions_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"loadResultTemplate"}],"vars_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"currentTemplateResults"}],"toolbar":{"custom":[[{"title":"Save preferences as template","icon":"fa-save","action":"saveResultTemplate","position":"begin","color":[100,100,100,1]},{"title":"Load an example","icon":"fa-dot-circle","action":"loadExample","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Load / Save protocols","zindex":4},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const spectraInDatasetModifications = await API.require('vh/eln/sample/ml/spectraInDatasetModifications');\n\nspectraInDatasetModifications();\n\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":32,"top":33},"size":{"width":43,"height":40},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":75,"top":0},"size":{"width":60,"height":14},"zIndex":0,"display":true,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":32,"top":33},"size":{"width":43,"height":40},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":36,"vars_in":[{"rel":"inputValue","name":"spectraInDataset"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Monitor modifications of spectraInDataset","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["console.log('Load and process', this.action, this.variable);\n\nconst recreateCharts = await API.require('vh/eln/sample/ml/recreateCharts');\n\nawait recreateCharts(this.variable);\n\nAPI.doAction('changedSelectedSpectra');"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Update data and charts","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":111,"top":27},"size":{"width":24,"height":5},"zIndex":0,"display":false,"title":"Recreate the data and charts based on the preferences","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":71,"top":16},"size":{"width":64,"height":22},"zIndex":0,"display":true,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":111,"top":27},"size":{"width":24,"height":5},"zIndex":0,"display":false,"title":"Recreate the data and charts based on the preferences","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":37,"vars_in":[{"rel":"inputValue","name":"preferences"}],"actions_in":[{"rel":"execute","name":"UpdateChart"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Update chart","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let value=this.action.value;\n\nswitch (this.action.name) {\n    case 'trackClicked': {\n        if (value.event.altKey && value.event.shiftKey) {\n\n            let key=Object.keys(value.data)[0];\n            let preferences=API.getData('preferences');\n            preferences.display.correlationIndex=value.data[key].indexClosest;\n            preferences.display.correlationX=value.data[key].xExact;\n            if (! String(preferences.display.correlation)) {\n                preferences.display.correlation=\"selected\";\n                preferences.display.selection=\"none\";\n            }\n            preferences.triggerChange();\n        }\n        break;\n    }\n    case 'trackMove': {\n        let displayPreferences = API.getData('preferences').display.resurrect();\n        const trackMove = this.action.value.data.chart;\n        if (! trackMove || ! displayPreferences.trackingInfo || displayPreferences.original==='true') {\n            API.createData('trackAnnotations', []);\n            return;\n        }\n        const spectraProcessor=API.cache('spectraProcessor');\n        const annotations=spectraProcessor.getTrackAnnotation(trackMove.indexBefore)\n        API.createData('trackAnnotations', annotations)\n        break;\n    }\n    case 'downloadNormalizedMatrix':\n        const spectraProcessor = API.cache('spectraProcessor');\n        let tsv=spectraProcessor.getNormalizedText();\n        let fileSaver=await API.require('file-saver');\n        var blob = new Blob([tsv], {type: \"text/tab-separated-values;charset=utf-8\"});\n        fileSaver( blob, \"data.tsv\");\n        break;\n    default:\n}\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":6,"top":0},"size":{"width":61,"height":38},"zIndex":0,"display":true,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Deal with other actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":38,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"downloadNormalizedMatrix"},{"rel":"execute","name":"trackMove"},{"rel":"execute","name":"trackClicked"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Deal with other actions","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let droppedText=API.getData('droppedText').resurrect();\n\nconst spectraProcessor = SpectraProcessor.SpectraProcessor.fromNormalizedMatrix(droppedText);\n\nconsole.log(spectraProcessor.getNormalization())\nconsole.log(spectraProcessor.getMemoryInfo());\n\nconst preferences=API.getData('preferences');\npreferences.normalization=spectraProcessor.getNormalization();\npreferences.triggerChange();\n\nlet spectraInDataset=[];\nfor (let spectrum of spectraProcessor.spectra) {\n    console.log(spectrum.id)\n    spectraInDataset.push( {\n        id: spectrum.id,\n        selected: true,\n        oplsModel: false,\n        category: spectrum.meta.category,\n        color: spectrum.meta.color,\n        toc: {\n            value: {\n                reference: spectrum.id,\n                misc: {\n                    id: spectrum.id,\n                    ...spectrum.meta\n                }\n            }\n        },\n        _highlight: Math.random()\n    })\n}\n\nAPI.createData('memoryInfo', spectraProcessor.getMemoryInfo());\n\nAPI.createData('spectraInDataset', spectraInDataset);\n\nAPI.createData('keepOriginal', false);\n\nAPI.cache('spectraProcessor', spectraProcessor);\n"]}],"libs":[[{"lib":"SpectraProcessor","alias":"SpectraProcessor"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":76,"top":11},"size":{"width":94,"height":68},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadModel"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":39,"vars_in":[{"rel":"inputValue","name":"droppedText"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/client_interaction/dragdrop/","configuration":{"sections":{},"groups":{"group":[{"label":["Drop your matrix TSV file here"],"dragoverlabel":[null],"hoverlabel":["Drop the file"],"fileSelectLabel":["Select file"],"labelFontSize":[26],"checkOptions":[["promptAmbiguous"]],"inputOptions":[["allowDrop","allowPaste","allowFileInput"]]}],"vars":[[{"filter":"ext","extension":"*","filetype":"text","type":"","variable":"droppedText"}]],"string_general":[{"askFilename":[[]]}],"string":[[{"filter":"ext","extension":"*","type":"","variable":"droppedText"}]],"photo":[[{"variable":"photo"}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":11},"size":{"width":27,"height":41},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":76,"top":0},"size":{"width":45,"height":10},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadModel"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":40,"vars_out":[{"event":"onRead","rel":"data","jpath":["droppedText","content"],"name":"droppedText"}],"vars_in":[],"actions_in":[{}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/client_interaction/button_action/","configuration":{"sections":{},"groups":{"group":[{"toggle":["click"],"label":["Donwload"],"onLabel":["Toggle action off"],"offLabel":["Toggle action on"],"title":["Download normalized matrix"],"css":["font-size: 11px;\nbackground-color: #E6E6E6;\nborder: 1px solid rgba(0, 0, 0, 0.2);\nheight: 30px;\npadding: .5em 1em;\nfont-weight: bold;"],"cssOn":["font-size: 11px;\nbackground-color: #E6E6E6;\nborder: 1px solid rgba(0, 0, 0, 0.2);\nheight: 30px;\npadding: .5em 1em;\nfont-weight: bold;"],"cssOff":["font-size: 11px;\nbackground-color: #E6E6E6;\nborder: 1px solid rgba(0, 0, 0, 0.2);\nheight: 30px;\npadding: .5em 1em;\nfont-weight: bold;"],"startState":["off"],"text":["downloadNormalizedMatrix"],"askConfirm":[[]],"confirmText":["Are you sure?"],"okLabel":["Ok"],"cancelLabel":["Cancel"],"contentType":["svg"],"content":["<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\t width=\"330\" height=\"330\" viewBox=\"0 0 330 330\" xml:space=\"preserve\">\n<g id=\"XMLID_24_\">\n\t<path id=\"XMLID_25_\" d=\"M154.389,265.602c0.351,0.35,0.719,0.683,1.103,0.997c0.169,0.138,0.347,0.258,0.52,0.388\n\t\tc0.218,0.164,0.432,0.333,0.659,0.484c0.212,0.142,0.432,0.265,0.649,0.395c0.202,0.121,0.4,0.248,0.608,0.359\n\t\tc0.224,0.12,0.453,0.221,0.681,0.328c0.215,0.102,0.427,0.21,0.648,0.301c0.223,0.092,0.45,0.167,0.676,0.247\n\t\tc0.235,0.085,0.468,0.175,0.709,0.248c0.226,0.068,0.456,0.119,0.685,0.176c0.246,0.062,0.489,0.131,0.739,0.181\n\t\tc0.263,0.052,0.528,0.083,0.794,0.121c0.219,0.031,0.435,0.073,0.658,0.095c0.492,0.048,0.986,0.075,1.48,0.075\n\t\tc0.494,0,0.988-0.026,1.48-0.075c0.225-0.022,0.444-0.064,0.667-0.096c0.262-0.037,0.524-0.068,0.784-0.12\n\t\tc0.255-0.05,0.503-0.121,0.754-0.184c0.223-0.057,0.448-0.105,0.669-0.172c0.246-0.075,0.483-0.167,0.724-0.253\n\t\tc0.221-0.08,0.444-0.152,0.662-0.242c0.225-0.093,0.44-0.202,0.659-0.306c0.225-0.106,0.452-0.206,0.672-0.324\n\t\tc0.21-0.112,0.408-0.239,0.611-0.361c0.217-0.13,0.437-0.252,0.648-0.394c0.222-0.148,0.431-0.314,0.643-0.473\n\t\tc0.179-0.134,0.362-0.258,0.536-0.4c0.365-0.3,0.714-0.617,1.049-0.949c0.016-0.016,0.033-0.028,0.049-0.044l70.002-69.998\n\t\tc5.858-5.858,5.858-15.355,0-21.213c-5.857-5.858-15.355-5.857-21.213-0.001l-44.396,44.393V15c0-8.284-6.716-15-15-15\n\t\tc-8.284,0-15,6.716-15,15v203.785l-44.392-44.391c-5.858-5.858-15.356-5.858-21.213,0c-5.858,5.858-5.858,15.355,0,21.213\n\t\tL154.389,265.602z\"/>\n\t<path id=\"XMLID_26_\" d=\"M315,300H15c-8.284,0-15,6.716-15,15s6.716,15,15,15h300c8.284,0,15-6.716,15-15S323.284,300,315,300z\"/>\n</g>\n</svg>\n"],"maskOpacity":[0.6]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":3,"top":53},"size":{"width":23,"height":26},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":122,"top":1},"size":{"width":20,"height":9},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":41,"vars_in":[],"actions_in":[{}],"actions_out":[{"event":"onClick","rel":"actionText","jpath":[],"name":"downloadNormalizedMatrix"}],"vars_out":[],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":2},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["xy"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[["yes"]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"opls","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"0.0000001","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":["markers"],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":56,"height":36},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS PC":{"position":{"left":0,"top":6},"size":{"width":53,"height":39},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":77,"height":43},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"Debug":{"position":{"left":110,"top":5},"size":{"width":42,"height":46},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Save Load Preferences":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"Load and Process":{"position":{"left":157,"top":58},"size":{"width":34,"height":30},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load"},"OPLS Offline":{"position":{"left":28,"top":6},"size":{"width":77,"height":41},"zIndex":0,"display":true,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Offline Admin":{"position":{"left":28,"top":6},"size":{"width":69,"height":41},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":42,"vars_in":[{"rel":"chart","name":"opls"},{"rel":"annotations","name":"oplsAnnotations"},{"rel":"annotations","name":"ellipsis"}],"actions_in":[{}],"vars_out":[{"event":"onMouseOverShape","rel":"shapeInfos","jpath":["info","toc"],"name":"tocHovered"},{"event":"onSelectScatter","rel":"selectedData","jpath":[],"name":"scatterSelected"},{"event":"onClickMarker","rel":"markerInfos","jpath":[],"name":"markerData"}],"actions_out":[{"event":"onShapeClick","rel":"dataAndEvent","jpath":[],"name":"clickedOPLSShape"}],"toolbar":{"custom":[[{"title":"Remove selected spectra","icon":"fa-trash","action":"deleteOPLSSelection","position":"begin","color":[100,100,100,1]},{"title":"Show spectra","icon":"fa-plus","action":"oplsaddSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Only show selected spectra","icon":"fa-bullseye","action":"oplsselectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Hide spectra","icon":"fa-minus","action":"oplsHideSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Principal component analysis","zindex":2},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["Cumulative variance (10 PC): {{rendertype(CumulativeVariance10, {numeral: '0.00%'})}}\n{% if varianceTracking.explainedVariance %}\n- \nPC{{varianceTracking.explainedVariance.xClosest}}:\n{{rendertype(varianceTracking.explainedVariance.yClosest,{numeral:'0.00%'})}} - cumulative:\n{{rendertype(varianceTracking.cumulativeVariance.yClosest,{numeral:'0.00%'})}} \n{% endif %}"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":140,"top":0},"size":{"width":30,"height":4},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":112,"top":49},"size":{"width":50,"height":4},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":43,"vars_in":[{"rel":"value","name":"CumulativeVariance10"},{"rel":"value","name":"varianceTracking"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["\nconst spectraInDataset = API.getData('spectraInDataset');\nlet firstSpectrum = DataObject.resurrect(spectraInDataset[0]);\n\nlet path=[];\nif (firstSpectrum.toc && firstSpectrum.toc.value) {\n    firstSpectrum=firstSpectrum.toc.value;\n}\n\nlet jpath = await UI.selectJpath(firstSpectrum, undefined, {\n    height: 500,\n});\nif (! jpath) return;\njpath=[...path,...jpath];\nconst getJpath = _.property(jpath);\n\n\nconsole.log(jpath);\n\nfor (let spectrum of spectraInDataset) {\n    spectrum.category=getJpath(spectrum);\n}\nselectedSpectra.triggerChange();\n\n"]}],"libs":[[{"lib":"lodash","alias":"_"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":87,"top":8},"size":{"width":57,"height":52},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"SelectCategory"}},"id":44,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[0],"script":["<style>\n    #oplsForm {\n        padding: 10px;\n    }\n    #oplsFormOffline h1 {\n        font-size: 16px;\n        padding-top: 12px;\n        padding-bottom: 4px;\n        space\n    }\n    #oplsFormOffline input, #oplsForm select {\n        margin-top: 3px;\n        margin-bottom: 3px;\n    } \n</style>\n\n\n<div id='oplsFormOffline'>\n   \n\n    X: <select name=\"opls.x\">\n        <option value=\"0\">PC 1</option>\n        <option value=\"1\">PC 2</option>\n        <option value=\"2\">PC 3</option>\n        <option value=\"3\">PC 4</option>\n    </select>\n     - Y:<select name=\"opls.y\">\n        <option value=\"0\">PC 1</option>\n        <option value=\"1\">PC 2</option>\n        <option value=\"2\">PC 3</option>\n        <option value=\"3\">PC 4</option>\n    </select>  - \n    Display ellipses <input type=\"checkbox\" name=\"opls.ellipse\">\n    - Nb SD\n    <select name=\"opls.sd\">\n        <option value=\"1\">1</option>\n        <option value=\"2\">2</option>\n        <option value=\"3\">3</option>\n    </select> - \n    Show category <input type=\"checkbox\" name=\"opls.ellipseCategory\">\n    Show ID <input type=\"checkbox\" name=\"opls.displayID\">\n    \n</div>\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":47},"size":{"width":60,"height":37},"zIndex":0,"display":true,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for OPLS preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"SelectCategory"}},"id":45,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"twigOPLSPrefs"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Twig template for OPLS preferences","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[300],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":44,"top":9},"size":{"width":52,"height":4},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":164,"top":40},"size":{"width":26,"height":41},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":62,"top":58},"size":{"width":54,"height":17},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":44,"top":9},"size":{"width":51,"height":4},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"SelectCategory"}},"id":46,"vars_in":[{"rel":"tpl","name":"twigOPLSPrefs"},{"rel":"form","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormChanged","rel":"form","jpath":[],"name":"oplsPreferencesChanged"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":49},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["const twigPreferences=`\n\n${Prefs.style}\n\n<div id='extendedForm'>\n    <form>\n    \n    ${Prefs.dataNormalization}\n\n    <h1>OPLS</h1>\n    <table>\n        <tr>\n            <th>Scale data:</th>\n            <td>\n                <input type=\"checkbox\" name=\"opls.scale\">\n            </td>\n        </tr>\n        <tr>\n            <th>Ignore zero variance</th>\n            <td>\n                <input type=\"checkbox\" name=\"opls.ignoreZeroVariance\">\n            </td>\n        </tr>\n        \n    </table>\n    \n\n<!--\n    <center>\n         Auto-refresh <input type=\"checkbox\" name=\"display.autorefresh\" checked> \n        or <input type=\"submit\" value=\"Update data and chart\">\n    </center>\n-->\n    </form>\n</div>\n\n\n<script>\n    require(['vh/util/twigAdvancedForm'], function(AF) {\n        AF('extendedForm', {debug:false});\n    });\n</script>\n`;\n\n\nAPI.createData('twigPreferences', twigPreferences);\n\nAPI.createData('displayTwigPreferences', Prefs.displayTwigPreferences);\n\nif((typeof IframeBridge)==='undefined') {\n    API.createData('twigTemplate', Prefs.tocOfflineTwig);\n}\n\n"]}],"libs":[[{"lib":"vh/eln/sample/ml/viewsPreferences","alias":"Prefs"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":0,"top":5},"size":{"width":62,"height":40},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"SelectCategory"}},"id":47,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[500],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":38,"top":36},"size":{"width":69,"height":3},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"OPLS":{"position":{"left":31,"top":51},"size":{"width":68,"height":3},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS"},"OPLS Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Admin"},"OPLS PC":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS PC"},"Preferences":{"position":{"left":67,"top":25},"size":{"width":65,"height":20},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"Ellipse":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Ellipse"},"Debug":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Debug"},"Save Load Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Save Load Preferences"},"Load and Process":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Load and Process"},"OPLS Offline":{"position":{"left":32,"top":51},"size":{"width":75,"height":3},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"OPLS Offline"},"OPLS Offline Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"OPLS Offline Admin"},"SelectCategory":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"SelectCategory"}},"id":48,"vars_in":[{"rel":"tpl","name":"displayTwigPreferences"},{"rel":"form","name":"preferences"},{"rel":"value","name":"ranges"},{"rel":"value","name":"keepOriginal"},{"rel":"value","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormChanged","rel":"form","jpath":[],"name":"changedPreferences"},{"event":"onFormSubmitted","rel":"form","jpath":[],"name":"UpdateChart"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Preferences","zindex":50}],"variables":[{"jpath":[""]}],"aliases":[{"path":"../../github/cheminfo-js/visualizer-helper/44e867405035ff96f52ee281e768590a2dc74b11","alias":"vh"},{"path":"http://localhost:9898/cheminfo-js/visualizer-helper/","alias":"vhxx"},{"path":"../../lib/openchemlib-extended/1.3.1/openchemlib-extended","alias":"OCLE"},{"path":"../../lib/eln-plugin/0.0.2/eln-plugin","alias":"elnPlugin"},{"path":"../../lib/ml/5.3.0/ml.min","alias":"ML"},{"path":"../../lib/jsgraph-sd-ellipse/0.0.1/jsgraph-sd-ellipse","alias":"Ellipse"},{"path":"../../lib/spectra-processor/2.8.0/spectra-processor.min","alias":"SpectraProcessor"},{"path":"http://localhost:9898/cheminfo/spectra-processor/dist/spectra-processor","alias":"SpectraProcessorXX"}],"configuration":{"title":"orthogonal projections to latent structures (OPLS)"},"actionscripts":[{"sections":{},"groups":{"action":[{"name":[null],"script":[null]}]}}],"init_script":[{"sections":{},"groups":{"general":[{"script":["if((typeof IframeBridge)==='undefined') {\n    let Grid=await require('src/main/grid');\n    Grid.setInitialLayerName('OPLS Offline');\n}\n\n\nconst [\n    Roc,\n    loadTwig,\n    UserAnalysisResults,\n    Toc,\n    SpectraDataSet,\n    libs,\n    RangesManager,\n] = await API.require([\n    'vh/rest-on-couch/Roc',\n    'vh/eln/templates/loadTwig',\n    'vh/rest-on-couch/UserAnalysisResults',\n    'vh/eln/Toc',\n    'vh/eln/sample/ml/SpectraDataSet',\n    'vh/eln/libs',\n    'vh/eln/sample/RangesManager',\n]);\n\nconst SpectraProcessor = (await API.require('SpectraProcessor')).SpectraProcessor;\nAPI.cache('spectraProcessor', new SpectraProcessor({}));\n\nif((typeof IframeBridge)!=='undefined') {\n    IframeBridge.onMessage(onMessage);\n    IframeBridge.ready();\n} else {\n    const spectraDataSet = new SpectraDataSet(undefined, undefined, {\n        defaultAttributes: {\n            oplsModel: false\n        }\n    });\n    spectraDataSet.initializeAnalysis();\n    API.cache('spectraDataSet', spectraDataSet);\n}\n\nasync function onMessage(data) {\n    if(data.type === 'tab.data') {\n        var couchDB = data.message.couchDB;\n        var uuid = data.message.uuid;\n        API.cache('couchDB', couchDB);\n        API.cache('uuid', uuid);\n        var roc = new Roc(couchDB);\n        API.cache('roc', roc);\n         \n        var userAnalysisResults = new UserAnalysisResults(roc, data.message.uuid);\n        API.cache(\"userAnalysisResults\", userAnalysisResults);\n        userAnalysisResults.refresh();\n        API.createData('description', '');\n        \n        const sampleToc = new Toc(roc);\n        sampleToc.initializeGroupForm();\n        API.cache('sampleToc', sampleToc);\n        \n        const spectraDataSet = new SpectraDataSet(roc, sampleToc, {\n            defaultAttributes: {\n                oplsModel: false\n            }\n        });\n        spectraDataSet.initializeAnalysis({autoRefresh:false});\n        API.cache('spectraDataSet', spectraDataSet);\n    }\n}\n\nAPI.createData('spectraInDataset',[]);\n\nconst ranges = await API.createData('ranges', []);\nconst rangesManager = new RangesManager(ranges, {ensureLabel: true});\nAPI.cache('rangesManager', rangesManager);\n\n\nAPI.createData('preferences', {\n    data: {keep: true},\n    display: {\n        selection: 'selected',\n        original: false,\n        trackingInfo: false,\n        correlation: '',\n        correlationIndex: false,\n        boxplot: false,\n        boxplotOptions: {\n            q13FillColor : '#000',\n            q13FillOpacity : 0.3,\n            q2StrokeColor : '#000',\n            q2StrokeWidth : 3,\n            minMaxFillColor : '#000',\n            minMaxFillOpacity : 0.15\n        },\n        autorefresh: true\n    },\n    normalization: {numberOfPoints: 1024},\n    postProcessing: {\n        scale: {\n            method: \"\",\n            targetID: \"\",\n            range: \"Full spectrum\",\n            relative: false,\n        }\n    },\n    opls: {\n        scale: true,\n        ignoreZeroVariance: true,\n        x:0,\n        y:1,\n        ellipse:true,\n        ellipseCategory:false,\n        sd:2,\n    }\n});\n\nloadTwig(['org.cheminfo.sampleToc.chemical.default']);\n\nAPI.require('vh/util/tips').then( Tips => {\n    Tips.showTips();\n    Tips.addPageHelp({iconSize:'fa-3x'});\n});\n"]}]}}],"custom_filters":[{"sections":{"modules":[{"sections":{},"groups":{"modules":[[{}]]}}],"filtersLib":[{"sections":{},"groups":{"filters":[[{}]]}}],"filters":[{"sections":{},"groups":{"filter":[{"name":[null],"script":[null]}],"libs":[[{}]]}}]},"groups":{}}],"actionfiles":[{"sections":{},"groups":{"action":[[{}]]}}]}