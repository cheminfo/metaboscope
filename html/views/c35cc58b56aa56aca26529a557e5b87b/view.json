{"version":"2.129.0","grid":{"layers":{"Default layer":{"name":"Default layer"},"Admin":{"name":"Admin"},"preferences":{"name":"preferences"},"pc":{"name":"pc"},"Import data":{"name":"Import data"},"Actions manager":{"name":"Actions manager"},"Range manager":{"name":"Range manager"},"compare":{"name":"compare"},"loadings":{"name":"loadings"},"Defining blocks":{"name":"Defining blocks"}},"xWidth":10,"yHeight":10},"modules":[{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["if (! this.button) this.button='default';\nlet blockScores = API.getData('blockScores');\nif (blockScores) blockScores.triggerChange();\nvar layers={\n    'Default layer': {\n        layer: 'Default layer'\n    },\n    'pc': {\n        layer: 'pc'\n    },\n    'compare': {\n        layer: 'compare',\n    },\n    'loadings': {\n        layer: 'loadings',\n    }\n}\n\nif (layers[this.button]) {\n    API.switchToLayer(layers[this.button].layer);\n    if (layers[this.button].callback) {\n        layers[this.button].callback();\n    }\n}\n"]}],"libs":[[{}]],"buttons":[[{"name":"Default layer","label":"Home","hide":[],"disable":[]},{"name":"pc","label":"PCA PC","hide":[],"disable":[]},{"name":"compare","label":"Compare loadings","hide":[],"disable":[]},{"name":"loadings","label":"Loadings","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":63,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":2,"top":6},"size":{"width":62,"height":56},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"pc":{"position":{"left":0,"top":0},"size":{"width":57,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Actions manager":{"position":{"left":2,"top":6},"size":{"width":62,"height":56},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":56,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"loadings":{"position":{"left":0,"top":0},"size":{"width":59,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":63,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":1,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":3},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const Matrix = ML.MatrixLib.Matrix;\nconst median = ML.Array.median;\nconst PCA = ML.PCA;\nconst preferences = API.getData('preferences').resurrect();\nconst nbComponents = preferences.pca.nbComponents;\nconst spectraInDataset = API.getData('spectraInDataset');\n\nspectraInDataset.forEach((spectrum) => spectrum.pcaModel=false);\nconst ids = spectraInDataset.filter( spectrum => DataObject.resurrect(spectrum.selected))\n    .map(spectrum => {\n        spectrum.pcaModel=true;\n        return String(spectrum.id);\n    });\n\nconst normalized = API.cache('spectraProcessor').getNormalizedData({ids});\nconst xAxis = normalized.x;\nconst dataset=normalized.matrix;\nconst blocks = API.getData('blocks');\nlet dataBlocks;\nif (blocks) {\n    dataBlocks = columnSlicing(blocks, dataset, xAxis);\n    API.createData('dataBlocks',\n        columnSlicing(\n            blocks,\n            API.cache('spectraProcessor').getNormalizedData().matrix,\n            xAxis\n        )\n    );\n} else {\n    UI.showNotification(`There's no dataset blocks yet`, 'warning')\n}\n\nlet pcaBlocks = [];\nlet counter = 0;\nif (blocks) {\n  for (let i = 0; i < dataBlocks.length; i++) {\n    let pca = new PCA(dataBlocks[i], {\n      center: true,\n      scale: true,\n      method: 'NIPALS',\n      nCompNIPALS: nbComponents\n    });\n    pcaBlocks.push(pca);\n    counter++\n    await delay(0)\n    statusProgressFunction(counter, dataBlocks.length + 1);\n  }\n}\n\nlet pca = new PCA(dataset, {\n  center: true,\n  scale: true,\n  method: 'NIPALS',\n  nCompNIPALS: nbComponents\n});\ncounter++\nawait delay(0)\nstatusProgressFunction(counter, dataBlocks.length + 1);\nAPI.createData('pca', pca);\nAPI.createData('pcaBlocks', pcaBlocks).then(() => {\n    spectraInDataset.triggerChange();\n    UI.showNotification('PCA was successfully calculated', 'success');\n});\n\nfunction columnSlicing(blocksData, dataset, xAxis) {\n    dataset = Matrix.checkMatrix(dataset);\n    let blocks = [];\n    for (let block of blocksData) {\n        const chunck = dataset.subMatrix(0, dataset.rows - 1, DataObject.resurrect(block.fromIndex), DataObject.resurrect(block.toIndex));\n        blocks.push(chunck);\n    }\n    return blocks;\n}\n\n\nasync function statusProgressFunction(currentStatus, iterationsNumber) {\n    let status = currentStatus < iterationsNumber? currentStatus: 0;\n    API.createData('statusProgress', {\n        currentStatus: status,\n        iterationsNumber: iterationsNumber\n    });\n}\n"]}],"libs":[[{"lib":"delay","alias":"delay"},{"lib":"ML","alias":"ML"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"calculate","label":"Calculate / Recalculate PCA","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":68,"top":5},"size":{"width":20,"height":4},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":57,"height":84},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":1},"size":{"width":68,"height":78},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"actionsManager"},"Range manager":{"position":{"left":0,"top":1},"size":{"width":83,"height":78},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":57,"height":87},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":68,"top":5},"size":{"width":20,"height":4},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":2,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"calculate"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":9},{"url":"modules/types/client_interaction/dragdrop/","configuration":{"sections":{},"groups":{"group":[{"label":["Drop your tsv here"],"dragoverlabel":[null],"hoverlabel":["Drag'n drop or paste here"],"fileSelectLabel":["Select file"],"labelFontSize":[26],"checkOptions":[["promptAmbiguous"]],"inputOptions":[["allowDrop","allowPaste","allowFileInput"]]}],"vars":[[{"filter":"ext","extension":"*","filetype":"text","type":"","variable":"file"}]],"string_general":[{"askFilename":[[]]}],"string":[[{"filter":"ext","extension":"*","type":"","variable":"str"}]],"photo":[[{"variable":"photo"}]]}},"layers":{"Default layer":{"position":{"left":0,"top":11},"size":{"width":19,"height":36},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":54,"height":13},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":10},"size":{"width":38,"height":12},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":3,"vars_out":[{"event":"onRead","rel":"data","jpath":["file","content"],"name":"droppedText"}],"vars_in":[],"actions_in":[{}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":9},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const preferences=API.getData('preferences');\nconst spectraInDataset = API.getData('spectraInDataset');\nif (API.getData('droppedText')) {\n    const droppedText=API.getData('droppedText').resurrect();\n    const spectraProcessor = SP.SpectraProcessor.fromNormalizedMatrix(droppedText);\n    preferences.normalization=spectraProcessor.getNormalization();\n    preferences.triggerChange();\n    let files = [];\n    for (let spectrum of spectraProcessor.spectra) {\n        spectrum.meta.display = true;\n        spectraInDataset.push( {\n            id: spectrum.id,\n            selected: true,\n            pcaModel: false,\n            category: spectrum.meta.category,\n            color: spectrum.meta.color,\n            toc: {\n                value: {\n                    reference: spectrum.id,\n                    misc: {\n                        id: spectrum.id,\n                        ...spectrum.meta\n                    }\n                }\n            },\n            _highlight: Math.random()\n        })\n    }\n    spectraInDataset.triggerChange();\n    API.cache('spectraProcessor', spectraProcessor);\n    API.createData('memoryInfo', spectraProcessor.getMemoryInfo());\n}\n\n\n\n"]}],"libs":[[{"lib":"src/util/couchdbAttachments","alias":"CDB"},{"lib":"components/papa-parse/papaparse.min","alias":"Papa"},{"lib":"SpectraProcessor","alias":"SP"},{"lib":"ML","alias":"ML"},{"lib":"chroma","alias":"chroma"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":14},"size":{"width":54,"height":43},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":14},"size":{"width":54,"height":58},"zIndex":0,"display":true,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":85,"top":69},"size":{"width":66,"height":41},"zIndex":0,"display":false,"title":"Import from tsv","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":4,"vars_in":[{"rel":"inputValue","name":"dropped"},{"rel":"inputValue","name":"droppedText"}],"actions_in":[{}],"vars_out":[{"event":"onScriptEnded","rel":"outputValue","jpath":[],"name":"files"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Import from tsv","zindex":47},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const Matrix = ML.MatrixLib.Matrix;\nconst median = ML.Array.median;\nlet spectraInDataset = API.getData('spectraInDataset').resurrect();\nlet spectraProcessor = API.cache('spectraProcessor');\nlet preferences = API.getData('preferences').resurrect();\nAPI.createData('dataBackup', spectraProcessor.getNormalizedData().matrix)\n\nspectraProcessor.setNormalization(preferences.normalization);\nfor (let spectrum of spectraInDataset) {\n    let id = spectrum.id;\n    if (spectraProcessor.contains(id)) {\n        let processorSpectrum=spectraProcessor.getSpectrum(id);\n        processorSpectrum.meta=getMeta(spectrum);\n        continue;\n    }\n    spectraProcessor.addFromData(spectrum.data, {\n        id,\n        meta: getMeta(spectrum)\n    })\n}\nfunction getMeta(spectrum) {\n    return {\n        ...{ \n            selected: DataObject.resurrect(spectrum.selected),\n            color: DataObject.resurrect(spectrum.color),\n            category: DataObject.resurrect(spectrum.category),\n            _highlight: DataObject.resurrect(spectrum._highlight)\n        },\n        ... DataObject.resurrect(spectrum.meta)\n    }\n}\n"]}],"libs":[[{"lib":"ML","alias":"ML"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":165,"top":8},"size":{"width":55,"height":77},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":55,"top":0},"size":{"width":55,"height":72},"zIndex":0,"display":true,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":165,"top":8},"size":{"width":95,"height":43},"zIndex":0,"display":false,"title":"Data manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":5,"vars_in":[{"rel":"inputValue","name":"selectedSpectra"},{"rel":"inputValue","name":"preferences"}],"actions_in":[{"rel":"execute","name":"spectrumClicked"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Data manager","zindex":13},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["console.log('User analysis result',this.action, this.variable)\n\nlet currentAnalysisResults=API.getData('currentAnalysisResults');\n\nlet userAnalysisResults=API.cache(\"userAnalysisResults\");\nlet templates=API.getData('analysisTemplates');\nlet output;\nswitch (this.action.name) {\n    case 'refreshResults':\n        await userAnalysisResults.refresh();\n        break;\n    case 'deleteResultTemplate':\n    case 'deleteResult':\n        await userAnalysisResults.deleteTemplate(this.action.value)\n        API.doAction('refreshResults');\n        break;\n        \n    case 'saveResultTemplate': {\n        let value = (currentAnalysisResults) ? currentAnalysisResults.resurrect().$id[3] : '';\n        let name=await UI.enterValue({\n            label: 'Enter the preference name',\n            buttonLabel: 'Save',\n            value\n        });\n        if (!name) return;\n        let result = await userAnalysisResults.saveTemplate(name, API.getData('preferences').resurrect(), {\n            preferences: API.getData('preferences').resurrect(),\n            ranges: API.getData('ranges').resurrect(),\n        });\n        API.doAction('refreshResults');\n        break;\n    }\n\n    case 'loadResultTemplate': {\n        let result = await userAnalysisResults.loadResult(this.action.value);\n        let rangesManager = API.cache('rangesManager');\n        rangesManager.addRanges(result.ranges);\n        API.createData('preferences', result.preferences);\n        break;\n    }\n\n    case 'selectRange':\n        if (! templates) {\n            UI.showNotification('Only available when linked to a database','warning');\n            return;\n        }\n        output = await UI.form(`\n            <div style=\"zoom: 1.5;\">\n                <form>\n                    <p style=\"padding-bottom: 10px\">\n                    Reload one of the previously saved preferences:\n                    </p>\n                    <select name='template'>\n                        ${templates.map( template => {\n                            let key=String(template.$id[3]);\n                            let _id=String(template._id);\n                            return `\n                                <option value=\"${_id}\">${key}</option>\n                            `\n                        })}\n                        \n                    </select>\n                    <input type=\"submit\" value=\"Load preferences\"/>\n                </form>\n            </div>\n        `)\n        if (output) {\n          let result = await userAnalysisResults.loadResult({_id: output.template});\n          let rangesManager = API.cache('rangesManager');\n          rangesManager.addRanges(result.ranges)\n        }\n        break;\n    case 'selectPreferences':\n        if (! templates) {\n            UI.showNotification('Only available when linked to a database','warning');\n            return;\n        }\n        output = await UI.form(`\n            <div style=\"zoom: 1.5;\">\n                <form>\n                    <p style=\"padding-bottom: 10px\">\n                    Reload one of the previously saved preferences:\n                    </p>\n                    <select name='template'>\n                        ${templates.map( template => {\n                            let key=String(template.$id[3]);\n                            let _id=String(template._id);\n                            return `\n                                <option value=\"${_id}\">${key}</option>\n                            `\n                        })}\n                        \n                    </select>\n                    <input type=\"submit\" value=\"Load preferences\"/>\n                </form>\n            </div>\n        `)\n        if (output) {\n          let result = await userAnalysisResults.loadResult({_id: output.template});\n          API.createData('preferences', result.preferences)\n        }\n        break;\n    default:\n}\n\n\n\nfunction copyPreferences(newPreferences, preferences) {\n    Object.keys(newPreferences).forEach( key => {\n        preferences[key]=JSON.parse(JSON.stringify(newPreferences[key]))\n    })\n}\n\n\n"]}],"libs":[[{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":56,"top":0},"size":{"width":56,"height":43},"zIndex":0,"display":true,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"User analysis actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":6,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"saveResultTemplate"},{"rel":"execute","name":"selectPreferences"},{"rel":"execute","name":"selectRange"},{"rel":"execute","name":"deleteResultTemplate"},{"rel":"execute","name":"loadResultTemplate"},{"rel":"execute","name":"refreshResults"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"User analysis actions","zindex":13},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[2000],"script":["<style>\n    #preferencesForm {\n        padding: 10px;\n    }\n    #preferencesForm .addRow {\n        color: green;\n        font-weight: bold;\n        font-size: 12px;\n        padding: .4em .6em;\n    }\n    #preferencesForm .removeRow {\n        color: red;\n        font-weight: bold;\n        font-size: 12px;\n        padding: .4em .8em;\n    }\n    #preferencesForm h1 {\n        font-size: 16px;\n        padding-top: 12px;\n        padding-bottom: 4px;\n        space\n    }\n    #preferencesForm h2 {\n        font-size: 12px;\n        margin-top: 12px;\n        margin-bottom: 4px;\n        space\n    }\n    #preferencesForm input[type=number]{\n        width: 60px;\n    }\n    #preferencesForm input, #preferencesForm select {\n        margin-top: 3px;\n        margin-bottom: 3px;\n    } \n</style>\n\n<div id='preferencesForm'>\n    <form>\n    <h1>Data / Display</h1>\n        <table>\n            <tr>\n                <td style=\"padding-bottom: 10px\">\n                    Number of components to calculate: <input name = 'pca.nbComponents' type=\"number\" size=\"4\">\n                </td>\n            </tr>\n        </table>\n        <table>\n            <tbody>\n                <tr>\n                    <td><input name =\"mbOptions.fillMode\" onclick=\"showOptions(this);\" size=\"12\" type=\"radio\" value='1'> By block size (ppm) </td>\n                    <td></td>\n                </tr>\n                <tr id=blocksOption>\n                    <td>\n                        <table>\n                            <tr>\n                                <th>step size</th>\n                                <th>Visible</th>\n                            </tr>\n                            <tr>\n                                <td><input name='mbOptions.stepSize' style='width:45px'type='number'></td>\n                                <td><input name='mbOptions.visible' style='width:45px'type='checkbox'></td>\n                            </tr>\n                        </table>\n                    </td>\n                </tr>\n                <tr>\n                    <h2> block options </h2>\n                </tr>\n                <tr>\n                    <td><input name =\"mbOptions.fillMode\" onclick=\"showOptions(this);\" size=\"12\" type=\"radio\" value='2'> Selected blocks <br></td>\n                </tr>\n                <tr>\n                    <td><input name =\"mbOptions.fillMode\" onclick=\"showOptions(this);\" size=\"12\" type=\"radio\" value='3'> Fill the other blocks <br></td>\n                </tr>\n            </tbody>\n     </table>\n        \n    <h1>Normalization</h1>\n    <table>\n        <tr>\n            <th align=\"left\">Range:</th>\n            <td>\n                from: <input type=\"number\" style=\"width: 40px\" name=\"normalization.from\" step=\"any\"> - \n                to: <input type=\"number\" style=\"width: 40px\" name=\"normalization.to\" step=\"any\">\n            </td>\n        </tr>\n        <tr>\n            <th align=\"left\">Number of points:</th>\n            <td>\n                <input type='number' name='normalization.numberOfPoints' size=\"6\">\n            </td>\n        </tr>\n        \n    </table>\n    </form>\n</div>\n\n<script>\n    function showOptions(element) {\n        const value = $(element).val();\n        if (value == 1) {\n            $('#blocksOption').show();\n        } else {\n            $('#blocksOption').hide();\n            require(['src/util/api'], function(API){\n                API.createData('unselectAnnotations', [])\n                API.switchToLayer('Defining blocks');\n            })\n        }\n    }\n</script>\n\n<script>\n    require(['vh/util/twigAdvancedForm'], function(AF) {\n        AF('preferencesForm', {debug:false});\n    });\n</script>\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":63,"height":33},"zIndex":0,"display":true,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":7,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"preferencesTemplate"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Preferences template","zindex":9},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":20,"top":11},"size":{"width":30,"height":36},"zIndex":0,"display":true,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":64,"top":0},"size":{"width":34,"height":25},"zIndex":0,"display":true,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":39,"top":23},"size":{"width":30,"height":25},"zIndex":0,"display":false,"title":"Configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":8,"vars_in":[{"rel":"tpl","name":"preferencesTemplate"},{"rel":"form","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"Select preferences","icon":"fa-tasks","action":"selectPreferences","position":"begin","color":[19,79,92,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Configuration","zindex":13},{"url":"modules/types/edition/object_editor/","configuration":{"sections":{},"groups":{"group":[{"editable":["view"],"expanded":[[]],"storeObject":[[]],"displayValue":[[]],"searchBox":[["search"]],"sendButton":[[]],"output":["new"],"storedObject":["{}"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":115,"top":0},"size":{"width":31,"height":45},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":9,"vars_in":[{"rel":"value","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":13},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[["track"]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["flip","main","sec","display"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[""],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["main","sec"]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"chart","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]},{"variable":"correlationChart","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{height:'100%', fill: 'rgba(255,255,0,0.2)'}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":51,"top":11},"size":{"width":76,"height":36},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"admin"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":67,"top":24},"size":{"width":66,"height":30},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":16,"top":6},"size":{"width":79,"height":30},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":7},"size":{"width":86,"height":54},"zIndex":0,"display":true,"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"admin"}},"id":10,"vars_in":[{"rel":"annotations","name":"rangeAnnotations"},{"rel":"annotations","name":"unselectedAnnotation"},{"rel":"chart","name":"chart"},{"rel":"annotations","name":"filterAnnotations"},{"rel":"chart","name":"boxPlotChart"},{"rel":"annotations","name":"trackAnnotations"},{"rel":"chart","name":"correlationChart"},{"rel":"annotations","name":"correlationAnnotations"}],"actions_in":[{"rel":"fromToX","name":"fromToX2"},{"rel":"fromToX","name":"fromToX3"},{"rel":"fromToX","name":"fromToX4"},{"rel":"fromToX","name":"fromToXBlock"}],"vars_out":[{"event":"onTrackClick","rel":"trackData","jpath":[],"name":"clickedPoint"}],"actions_out":[{"event":"onTrackClick","rel":"dataAndEvent","jpath":[],"name":"trackClicked"},{"event":"onTrackMouse","rel":"dataAndEvent","jpath":[],"name":"trackMove"},{"event":"onZoomChange","rel":"fromToX","jpath":[],"name":"fromToX1"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Print","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Click and drag to zoom in, double click for zoom out. Shift + ALT + click for correlation.","zindex":2},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable","enableAddRow","autoEdit"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":["30"],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Blocks","jpath":["label","label"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":51,"hideColumn":[]},{"name":"Range (ppm)","jpath":[],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"twig:` <div style=\"line-height:normal\">     <table style=\"font-size:xx-small\">         <tr>             <th>From:</th>             <th>To:</th>             <th>Nª points:</th>         </tr>         <tr>             <td>{{rendertype(label.from, {numeral:'0.00'})}}</td>             <td>{{rendertype(label.to, {numeral:'0.00'})}}</td>             <td align='center'>{{rendertype(label.value, {numeral:'0'})}}</td>         </tr>     </table> </div>`","editorOptions":"","width":108,"hideColumn":[]}]],"actionCols":[[{"backgroundColor":[255,255,255,0],"color":[0,0,0,1],"position":"end","clickMode":"text"}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":20,"top":48},"size":{"width":30,"height":39},"zIndex":0,"display":true,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":6},"size":{"width":19,"height":81},"zIndex":0,"display":true,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"compare":{"position":{"left":0,"top":6},"size":{"width":15,"height":81},"zIndex":0,"display":true,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":39,"top":49},"size":{"width":30,"height":37},"zIndex":0,"display":false,"title":"Calculated blocks","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":11,"vars_in":[{"rel":"list","name":"blockScores"}],"actions_in":[{}],"vars_out":[{"event":"onRowActive","rel":"row","jpath":["data"],"name":"selectedBlock"},{"event":"onRowActive","rel":"row","jpath":[],"name":"selectedIndex"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Calculated blocks","zindex":3},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const rangesManager=API.cache('rangesManager');\nif (this.action) {\n    rangesManager.processAction(this.action);\n}\n\nif (this.variable) {\n    switch (this.variable) {\n        case 'ranges': \n            rangesManager.updateAnnotations();\n            break;\n    }\n}\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":195,"top":81},"size":{"width":35,"height":41},"zIndex":0,"display":false,"title":"Ranges manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"admin"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":67,"top":0},"size":{"width":46,"height":23},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":195,"top":81},"size":{"width":35,"height":41},"zIndex":0,"display":false,"title":"Ranges manager","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"admin"}},"id":12,"vars_in":[{"rel":"inputValue","name":"ranges"}],"actions_in":[{"rel":"execute","name":"trackClicked"},{"rel":"execute","name":"trackMove"},{"rel":"execute","name":"deletedRows"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":13},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const findClosestIndex = spectraProcessing.xFindClosestIndex;\nconst ranges = API.getData('ranges');\nconst preferences = API.getData('preferences').resurrect();\nconst xAxis = API.cache('spectraProcessor').getNormalizedData().x;\nconst fillMode = preferences.mbOptions.fillMode;\nconst visible = preferences.mbOptions.visible;\nlet selectedRanges = [];\nlet unselectedAnnotation = [];\nlet blocks = undefined;\nlet spectraInDataset = API.getData('spectraInDataset').resurrect();\nif(spectraInDataset.length === 0) return;\n\n\nswitch(fillMode){\n    case '1': {\n        const stepSize = preferences.mbOptions.stepSize;\n        blocks = [];\n        for (let i = 0; i < 10 / stepSize; i++) {\n            const fromIndex = findClosestIndex(xAxis, i * stepSize);\n            const toIndex = findClosestIndex(xAxis, (i + 1) * stepSize) - 1;\n            if (fromIndex === undefined || toIndex === undefined || toIndex - fromIndex <= 5) continue;\n            unselectedAnnotation.push(\n                createBlockAnnotation(xAxis[fromIndex], xAxis[toIndex], {index: i})\n            )\n            blocks.push({\n                label: `b${ i + 1 }`,\n                fromIndex,\n                toIndex,\n                to: xAxis[toIndex],\n                from: xAxis[fromIndex],\n            })\n        }\n        break\n    }\n    case '2': {\n        API.switchToLayer('Defining blocks');\n        API.createData('unselectedAnnotation', []);\n        if (ranges.length == 0) return;\n        blocks = createDataBlocks(ranges, xAxis, { fillEmpty: false });\n        break\n    }\n    case '3': {\n        API.switchToLayer('Defining blocks');\n        API.createData('unselectedAnnotation', []);\n        if (ranges.length == 0) return;\n        blocks = createDataBlocks(ranges, xAxis);\n        const untargetBlocks = blocks.filter((block) => block.blockType === 'empty');\n        for (let i = 0; i < untargetBlocks.length; i++) {\n            unselectedAnnotation.push(\n                createBlockAnnotation(untargetBlocks[i].from, untargetBlocks[i].to, {index: i})\n            )\n        }\n        break\n    }\n}\n\nconst currentAnnotations = visible ? unselectedAnnotation : [];\nAPI.createData('unselectedAnnotation', currentAnnotations);\nAPI.createData('selectedRanges', selectedRanges);\nAPI.createData('blocks', blocks);\n\nfunction createBlockAnnotation(from, to, options = {}) {\n    const opts = {\n        index: ''\n    };\n    options = Object.assign({}, opts, options);\n    let index = options.index;\n    let result = {\n        position:[{\n            x: from,\n            y: \"0px\",\n        }, {\n            x: to,\n            y: \"2000px\",\n        }],\n        type: \"rect\",\n        fillColor: undefined,\n        strokeColor: \"blue\",\n        _highlight: [Math.random()],\n        info: {\n            from: 1 + index,\n            label: \"blockO\" + String(index),\n            to: 2 + index,\n        },\n        label: [{\n            text: 'b' + String(index + 1),\n            size: \"10px\",\n            anchor: \"middle\",\n            color: \"blue\",\n            position: {\n                x: (from + to) / 2,\n                y: \"50px\"\n            },\n            selectOnClick: true,\n        }]\n    }\n    return result;\n}\n\nfunction createDataBlocks(ranges, x, options = {}){\n    const { fillEmpty = true } = options; \n    let result = [];\n    let next = undefined;\n    ranges = DataObject.resurrect(ranges)\n    ranges = ranges.sort((a, b) => a.from - b.from);\n    for (let i = 0; i < ranges.length; i++) {\n        next = next === undefined ? 0 : next;\n        const fromIndex = findClosestIndex(x, ranges[i].from);\n        const toIndex = findClosestIndex(x, ranges[i].to);\n        if (next !== fromIndex + 1 && fillEmpty) {\n            result.push({\n                label: `b${i}`,\n                blockType: 'empty',\n                value: fromIndex - next,\n                fromIndex,\n                from: x[next],\n                toIndex,\n                to: x[fromIndex]\n            })\n        }\n        result.push({\n            label: ranges[i].label,\n            blockType: 'range',\n            value: toIndex - fromIndex,\n            fromIndex,\n            from: x[fromIndex],\n            toIndex,\n            to: x[toIndex]\n        })\n        next = toIndex;\n    }\n    if (fillEmpty) {\n        const end = result.map(x => x.value).reduce((a, b) => a + b);\n        result.push({\n            label: `e${ranges.length+1}`,\n            blockType: 'empty',\n            value: x.length - end,\n            toIndex: x.length - 1,\n            to: x[x.length - 1],\n            fromIndex: end,\n            from: x[end],\n        });\n    }\n    \n    return result;\n}\n"]}],"libs":[[{"lib":"src/util/ui","alias":"UI"},{"lib":"spectraProcessing","alias":"spectraProcessing"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":145,"top":5},"size":{"width":15,"height":4},"zIndex":0,"display":false,"title":"Joining ranges","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":66,"height":83},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":145,"top":5},"size":{"width":15,"height":4},"zIndex":0,"display":false,"title":"Joining ranges","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":13,"vars_in":[{"rel":"inputValue","name":"preferences"},{"rel":"inputValue","name":"ranges"}],"actions_in":[{"rel":"execute","name":"deleteRange"},{"rel":"execute","name":"trackClicked"},{"rel":"execute","name":"deletedRows"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":13},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const pca = API.getData('pca');\nconst spectraInDataset = API.getData('spectraInDataset').resurrect();\nconst normalized = API.cache('spectraProcessor').getNormalizedData();\nconst xAxis = normalized.x;\nconst dataset = normalized.matrix;\nconst preferences = API.getData('preferences').resurrect();\nconst nbComponents = preferences.pca.nbComponents;\nconst blocks = DataObject.resurrect(API.getData('blocks'));\nconst dataBlocks = DataObject.resurrect(API.getData('dataBlocks'));\nconst selectedRanges = API.getData('selectedRanges');\nlet pcaBlocks = API.getData('pcaBlocks');\nif (pca === null) return;\n\nif (DataObject.resurrect(selectedRanges).length !== 0) {\n  let list = DataObject.resurrect(selectedRanges);\n  let filteredPca = [];\n  let filteredData = [];\n  for (let element of list) {\n      filteredPca.push(pcaBlocks.filter((item) => item.means.length === element.value))\n      filteredData.push(dataBlocks.filter((item) => item.means.length === element.value))\n  }\n  pcaBlocks = filteredPca;\n  dataBlocks = filteredData;\n}\n\nlet unselected = spectraInDataset.map(\n  (entry, index) => {\n    let spectrum = spectraInDataset\n        .filter((spectrum) => String(spectrum.id) === spectraInDataset[index].id)[0];\n    return {\n      shape: 'circle',\n      fill: entry.color,\n      r: 3\n    };\n  }\n);\n\nlet rendererStyle = {\n  marker: {\n    default: {},\n    modifiers: unselected\n  }\n};\n\nconst projection = pca.predict(dataset);\nconst explainedVariance = pca.getExplainedVariance();\nlet blockScores = new Array({\n  index: String(0),\n  label: {\n    label: 'Loading',\n    value: xAxis.length,\n    from: xAxis[0],\n    to: xAxis[xAxis.length - 1],\n    blockType: 'fullSpectra'\n  },\n  data: buildGrid(projection, explainedVariance, nbComponents)\n});\n\nlet ranges = API.getData('ranges')\nlet unselectedRanges = API.getData('unselectedAnnotation');\n\nif (pcaBlocks) {\n  for (let k = 0; k < pcaBlocks.length; k++) {\n    let dataBlock = dataBlocks[k];\n    let eVariance = pcaBlocks[k].getExplainedVariance();\n    let projection = pcaBlocks[k].predict(dataBlock);\n    let blocksGrid = buildGrid(projection, eVariance, nbComponents);\n    blocks[k].value = blocks[k].toIndex - blocks[k].fromIndex;\n    blockScores.push({\n      index: String(k + 1),\n      label: blocks[k],\n      data: blocksGrid\n    });\n  }\n}\n\nAPI.createData('blockScores', blockScores);\n\nfunction buildGrid(projection, eVariance, nbComponents, options = {}) {\n  let {\n    ellipse = true\n  } = options;\n  let grid = [];\n  for (let i = 0; i < nbComponents; i++) {\n    grid[i] = [];\n    for (let j = 0; j < nbComponents; j++) {\n      const x = projection.getColumn(i);\n      const y = projection.getColumn(j);\n      let annotations = [];\n      if (ellipse) {\n        addScorePosition(x, y, spectraInDataset);\n        let categories = getCategories(spectraInDataset);\n        let categoriesArray = Object.keys(categories).map((key) => categories[key]);\n        categoriesArray = categoriesArray.filter((entry) => entry.data.length > 2);\n        annotations = getEllipseAnnotation(categoriesArray, preferences);\n      }\n      grid[i][j] = {\n        title: `PCA PC ${i + 1} vs ${j + 1\n        } (${Number((eVariance[i] + eVariance[j]) * 100).toFixed(2)}%)`,\n        axes: {\n          x: {\n            label: `PC ${i + 1} (${Number(eVariance[i] * 100).toFixed(2)}%)`\n          },\n          y: {\n            label: `PC ${j + 1} (${Number(eVariance[j] * 100).toFixed(2)}%)`\n          }\n        },\n        series: [\n          {\n            type: 'scatter',\n            data: {\n              x,\n              y\n            },\n            annotations: annotations,\n            style: rendererStyle\n          }\n        ]\n      };\n    }\n  }\n  return grid;\n}\n\nfunction getCategories(spectraInDataset) {\n  let categories = {};\n  for (let spectrum of spectraInDataset) {\n    let category = String(spectrum.category);\n    if (!spectrum.pca) continue;\n    if (!categories[category]) {\n      categories[category] = {\n        category: category,\n        color: spectrum.color,\n        data: []\n      };\n    }\n    categories[category].data.push(spectrum.pca);\n  }\n  return categories;\n}\n\nfunction getEllipseAnnotation(categoriesArray, preferences) {\n  let annotations = [];\n  if (preferences.pca.ellipse) {\n    for (let category of categoriesArray) {\n      const x = category.data.map((datum) => datum.x);\n      const y = category.data.map((datum) => datum.y);\n      const annotation = Ellipse.getEllipse({ x, y }, {\n        nbSD: Number(preferences.pca.sd),\n        props: {\n          fillOpacity: 0.2,\n          fillColor: String(category.color),\n          label: {}\n        }\n      });\n      if (preferences.pca.ellipseCategory) {\n        annotation.label = [\n          {\n            text: String(category.category),\n            size: 14,\n            anchor: 'right',\n            color: String(category.color),\n            position: {\n              x: annotation.properties.position[0].x,\n              y: annotation.properties.position[0].y\n            }\n          }\n        ];\n      }\n      annotations.push(annotation);\n    }\n  }\n  return annotations;\n}\n\nfunction addScorePosition(x, y, spectraInDataset) {\n  for (let i = 0; i < spectraInDataset.length; i++) {\n    let currentID = spectraInDataset[i].id;\n    let spectrum = spectraInDataset.filter((spectrum) => String(spectrum.id) === currentID)[0];\n    spectrum.pca = {\n      x: x[i],\n      y: y[i]\n    };\n    let label=undefined;\n    if (preferences.pca.displayID && spectrum.selected) {\n      label = {\n        text: spectrum.id,\n        position: { x: x[i], y: y[i]},\n      }\n    }\n  }\n}\n\n"]}],"libs":[[{"lib":"Ellipse","alias":"Ellipse"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"PCx vs PCy scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":58,"top":55},"size":{"width":55,"height":29},"zIndex":0,"display":true,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":114,"top":19},"size":{"width":55,"height":33},"zIndex":0,"display":false,"title":"Create grids","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"PCx vs PCy scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":14,"vars_in":[{"rel":"inputValue","name":"pca"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Create grids","zindex":13},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const Matrix = ML.Matrix;\nconst pca = API.getData('pca');\nif (pca === null) return;\nconst fullLoading = pca.getEigenvectors().transpose();\nconst pcaBlocks = API.getData('pcaBlocks');\nconst originalBlocks = DataObject.resurrect(API.getData('dataBlocks'));\nconst selectedIndex = DataObject.resurrect(API.getData('selectedIndex'));\nconst spectraInDataset = API.getData('spectraInDataset').resurrect();\nconst preferences = API.getData('preferences').resurrect();\nconst normalized = API.cache('spectraProcessor').getNormalizedData();\nconst xAxis = normalized.x;\nconst dataset = normalized.matrix;\nlet projection;\n\nif (!selectedIndex) return;\nif (selectedIndex.label.label === 'Loading') {\n    projection = pca.predict(new Matrix(dataset))\n} else {\n    projection = pcaBlocks[selectedIndex.index - 1].predict(originalBlocks[selectedIndex.index - 1])\n}\n\nlet x = projection.getColumn(preferences.pca.x);\nlet y = projection.getColumn(preferences.pca.y);\n\nvar selected = normalized.meta.map(\n    entry => {\n         return {\n            shape: \"circle\",\n            stroke: entry.color,\n            r: 5\n        }\n    }\n)\n\nvar unselected = normalized.meta.map(\n    (entry,index) => {\n        let spectrum = DataObject.resurrect(spectraInDataset.filter( spectrum => String(spectrum.id)===normalized.ids[index])[0]);\n        if (spectrum.pcaModel) {\n            return {\n                shape: \"circle\",\n                fill: entry.color,\n                r: (spectrum.selected) ? 4 : 2,\n            }\n        }\n        return {\n            shape: \"circle\",\n            stroke: entry.color,\n            fill: 'white',\n            r: (spectrum.selected) ? 4 : 2,\n        }\n    }\n)\n\nlet styles={\n    unselected,\n    selected: selected\n}\n\nlet plot = {\n    title: 'main data',\n    data: [{\n        x, \n        y, \n        styles, \n        info: normalized.ids.map( (id,index) => {\n            return {\n                id,\n                meta: normalized.meta[index]\n            }\n        }),\n        type: 'scatter',\n    }]\n};\n\n\n\nAPI.createData('pcaScorePlot', plot);\n\nlet pcaAnnotations = [];\nfor (let i = 0; i < spectraInDataset.length; i++) {\n  let currentID = spectraInDataset[i].id;\n  let spectrum = spectraInDataset.filter((spectrum) => String(spectrum.id) === currentID)[0];\n  spectrum.pca = {\n    x: x[i],\n    y: y[i]\n  };\n  let label=undefined;\n  if (preferences.pca.displayID && spectrum.selected) {\n    label = {\n      text: spectrum.id,\n      position: { x: x[i], y: y[i]},\n    }\n  }\n  pcaAnnotations.push({\n    _highlight: [spectrum._highlight],\n    type: 'ellipse',\n    position: [\n      {\n        x: x[i],\n        y: y[i]\n      }\n    ],\n    props: {\n      rx: '6px',\n      ry: '6px'\n    },\n    strokeWidth: '0px',\n    fillColor: 'rgba(0,0,0,0)',\n    info: spectrum,\n    label,\n  });\n}\n\nlet categories = {};\n\nfor (let spectrum of spectraInDataset) {\n  let category = String(spectrum.category);\n  if (!categories[category]) {\n    categories[category] = {\n      category: category,\n      color: spectrum.color,\n      data: []\n    };\n  }\n  categories[category].data.push(spectrum.pca);\n}\n\nlet categoriesArray = Object.keys(categories).map((key) => categories[key]);\ncategoriesArray = categoriesArray.filter((entry) => entry.data.length > 2);\n\nlet annotations = [];\nif (preferences.pca.ellipse) {\n  for (let category of categoriesArray) {\n    const x = category.data.map((datum) => datum.x);\n    const y = category.data.map((datum) => datum.y);\n    const annotation = Ellipse.getEllipse({ x, y }, {\n      nbSD: Number(preferences.pca.sd),\n      props: {\n        fillOpacity: 0.2,\n        fillColor: String(category.color),\n        label: {}\n      }\n    });\n    if (preferences.pca.ellipseCategory) {\n      annotation.label = [\n        {\n          text: String(category.category),\n          size: 14,\n          anchor: 'right',\n          color: String(category.color),\n          position: {\n            x: annotation.properties.position[0].x,\n            y: annotation.properties.position[0].y\n          }\n        }\n      ];\n    }\n    annotations.push(annotation);\n  }\n}\n\nAPI.createData('pcaAnnotations', pcaAnnotations);\nAPI.createData('ellipsis', annotations);\n\n"]}],"libs":[[{"lib":"ML","alias":"ML"},{"lib":"Ellipse","alias":"Ellipse"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":80,"top":89},"size":{"width":73,"height":72},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":114,"top":0},"size":{"width":56,"height":33},"zIndex":0,"display":true,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":114,"top":0},"size":{"width":56,"height":18},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":80,"top":89},"size":{"width":73,"height":72},"zIndex":0,"display":false,"title":"Scores plot","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":15,"vars_in":[{"rel":"inputValue","name":"pca"},{"rel":"inputValue","name":"selectedIndex"},{"rel":"inputValue","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Scores plot","zindex":13},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[1000],"script":["<style> \n#selectedBlock .grid {\n  display: flex;                       /* establish flex container */\n  flex-wrap: wrap;                     /* enable flex items to wrap */\n  max-width: 200%;\n  justify-content: space-around;\n  \n}\n#selectedBlock .cell {\n  flex: 0 0 25%;                  /* don't grow, don't shrink, width */\n  max-width: 25%;\n  height: 220px;\n  margin-bottom: 5px;\n}\n</style>\n<div id=\"selectedBlock\"> \n    <div class=\"grid\">\n        {% for i in 0..3 %}\n            {% for j in 0..3 %}\n                <div class=\"cell\">{{rendertypeBlock(selectedBlock[i][j],'chart')}}</div>\n            {% endfor %}\n        {% endfor %}\n    </div>\n</div>\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":64},"size":{"width":63,"height":21},"zIndex":0,"display":true,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Scores plot grid template","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":16,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"selectedBlockTemplate"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Scores plot grid template","zindex":13},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":123,"top":39},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":20,"top":6},"size":{"width":85,"height":81},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":20,"top":6},"size":{"width":85,"height":81},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":17,"vars_in":[{"rel":"value","name":"selectedBlock"},{"rel":"tpl","name":"selectedBlockTemplate"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Show fullscreen","Print"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":18},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let pca = API.getData('pca');\nif (pca === null) return;\nlet pcaBlocks = API.getData('pcaBlocks');\nlet dataBlocks = API.getData('dataBlocks');\nlet selectedIndex = API.getData('selectedIndex');\n\nlet pcaData;\nif (selectedIndex) {\n  let blockScores = API.getData('blockScores').resurrect();\n  let labels = blockScores.map((item) => item.label.label);\n  let index = labels.findIndex((x) => x === DataObject.resurrect(selectedIndex).label.label);\n  pcaData = index !== 0 ? pcaBlocks[index - 1] : pca;\n} else {\n  pcaData = pca;\n}\n\nconst normalized = API.cache('spectraProcessor').getNormalizedData();\nconst normalizedX = JSON.parse(JSON.stringify(normalized.x));\n\nlet color = ['#0023FF', '#17FF00', '#FF2E00', '#9E00FF'];\n\nlet explainedVariance = pcaData.getExplainedVariance().slice(0, 10);\nAPI.createData('explainedVariance', {\n  x: Array(10).fill().map((item, index) => index + 1),\n  y: [0].concat(explainedVariance) }\n);\n\nlet cumulativeVariance = {\n  x: Array(10).fill().map((item, index) => index + 1),\n  y: [0].concat(pcaData.getCumulativeVariance().slice(0, 10))\n};\n\nAPI.createData('cumulativeVariance', cumulativeVariance);\nAPI.createData('CumulativeVariance10',\n  cumulativeVariance.y[cumulativeVariance.y.length - 1]\n);\n\nlet stdevs = pca.stdevs;\nlet min = ML.Array.min(stdevs);\nlet max = ML.Array.max(stdevs);\nlet scale = Chroma.scale(['blue', 'red']).domain([min, max]).mode('hsl');\n\nlet stdevsColor = {\n  x: normalizedX,\n  y: JSON.parse(JSON.stringify(normalized.matrix[0])), // performance issues\n  color: stdevs.map((val) => scale(val).hex())\n};\n\nAPI.createData('color', stdevsColor);\nlet blocksStd = [];\nlet counter = 0;\nfor (let i = 0; i < pcaBlocks.length; i++) {\n    let blockAxis = new Array(dataBlocks[i].columns)\n        .fill().map((item, index) => normalizedX[counter + index])\n    let blockStdevs = pcaBlocks[i].stdevs;\n    let blockMin = ML.Array.min(blockStdevs);\n    let blockMax = ML.Array.max(blockStdevs);\n    let blockScale = Chroma.scale(['blue', 'red'])\n        .domain([blockMin, blockMax]).mode('hsl');\n    blocksStd.push({\n        x: blockAxis,\n        y: Array.from(dataBlocks[i].data[0]), // performance issues\n        color: blockStdevs.map((val) => blockScale(val).hex())\n    })\n    counter += dataBlocks[i].columns;\n    \n}\n\nAPI.createData('blocksStd', blocksStd);\n"]}],"libs":[[{"lib":"ML","alias":"ML"},{"lib":"chroma","alias":"Chroma"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":58,"top":34},"size":{"width":55,"height":20},"zIndex":0,"display":true,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":111,"top":67},"size":{"width":55,"height":22},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Create pca charts","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":18,"vars_in":[{"rel":"inputValue","name":"pca"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Create pca charts","zindex":49},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const correlation = ML.MatrixLib.correlation;\nconst covariance = ML.MatrixLib.covariance;\nconst Matrix = ML.Matrix;\nif (!API.getData('pca') || API.getData('pca') === null) return;\nif (!API.getData('pcaBlocks') || API.getData('pcaBlocks') === null) return;\nconst normalized = API.cache('spectraProcessor').getNormalizedData();\nconst spectraInDataset = API.getData('spectraInDataset').resurrect();\nconst dataset = normalized.matrix;\nconst pca = API.getData('pca');\nconst pcaBlocks = API.getData('pcaBlocks').resurrect();\nconst originalBlocks = API.getData('dataBlocks').resurrect();\nconst xAxis = normalized.x;\nconst centered = new Matrix(normalized.matrix).center('column');\nconst scores = pca.predict(centered);\nconst loadings = covariance(scores, centered);\nconst loadingsColor = correlation(scores, centered).abs();\nlet result = [];\nconst min = [];\nconst max = [];\nfor (let i = 0; i < loadingsColor.rows; i++) {\n    min.push(loadingsColor.minRow(i))\n    max.push(loadingsColor.maxRow(i))\n}\n\n// Builds colored loadings\nfor (let i = 0; i < loadings.rows; i++) {\n    console.log(`Loading ${i + 1} of ${loadings.rows}`);\n    let selected = {\n        lineColor: \"rgb(230,0,0)\",\n        lineStyle: 1,\n        lineWidth: 1,\n    };\n    let max = loadingsColor.data[i].reduce(function(a, b) {\n        return Math.max(a, b);\n    });\n    let min = loadingsColor.data[i].reduce(function(a, b) {\n        return Math.min(a, b);\n    });\n\n    let unselectedScale = chroma.scale(['blue', 'cyan',  'yellow', 'red'])\n        .domain([min, max]).mode('lch');\n    let colorScale = Array.from(loadingsColor.data[i])\n        .map((x, j) => unselectedScale(x));\n    let spectra = {\n        type: 'color',\n        x: xAxis,\n        y: Array.from(loadings.data[i]),\n        color: colorScale\n    };\n    result.push({\n        id: i,\n        loading: spectra\n    })\n}\n\nAPI.createData('loadingsResult', result);\n\n// Builds colored block loadings\nresult = [];\nlet counter = 0;\nlet index = 8;\nlet correlationArray = [];\nlet covarianceArray = [];\nfor (let i = 0; i < pcaBlocks.length; i++) {\n    console.log(`Block ${i + 1} of ${pcaBlocks.length}`);\n    let blockResult = [];\n    const blockCentered = new Matrix(originalBlocks[i]).center('column');\n    let score = pcaBlocks[i].predict(blockCentered.clone());\n    let blockLoading = covariance(score, blockCentered.clone());\n    let blockLoadingColor = correlation(score, blockCentered.clone()).abs();\n    let corrArray = [];\n    let covArray = [];\n    for (let j = 0; j < blockLoading.rows; j++) {\n        let blockAxis = new Array(blockLoadingColor.columns)\n            .fill().map((item, index) => xAxis[counter + index]);\n        let max = blockLoadingColor.data[j].reduce(function(a, b) {\n            return Math.max(a, b);\n        });\n        let min = blockLoadingColor.data[j].reduce(function(a, b) {\n            return Math.min(a, b);\n        });\n        let scaledColor = Array.from(blockLoadingColor.data[j]);\n        \n        let unselectedScale = chroma.scale(['blue', 'cyan',  'yellow', 'red'])\n            .domain([min, max]).mode('lch');\n            \n        let colorScale = Array.from(blockLoadingColor.data[j])\n            .map((x, j) => unselectedScale(x));\n\n        let spectra = {\n            type: 'color',\n            x: blockAxis,\n            y: Array.from(blockLoading.data[j]),\n            'color': colorScale\n        }\n        blockResult.push(spectra);  \n    }\n    counter += originalBlocks[i].columns;\n    result.push({\n        id: i,\n        block: blockResult\n    });\n};\n\nfunction oneScale(blockLoadingColor) {\n    const min = Math.min(...Array.from(blockLoadingColor));\n    const max = Math.max(...Array.from(blockLoadingColor));\n    let result = [];\n    for (let i = 0; i < blockLoadingColor.length; i++) {\n        const module =  Math.abs(max) > Math.abs(min) ?\n            Math.abs(max): Math.abs(min);\n        result[i] = (module + blockLoadingColor[i]) / (Math.abs(min) + Math.abs(max))\n    }\n    return result\n}\n\nAPI.createData('blockLoadingsResult', result);\n"]}],"libs":[[{"lib":"https://www.lactame.com/lib/ml/5.1.0/ml.js","alias":"ML"},{"lib":"chroma","alias":"chroma"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":89},"size":{"width":60,"height":38},"zIndex":0,"display":false,"title":"builds colored loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":114,"top":34},"size":{"width":56,"height":50},"zIndex":0,"display":true,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":88},"size":{"width":53,"height":64},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":65,"top":90},"size":{"width":93,"height":76},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":58,"top":19},"size":{"width":55,"height":33},"zIndex":0,"display":false,"title":"builds reconstructed loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":89},"size":{"width":60,"height":38},"zIndex":0,"display":false,"title":"builds colored loadings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":19,"vars_in":[{"rel":"inputValue","name":"pca"}],"actions_in":[{"rel":"execute","name":"reloadLoading"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"builds reconstructed loadings","zindex":45},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<div>\n    <table>\n        <tr>\n            <td>\n                MBPCA Component: <select name='numberOfBlockLoading'>\n                    <option value=\"\"></option>\n                    <option value=\"0\">PC 1</option>\n                    <option value=\"1\">PC 2</option>\n                    <option value=\"2\">PC 3</option>\n                    <option value=\"3\">PC 4</option>\n                    <option value=\"4\">PC 5</option>\n                    <option value=\"5\">PC 6</option>\n                    <option value=\"6\">PC 7</option>\n                    <option value=\"7\">PC 8</option>\n                    <option value=\"8\">PC 9</option>\n                    <option value=\"9\">PC 10</option>\n            \n                </select>\n            </td>\n            <td>\n                PCA Component: <select name='numberOfLoading'>\n                    <option value=\"\"></option>\n                    <option value=\"0\">PC 1</option>\n                    <option value=\"1\">PC 2</option>\n                    <option value=\"2\">PC 3</option>\n                    <option value=\"3\">PC 4</option>\n                    <option value=\"4\">PC 5</option>\n                    <option value=\"5\">PC 6</option>\n                    <option value=\"6\">PC 7</option>\n                    <option value=\"7\">PC 8</option>\n                    <option value=\"8\">PC 9</option>\n                    <option value=\"9\">PC 10</option>\n                </select>\n            </td>\n        </tr>\n    </table>\n</div>"],"modifyInForm":[["yes"]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":64,"top":37},"size":{"width":50,"height":6},"zIndex":0,"display":true,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":120,"top":3},"size":{"width":35,"height":5},"zIndex":0,"display":true,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":38,"top":6},"size":{"width":35,"height":5},"zIndex":0,"display":true,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":20,"vars_in":[{"rel":"form","name":"mbSettings"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Loadings display settings","zindex":13},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":106,"top":26},"size":{"width":63,"height":20},"zIndex":0,"display":true,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":16,"top":37},"size":{"width":79,"height":24},"zIndex":0,"display":true,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":6},"size":{"width":84,"height":25},"zIndex":0,"display":true,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Full spectra)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":21,"vars_in":[{"rel":"chart","name":"coloredSpectra"}],"actions_in":[{"rel":"fromToX","name":"fromToX1"},{"rel":"fromToX","name":"fromToX3"},{"rel":"fromToX","name":"fromToXBlock"}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onZoomChange","rel":"fromToX","jpath":[],"name":"fromToX2"}],"toolbar":{"custom":[[{"title":"reload","icon":"fa-sync","action":"reloadLoading","position":"begin","color":[152,0,0,1]}]],"common":[{"toolbar":[["Print","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Reconstructed loading (Full spectra)","zindex":12},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const selectedIndex = API.getData('selectedIndex');\nconst loadingsResult = API.getData('loadingsResult');\nconst blockLoadingsResult = API.getData('blockLoadingsResult');\nif (!selectedIndex || !loadingsResult || !blockLoadingsResult) return;\nconst blocksStd = API.getData('blocksStd').resurrect();\nconst mbSettings = API.getData('mbSettings').resurrect();\nconst numberOfBlockLoading = mbSettings.numberOfBlockLoading;\nconst numberOfLoading = mbSettings.numberOfLoading;\nconst coloredSpectra = loadingsResult[parseInt(numberOfLoading)].loading;\nif (!blockLoadingsResult[selectedIndex.index - 1]) return\nconst blockColoredSpectra = blockLoadingsResult[selectedIndex.index - 1]\n    .block[numberOfBlockLoading]\n\n\nlet loadingBlocks = blockLoadingsResult[selectedIndex.index - 1].block;\nfor (let i = 0; i < loadingBlocks.length; i++) {\n    API.createData(`blockLoadings${i}`, loadingBlocks[i])\n}\n\nAPI.createData('coloredSpectra', coloredSpectra);\nAPI.createData('blockColoredSpectra', blockColoredSpectra);\nAPI.createData('blockStd', blocksStd[parseInt(selectedIndex.index) - 1]);\n\n\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":58,"top":0},"size":{"width":55,"height":33},"zIndex":0,"display":true,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":56,"top":113},"size":{"width":54,"height":43},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":1,"top":206},"size":{"width":70,"height":34},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":134},"size":{"width":63,"height":55},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loadings display settings","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":22,"vars_in":[{"rel":"inputValue","name":"mbSettings"},{"rel":"inputValue","name":"blockLoadingsResult"},{"rel":"inputValue","name":"loadingsResult"},{"rel":"inputValue","name":"selectedIndex"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Loadings display settings","zindex":51},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":63,"top":89},"size":{"width":53,"height":30},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":106,"top":47},"size":{"width":63,"height":19},"zIndex":0,"display":true,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":16,"top":62},"size":{"width":79,"height":26},"zIndex":0,"display":true,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":63,"top":89},"size":{"width":53,"height":30},"zIndex":0,"display":false,"title":"Reconstructed loading (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":23,"vars_in":[{"rel":"chart","name":"blockColoredSpectra"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onZoomChange","rel":"fromToX","jpath":[],"name":"fromToXBlock"}],"toolbar":{"custom":[[{"title":"reload","icon":"fa-sync","action":"reloadBlockLoading","position":"begin","color":[152,0,0,1]}]],"common":[{"toolbar":[["Print","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Reconstructed loading (Selected block)","zindex":13},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[["track"]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","main","sec"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display","main","sec"]],"label":["Explained"],"beforeSpacing":["0"],"afterSpacing":[0],"min":["0"],"max":["1"],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"explainedVariance","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"discrete","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]},{"variable":"cumulativeVariance","axis":"0","adaptTo":"none","plotcolor":[255,0,10,0.53],"strokewidth":"3","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":1,"top":90},"size":{"width":63,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":96,"top":6},"size":{"width":73,"height":30},"zIndex":0,"display":true,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Cumulative variance","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":24,"vars_in":[{"rel":"chart","name":"explainedVariance"},{"rel":"chart","name":"cumulativeVariance"}],"actions_in":[{}],"vars_out":[{"event":"onTrackMouse","rel":"trackData","jpath":[],"name":"varianceTracking"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Print","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Cumulative variance","zindex":8},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":106,"top":6},"size":{"width":63,"height":19},"zIndex":0,"display":true,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":96,"top":37},"size":{"width":73,"height":24},"zIndex":0,"display":true,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Full spectrum)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":25,"vars_in":[{"rel":"chart","name":"color"}],"actions_in":[{"rel":"fromToX","name":"fromToX1"},{"rel":"fromToX","name":"fromToX2"},{"rel":"fromToX","name":"fromToXBlock"}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onZoomChange","rel":"fromToX","jpath":[],"name":"fromToX3"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Print","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Colored standard deviation on average spectrum (Full spectrum)","zindex":11},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["Cumulative variance ({{cumulativeVariance.x.length - 1}} PC): {{rendertype(CumulativeVariance10, {numeral: '0.00%'})}}\n{% if varianceTracking.explainedVariance %}\n- \nPC{{varianceTracking.explainedVariance.xClosest}}:\n{{rendertype(varianceTracking.explainedVariance.yClosest,{numeral:'0.00%'})}} - cumulative:\n{{rendertype(varianceTracking.cumulativeVariance.yClosest,{numeral:'0.00%'})}} \n{% endif %}"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":119,"top":91},"size":{"width":46,"height":6},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":107,"top":9},"size":{"width":48,"height":3},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":26,"vars_in":[{"rel":"value","name":"varianceTracking"},{"rel":"value","name":"CumulativeVariance10"},{"rel":"value","name":"cumulativeVariance"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":10},{"url":"modules/types/client_interaction/dragdrop/","configuration":{"sections":{},"groups":{"group":[{"label":["Drop your file here"],"dragoverlabel":[null],"hoverlabel":["Drag'n drop or paste here"],"fileSelectLabel":["Select file"],"labelFontSize":[26],"checkOptions":[["promptAmbiguous"]],"inputOptions":[["allowDrop","allowPaste","allowFileInput"]]}],"vars":[[{"filter":"ext","extension":"*","filetype":"text","type":"","variable":"file"}]],"string_general":[{"askFilename":[[]]}],"string":[[{"filter":"ext","extension":"*","type":"","variable":"str"}]],"photo":[[{"variable":"photo"}]]}},"layers":{"Default layer":{"position":{"left":61,"top":89},"size":{"width":32,"height":10},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":61,"top":89},"size":{"width":32,"height":10},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":27,"vars_out":[{"event":"onRead","rel":"dataarray","jpath":[],"name":"dropped"}],"vars_in":[],"actions_in":[{}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":13},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","enableAddRow","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":["30"],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Label","jpath":["$id","3"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":30,"hideColumn":[]},{"name":"Ranges","jpath":["data"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"twig:`<div style=\"line-height:normal\"><table style=\"font-size:xx-small\"><b>Ranges</b>{% for item in ranges %}<tr><td>{{item.label}}</td></tr>{%endfor%}</table></div>`","editorOptions":"","width":"50","minWidth":"50","maxWidth":"50","hideColumn":[]}]],"actionCols":[[{"name":"🗑","tooltip":"Delete result","icon":"fa-trash","backgroundColor":[255,255,255,0],"color":[0,0,0,1],"action":"deleteResultTemplate","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":48},"size":{"width":19,"height":39},"zIndex":0,"display":true,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":72},"size":{"width":38,"height":14},"zIndex":0,"display":false,"title":"Load / save configuration","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":28,"vars_in":[{"rel":"list","name":"analysisTemplates"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"loadResultTemplate"}],"toolbar":{"custom":[[{"title":"Save template","icon":"fa-save","action":"saveResultTemplate","position":"begin","color":[12,52,61,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Load / save configuration","zindex":13},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","editable","forgetLastActive","enableAddRow"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[["remove"]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Label","jpath":["label"],"editor":"string","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":"40","minWidth":"40","maxWidth":"40","hideColumn":[]},{"name":"from","jpath":["from"],"editor":"number","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"toPrecision: 3","editorOptions":"","hideColumn":[]},{"name":"to","jpath":["to"],"editor":"number","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"toPrecision: 3","editorOptions":"","hideColumn":[]}]],"actionCols":[[{"backgroundColor":[255,255,255,0],"color":[0,0,0,1],"position":"end","clickMode":"text"}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":154,"top":10},"size":{"width":14,"height":40},"zIndex":0,"display":false,"title":"List of ranges","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"admin"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":87,"top":7},"size":{"width":24,"height":54},"zIndex":0,"display":true,"title":"List of ranges","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"admin"}},"id":29,"vars_in":[{"rel":"list","name":"ranges"}],"actions_in":[{}],"vars_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"rangeClicked"},{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"rangeSelected"},{"jpath":[]}],"actions_out":[{"event":"onRowsDelete","rel":"rows","jpath":[],"name":"deletedRows"},{"event":"onSelect","rel":"row","jpath":[],"name":"rangeClicked"}],"toolbar":{"custom":[[{"title":"Reload ranges","icon":"fa-tasks","action":"selectRange","position":"begin","color":[12,52,61,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"List of ranges","zindex":25},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":117,"top":89},"size":{"width":52,"height":30},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":106,"top":67},"size":{"width":63,"height":20},"zIndex":0,"display":true,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":96,"top":62},"size":{"width":73,"height":26},"zIndex":0,"display":true,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":85,"top":6},"size":{"width":84,"height":25},"zIndex":0,"display":true,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":117,"top":89},"size":{"width":52,"height":30},"zIndex":0,"display":false,"title":"Colored standard deviation on average spectrum (Selected block)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":30,"vars_in":[{"rel":"chart","name":"blockStd"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Print","Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Colored standard deviation on average spectrum (Selected block)","zindex":13},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["none"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":69,"top":113},"size":{"width":73,"height":24},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":32},"size":{"width":84,"height":28},"zIndex":0,"display":true,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC1)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":31,"vars_in":[{"rel":"chart","name":"blockLoadings0"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Block loading (PC1)","zindex":9},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["none"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":69,"top":138},"size":{"width":75,"height":30},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":85,"top":32},"size":{"width":84,"height":28},"zIndex":0,"display":true,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC2)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":32,"vars_in":[{"rel":"chart","name":"blockLoadings1"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Block loading (PC2)","zindex":9},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["none"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":69,"top":175},"size":{"width":77,"height":18},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":61},"size":{"width":84,"height":28},"zIndex":0,"display":true,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC3)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":33,"vars_in":[{"rel":"chart","name":"blockLoadings2"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Block loading (PC3)","zindex":9},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["none"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[[]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":69,"top":200},"size":{"width":81,"height":21},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":85,"top":61},"size":{"width":84,"height":27},"zIndex":0,"display":true,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Block loading (PC4)","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":34,"vars_in":[{"rel":"chart","name":"blockLoadings3"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Block loading (PC4)","zindex":9},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<div>{{activatedElement.name}}</div>\n<div>{{ rendertype(activatedElement.molfile,{width:200, height:200},'mol2d') }}</div>"],"modifyInForm":[["yes"]],"debouncing":[1000],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":35,"vars_in":[{"rel":"value","name":"activatedElement"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":8},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["this.getButton('calculate').setColor('blue');\n\nif (this.button === 'calculate') {\n    API.doAction('calculate')\n}\n"]}],"libs":[[{}]],"buttons":[[{"name":"calculate","label":"Calculate / Recalculate PCA","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":42,"top":4},"size":{"width":21,"height":4},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":25,"top":102},"size":{"width":33,"height":12},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":68,"top":5},"size":{"width":21,"height":4},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":36,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":4},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const roc=API.cache('roc');\nconst spectraInDataset = API.getData('spectraInDataset');\n\nconst spectraDataSet=API.cache('spectraDataSet');\n\nconst value=this.action.value;\n\nswitch (this.action.name) {\n    case 'trackClicked': {\n        console.log('trackClicked')\n        if (value.event.altKey && value.event.shiftKey) {\n            console.log('pass')\n            let key=Object.keys(value.data)[0];\n            let preferences=API.getData('preferences');\n            preferences.display.correlationIndex=value.data[key].indexClosest;\n            preferences.display.correlationX=value.data[key].xExact;\n            if (! String(preferences.display.correlation)) {\n                preferences.display.correlation=\"selected\";\n                preferences.display.selection=\"none\";\n            }\n            preferences.triggerChange();\n        }\n        break;\n    }\n    case 'trackMove': {\n        let displayPreferences = API.getData('preferences').display.resurrect();\n        const trackMove = this.action.value.data.chart;\n        if (! trackMove || ! displayPreferences.trackingInfo || displayPreferences.original==='true') {\n            API.createData('trackAnnotations', []);\n            return;\n        }\n        const spectraProcessor=API.cache('spectraProcessor');\n        const annotations=spectraProcessor.getTrackAnnotation(trackMove.indexBefore)\n        API.createData('trackAnnotations', annotations)\n        break;\n    }\n    default:\n        // await spectraDataSet.processAction(this.action);\n}\n"]}],"libs":[[{"lib":"vh/eln/Sample","alias":"Sample"},{"lib":"src/util/color","alias":"Color"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":55,"height":43},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":37,"top":24},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":37,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"clickedSample"},{"rel":"execute","name":"addSelectedSamples"},{"rel":"execute","name":"addSample"},{"rel":"execute","name":"addSpectrum"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"clearSelectedSamples"},{"rel":"execute","name":"clickedPCAShape"},{"rel":"execute","name":"deletePCASelection"},{"rel":"execute","name":"addSpectraToSelection"},{"rel":"execute","name":"selectAllSpectra"},{"rel":"execute","name":"hideAllSpectra"},{"rel":"execute","name":"hideSpectra"},{"rel":"execute","name":"selectCurrentSpectraSelection"},{"rel":"execute","name":"forceRecolor"},{"rel":"execute","name":"selectCategory"},{"rel":"execute","name":"SetTarget"},{"rel":"execute","name":"trackClicked"},{"rel":"execute","name":"trackMove"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":6},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const spectraInDatasetModifications = await API.require('vh/eln/sample/ml/spectraInDatasetModifications');\n\nspectraInDatasetModifications();\n\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":32,"top":33},"size":{"width":43,"height":40},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":44},"size":{"width":55,"height":15},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":32,"top":33},"size":{"width":43,"height":40},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":38,"vars_in":[{"rel":"inputValue","name":"spectraInDataset"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":6},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["console.log('Load and process', this.action, this.variable);\n\nconst recreateCharts = await API.require('vh/eln/sample/ml/recreateCharts');\n\nawait recreateCharts(this.variable);\n\nAPI.doAction('changedSelectedSpectra');"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Update data and charts","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":111,"top":27},"size":{"width":24,"height":5},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":60},"size":{"width":55,"height":20},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":111,"top":27},"size":{"width":24,"height":5},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":39,"vars_in":[{"rel":"inputValue","name":"preferences"}],"actions_in":[{"rel":"execute","name":"UpdateChart"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":6},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[["remove"]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/db85d9cc12c6204e4a3afb69bba6d695f6f8bad5/src/modules/types/edition/slick_grid/view.js#L918-L940"],"customJpaths":["jcamp.dUrl,pdf.dUrl,file.dUrl,jcamp.data,experiment,instrument"]}],"cols":[[{"name":"Identifier","jpath":["id"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":90,"hideColumn":[]},{"name":"Category","jpath":["category"],"editor":"string","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":56,"hideColumn":[]},{"name":"Experiment","jpath":["experiment"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":69,"hideColumn":[]},{"name":"☑️","jpath":["selected"],"editor":"boolean","forceType":"boolean","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":40,"minWidth":"40","maxWidth":"40","hideColumn":[]},{"name":"PCA","jpath":["pcaModel"],"editor":"none","forceType":"boolean","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":40,"minWidth":"40","maxWidth":"40","hideColumn":[]},{"name":"Color","jpath":["color"],"editor":"color","forceType":"color","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":40,"minWidth":"40","maxWidth":"40","hideColumn":[]}]],"actionCols":[[{"backgroundColor":[255,255,255,0],"color":[0,0,0,1],"position":"end","clickMode":"text"}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":128,"top":39},"size":{"width":38,"height":48},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":40,"vars_in":[{"rel":"list","name":"spectraInDataset"}],"actions_in":[{}],"title":"List of spectra in dataset","vars_out":[{"event":"onHover","rel":"row","jpath":["toc"],"name":"tocHovered"},{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"currentlySelectedSpectra"}],"actions_out":[{"event":"onHover","rel":"row","jpath":[],"name":"hoverRow"}],"zindex":8,"toolbar":{"custom":[[{"title":"Remove all spectra from dataset","icon":"fa-eraser","action":"clearSelectedSamples","position":"begin","color":[100,100,100,1]},{"title":"Select category","icon":"fa-dot-circle","action":"selectCategory","position":"begin","color":[100,100,100,1]},{"title":"Download normalized matrix","icon":"fa-download","action":"downloadNormalizedMatrix","position":"begin","color":[100,100,100,1]},{"title":"Recolor spectra based on category","icon":"fa-palette","action":"forceRecolor","position":"begin","color":[103,78,167,1]},{"title":"Select all spectra","icon":"fa-eye","action":"selectAllSpectra","position":"begin","color":[56,118,29,1]},{"title":"Append to selected spectra","icon":"fa-plus","action":"addSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Select only current spectra","icon":"fa-bullseye","action":"selectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Remove spectra from current selection","icon":"fa-minus","action":"hideSpectra","position":"begin","color":[153,0,0,1]},{"title":"Unselect all spectra","icon":"fa-eye-slash","action":"hideAllSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}]},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["const twigPreferences=`\n\n${Prefs.style}\n\n<div id='extendedForm'>\n    <form>\n    \n    ${Prefs.dataNormalization}\n\n    <h1>PCA</h1>\n    <table>\n        <tr>\n            <th>Scale data:</th>\n            <td>\n                <input type=\"checkbox\" name=\"pca.scale\">\n            </td>\n        </tr>\n        <tr>\n            <th>Ignore zero variance</th>\n            <td>\n                <input type=\"checkbox\" name=\"pca.ignoreZeroVariance\">\n            </td>\n        </tr>\n        \n    </table>\n    \n\n<!--\n    <center>\n         Auto-refresh <input type=\"checkbox\" name=\"display.autorefresh\" checked> \n        or <input type=\"submit\" value=\"Update data and chart\">\n    </center>\n-->\n    </form>\n</div>\n\n\n<script>\n    require(['vh/util/twigAdvancedForm'], function(AF) {\n        AF('extendedForm', {debug:false});\n    });\n</script>\n`;\n\n\nAPI.createData('twigPreferences', twigPreferences);\n\nAPI.createData('displayTwigPreferences', Prefs.displayTwigPreferences);\n\nif((typeof IframeBridge)==='undefined') {\n    API.createData('twigTemplate', Prefs.tocOfflineTwig);\n}\n\n"]}],"libs":[[{"lib":"vh/eln/sample/ml/viewsPreferences","alias":"Prefs"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":1,"top":101},"size":{"width":49,"height":20},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":41,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":4},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[500],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":59,"top":14},"size":{"width":69,"height":3},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":64,"top":26},"size":{"width":50,"height":10},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":42,"vars_in":[{"rel":"tpl","name":"displayTwigPreferences"},{"rel":"form","name":"preferences"},{"rel":"value","name":"ranges"},{"rel":"value","name":"keepOriginal"},{"rel":"value","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormChanged","rel":"form","jpath":[],"name":"changedPreferences"},{"event":"onFormSubmitted","rel":"form","jpath":[],"name":"UpdateChart"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Preferences","zindex":53},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[0],"script":["<style>\n    #pcaForm {\n        padding: 10px;\n    }\n    #pcaFormOffline h1 {\n        font-size: 16px;\n        padding-top: 12px;\n        padding-bottom: 4px;\n        space\n    }\n    #pcaFormOffline input, #pcaForm select {\n        margin-top: 3px;\n        margin-bottom: 3px;\n    } \n</style>\n\n\n<div id='pcaFormOffline'>\n    X: <select name=\"pca.x\">\n        <option value=\"0\">PC 1</option>\n        <option value=\"1\">PC 2</option>\n        <option value=\"2\">PC 3</option>\n        <option value=\"3\">PC 4</option>\n    </select>\n     - Y:<select name=\"pca.y\">\n        <option value=\"0\">PC 1</option>\n        <option value=\"1\">PC 2</option>\n        <option value=\"2\">PC 3</option>\n        <option value=\"3\">PC 4</option>\n    </select>  - \n    Display ellipses <input type=\"checkbox\" name=\"pca.ellipse\">\n    - Nb SD\n    <select name=\"pca.sd\">\n        <option value=\"1\">1</option>\n        <option value=\"2\">2</option>\n        <option value=\"3\">3</option>\n    </select> - \n    Show category <input type=\"checkbox\" name=\"pca.ellipseCategory\">\n    Show ID <input type=\"checkbox\" name=\"pca.displayID\">\n    \n</div>\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Twig template for PCA preferences","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":34},"size":{"width":63,"height":29},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":43,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"twigPCAPrefs"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":3},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[300],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":65,"top":51},"size":{"width":55,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":64,"top":44},"size":{"width":50,"height":8},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":44,"vars_in":[{"rel":"tpl","name":"twigPCAPrefs"},{"rel":"form","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormChanged","rel":"form","jpath":[],"name":"pcaPreferencesChanged"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":48},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["xy"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[["yes"]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pca","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"0.0000001","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":["markers"],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":45,"vars_in":[{"rel":"chart","name":"pca"},{"rel":"annotations","name":"pcaAnnotations"},{"rel":"annotations","name":"ellipsis"}],"actions_in":[{}],"vars_out":[{"event":"onMouseOverShape","rel":"shapeInfos","jpath":["info","toc"],"name":"tocHovered"},{"event":"onSelectScatter","rel":"selectedData","jpath":[],"name":"scatterSelected"},{"event":"onClickMarker","rel":"markerInfos","jpath":[],"name":"markerData"}],"actions_out":[{"event":"onShapeClick","rel":"dataAndEvent","jpath":[],"name":"clickedPCAShape"}],"toolbar":{"custom":[[{"title":"Load PCA model","icon":"fa-tasks","action":"selectResultTemplate","position":"begin","color":[100,100,100,1]},{"title":"Save PCA model","icon":"fa-save","action":"saveResultTemplate","position":"begin","color":[100,100,100,1]},{"title":"Remove selected spectra","icon":"fa-trash","action":"deletePCASelection","position":"begin","color":[100,100,100,1]},{"title":"Select all spectra","icon":"fa-eye","action":"selectAllSpectra","position":"begin","color":[56,118,29,1]},{"title":"Show spectra","icon":"fa-plus","action":"pcaaddSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Only show selected spectra","icon":"fa-bullseye","action":"pcaselectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Unselect spectra","icon":"fa-minus","action":"pcaHideSpectra","position":"begin","color":[153,0,0,1]},{"title":"Unselect all spectra","icon":"fa-eye-slash","action":"hideAllSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Principal component analysis. Filled if part of PCA model. Large if selected.","zindex":3},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["xy"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[["yes"]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pca","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"0.0000001","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":["markers"],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":46,"vars_in":[{"rel":"chart","name":"pca"},{"rel":"annotations","name":"pcaAnnotations"},{"rel":"annotations","name":"ellipsis"}],"actions_in":[{}],"vars_out":[{"event":"onMouseOverShape","rel":"shapeInfos","jpath":["info","toc"],"name":"tocHovered"},{"event":"onSelectScatter","rel":"selectedData","jpath":[],"name":"scatterSelected"},{"event":"onClickMarker","rel":"markerInfos","jpath":[],"name":"markerData"}],"actions_out":[{"event":"onShapeClick","rel":"dataAndEvent","jpath":[],"name":"clickedPCAShape"}],"toolbar":{"custom":[[{"title":"Remove selected spectra","icon":"fa-trash","action":"deletePCASelection","position":"begin","color":[100,100,100,1]},{"title":"Show spectra","icon":"fa-plus","action":"pcaaddSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Only show selected spectra","icon":"fa-bullseye","action":"pcaselectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Hide spectra","icon":"fa-minus","action":"pcaHideSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Principal component analysis","zindex":3},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["xy"],"wheelAction":["none"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[[]],"trackingAxis":["x"],"selectScatter":[["yes"]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["display"]],"label":["Principal component"],"beforeSpacing":["0.1"],"afterSpacing":["0.1"],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"pca","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"0.0000001","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":["markers"],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":[]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":51,"top":48},"size":{"width":76,"height":39},"zIndex":0,"display":true,"title":"Principal component analysis","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":47,"vars_in":[{"rel":"chart","name":"pcaScorePlot"},{"rel":"annotations","name":"pcaAnnotations"},{"rel":"annotations","name":"ellipsis"}],"actions_in":[{}],"vars_out":[{"event":"onMouseOverShape","rel":"shapeInfos","jpath":["info","toc"],"name":"tocHovered"},{"event":"onSelectScatter","rel":"selectedData","jpath":[],"name":"scatterSelected"},{"event":"onClickMarker","rel":"markerInfos","jpath":[],"name":"markerData"}],"actions_out":[{"event":"onShapeClick","rel":"dataAndEvent","jpath":[],"name":"clickedPCAShape"}],"toolbar":{"custom":[[{"title":"Remove selected spectra","icon":"fa-trash","action":"deletePCASelection","position":"begin","color":[100,100,100,1]},{"title":"Show spectra","icon":"fa-plus","action":"pcaaddSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Only show selected spectra","icon":"fa-bullseye","action":"pcaselectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Hide spectra","icon":"fa-minus","action":"pcaHideSpectra","position":"begin","color":[153,0,0,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Principal component analysis","zindex":3},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["console.log(this.action);\nconst roc=API.cache('roc');\n\nconst spectraDataSet=API.cache('spectraDataSet');\nlet spectraInDataset = API.getData('spectraInDataset');\n\nswitch (this.action.name) {\n    case 'pcaaddSpectraToSelection': {\n        let scatterSelected=API.getData('scatterSelected').map( entry => String(entry.id));\n        spectraInDataset=spectraInDataset.filter( entry => scatterSelected.includes(String(entry.id)));\n        API.createData('currentlySelectedSpectra', spectraInDataset);\n        window.setTimeout( () => {\n            API.doAction('addSpectraToSelection');\n        });\n        break;\n    }\n    case 'pcaselectCurrentSpectraSelection': {\n        let scatterSelected=API.getData('scatterSelected').map( entry => String(entry.id));\n        spectraInDataset=spectraInDataset.filter( entry => scatterSelected.includes(String(entry.id)));\n        \n        API.createData('currentlySelectedSpectra', spectraInDataset);\n        window.setTimeout( () => {\n            API.doAction('selectCurrentSpectraSelection');\n        });\n        break;\n    }\n    case 'pcaHideSpectra': {\n        let scatterSelected=API.getData('scatterSelected').map( entry => String(entry.id));\n        spectraInDataset=spectraInDataset.filter( entry => scatterSelected.includes(String(entry.id)));\n        API.createData('currentlySelectedSpectra', spectraInDataset);\n        window.setTimeout( () => {\n            API.doAction('hideSpectra');\n        });\n        break;\n    }\n    case 'clickedPCAShape':\n        if (this.action.value.event.altKey) {\n            let entry=spectraInDataset.filter(entry => String(entry.id) === String(this.action.value.data.info.id))[0];\n            entry.selected = DataObject.resurrect(entry.selected) ? false : true;\n            spectraInDataset.triggerChange();\n        }\n        break;\n    case 'deletePCASelection': {\n            let scatterSelected=API.getData('scatterSelected');\n            for (let selected of scatterSelected) {\n                for (let i=0; i<spectraInDataset.length; i++) {\n                    let spectrum=spectraInDataset[i];\n                    if (String(selected.id)===String(spectrum.id)) {\n                        spectraInDataset.splice(i,1);\n                        break;\n                    }\n                }\n            }\n            spectraInDataset.triggerChange();\n        }\n        break;\n    default:\n        await spectraDataSet.processAction(this.action);\n}\n\nAPI.createData('selectedInfo', {\n    nbSpectra: spectraInDataset.length,\n    nbSelected: spectraInDataset.reduce( (previous, entry) => previous+entry.selected, 0 ),\n    nbPCA: spectraInDataset.reduce( (previous, entry) => previous+entry.pcaModel, 0 ),\n});\n"]}],"libs":[[{"lib":"vh/eln/Sample","alias":"Sample"},{"lib":"src/util/color","alias":"Color"},{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":27,"top":91},"size":{"width":70,"height":32},"zIndex":0,"display":false,"title":"Deal with actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":56,"top":44},"size":{"width":56,"height":36},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":48,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"clickedSample"},{"rel":"execute","name":"addSelectedSamples"},{"rel":"execute","name":"addSample"},{"rel":"execute","name":"addSpectrum"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"clearSelectedSamples"},{"rel":"execute","name":"clickedPCAShape"},{"rel":"execute","name":"deletePCASelection"},{"rel":"execute","name":"addSpectraToSelection"},{"rel":"execute","name":"selectAllSpectra"},{"rel":"execute","name":"hideAllSpectra"},{"rel":"execute","name":"hideSpectra"},{"rel":"execute","name":"selectCurrentSpectraSelection"},{"rel":"execute","name":"forceRecolor"},{"rel":"execute","name":"pcaaddSpectraToSelection"},{"rel":"execute","name":"pcaselectCurrentSpectraSelection"},{"rel":"execute","name":"pcaHideSpectra"},{"rel":"execute","name":"selectCategory"},{"rel":"execute","name":"resetMinMax"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":48},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":128,"top":11},"size":{"width":38,"height":27},"zIndex":0,"display":true,"title":"","bgColor":[255,242,204,1],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":49,"vars_in":[{"rel":"tpl","name":"twigTemplate"},{"rel":"value","name":"tocHovered"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":3},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style> \n    #calculationStatus2 {\n      height: 40px;\n      width: 100%;\n      background-color: #ddd; \n      border-radius: 5px;\n      top: 180px;\n      margin-bottom: 50px;\n      box-shadow:2px 0px 12px 3px rgba(0, 0, 0, 0.3) inset;\n      padding: 8px;\n    } \n    @keyframes move{\n        100%{\n            background-position: 40px 0px;\n        }\n    }  \n    #statusBar2 { \n      width: 10%; \n      height: 25px;\n      background: linear-gradient(45deg,rgba(255, 255, 255, 0.5) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.5) 50%, rgba(255, 255, 255, 0.5) 75%, transparent 75%, transparent);\n      background-color: #196C7F;\n      background-size: 40px;\n      border-radius: 5px;\n      padding: 8px;\n      /*animation: move 1.0s linear infinite;*/\n    }\n    \n    #statusLabel2 {\n      text-align: center;\n      color: white;\n    }\n</style>\n\n<body>\n    {% if (statusProgress.currentStatus)%}\n    <h2 id='label' align='center'></h2> \n    <div id=\"calculationStatus2\">\n        <div id=\"statusBar2\"><p id='statusLabel2'>{{rendertype(statusProgress.currentStatus, {numeral:'0.00'})}} %</p></div>\n    </div>\n    {% endif %}\n\n    <script>\n        $('#calculationStatus2').width(390);\n        const currentStatus = {{statusProgress.currentStatus}};\n        const iterationsNumber = {{statusProgress.iterationsNumber}};\n        let label = 'Block '+String(currentStatus + 1)+' of '+String(iterationsNumber);\n        $('#label').text(label);\n        let progress = (currentStatus + 1) / iterationsNumber*100;\n        progress = Math.round(progress * 100) / 100;\n        $('#statusBar2').width(progress * 3.6);\n        $('#statusLabel2').text(String(progress) + '%');\n        if (progress === 100) {\n            $('#statusLabel2').text('Finished');\n        }\n    </script> \n</body>\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":78,"top":2},"size":{"width":50,"height":16},"zIndex":0,"display":true,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":76,"top":108},"size":{"width":46,"height":15},"zIndex":0,"display":true,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Loading bar","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":50,"vars_in":[{"rel":"value","name":"statusProgress"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Loading bar","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style>\n    #selectedInfo {\n        zoom: 1.5\n    }\n</style>\n<div id=\"selectedInfo\">\n    In dataset: {{selectedInfo.nbSpectra}} - \n    Selected: {{selectedInfo.nbSelected}} - \n    Used for PCA calculation: {{selectedInfo.nbPCA}}\n</div>\n\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":51,"vars_in":[{"rel":"value","name":"selectedInfo"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":3},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style>\n    #selectedInfo {\n        zoom: 1.5\n    }\n</style>\n<div id=\"selectedInfo\">\n    In dataset: {{selectedInfo.nbSpectra}} - \n    Selected: {{selectedInfo.nbSelected}} - \n    Used for PCA calculation: {{selectedInfo.nbPCA}}\n</div>\n\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":119,"top":1},"size":{"width":45,"height":5},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":52,"vars_in":[{"rel":"value","name":"selectedInfo"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":57},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style>\n    #memoryInfo {\n        font-family: monospace;\n    }\n</style>\n<div id=\"memoryInfo\">\n    <b>Memory</b>: \n    Original data:\n    {{rendertype(memoryInfo.original+0.00001,{numeral:'0 b'})}}\n    - Normalized data: {{rendertype(memoryInfo.normalized,{numeral:'0 b'})}}\n    - Max allowed {{rendertype(memoryInfo.maxMemory,{numeral:'0 b'})}}\n    {% if memoryInfo.keepOriginal %}\n        &nbsp;<b style=\"color: green\">Original data present</b>\n    {% else %}\n        &nbsp;<b style=\"color: red\">Missing original data</b>\n    {% endif %}\n    \n</div>\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":48,"top":1},"size":{"width":79,"height":2},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Admin":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Admin"},"preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"preferences"},"pc":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"pc"},"Import data":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Import data"},"Actions manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Actions manager"},"Range manager":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Range manager"},"compare":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"compare"},"loadings":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"loadings"},"Defining blocks":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Defining blocks"}},"id":53,"vars_in":[{"rel":"value","name":"memoryInfo"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":3}],"variables":[{"jpath":[""]}],"aliases":[{"path":"https://www.lactame.com/lib/ml/5.1.1/ml","alias":"ML"},{"path":"https://www.lactame.com/github/cheminfo-js/visualizer-helper/417987b5509104fc7edd9257d18088f046cd0a8a/","alias":"vh"},{"path":"http://localhost:9898/cheminfo-js/visualizer-helper/","alias":"vhxx"},{"path":"https://www.lactame.com/lib/jsgraph-sd-ellipse/0.0.1/jsgraph-sd-ellipse","alias":"Ellipse"},{"path":"https://www.lactame.com/lib/openchemlib-extended/6.0.0/openchemlib-extended","alias":"OCLE"},{"path":"https://www.lactame.com/lib/spectra-data/3.7.9/spectra-data","alias":"SD"},{"path":"https://www.lactame.com/lib/nmr-predictor/1.2.1/nmr-predictor","alias":"nmrPredictor"},{"path":"https://www.lactame.com/lib/ml-spectra-processing/HEAD/ml-spectra-processing","alias":"spectraProcessing"},{"path":"https://www.lactame.com/lib/spectra-processor/HEAD/spectra-processor","alias":"SpectraProcessor"}],"configuration":{"title":"Multiblock-PCA"},"actionscripts":[{"sections":{},"groups":{"action":[{"name":[null],"script":[null]}]}}],"init_script":[{"sections":{},"groups":{"general":[{"script":["if((typeof IframeBridge)==='undefined') {\n    let Grid=await require('src/main/grid');\n    Grid.setInitialLayerName('Default layer');\n}\n\nconst [\n    Roc,\n    loadTwig,\n    UserAnalysisResults,\n    Toc,\n    SpectraDataSet,\n    libs,\n    RangesManager,\n] = await API.require([\n    'vh/rest-on-couch/Roc',\n    'vh/eln/templates/loadTwig',\n    'vh/rest-on-couch/UserAnalysisResults',\n    'vh/eln/Toc',\n    'vh/eln/sample/ml/SpectraDataSet',\n    'vh/eln/libs',\n    'vh/eln/sample/RangesManager',\n]);\n\nconst SpectraProcessor = (await API.require('SpectraProcessor')).SpectraProcessor;\nAPI.cache('spectraProcessor', new SpectraProcessor({}));\n\nif((typeof IframeBridge)!=='undefined') {\n    IframeBridge.onMessage(onMessage);\n    IframeBridge.ready();\n} else {\n    const spectraDataSet = new SpectraDataSet(undefined, undefined, {\n        defaultAttributes: {\n            pcaModel: false\n        }\n    });\n    spectraDataSet.initializeAnalysis();\n    API.cache('spectraDataSet', spectraDataSet);\n}\n\nasync function onMessage(data) {\n    if(data.type === 'tab.data') {\n        var couchDB = data.message.couchDB;\n        var uuid = data.message.uuid;\n        API.cache('couchDB', couchDB);\n        API.cache('uuid', uuid);\n        var roc = new Roc(couchDB);\n        API.cache('roc', roc);\n         \n        var userAnalysisResults = new UserAnalysisResults(roc, data.message.uuid);\n        API.cache(\"userAnalysisResults\", userAnalysisResults);\n        userAnalysisResults.refresh();\n        API.createData('description', '');\n        \n        const sampleToc = new Toc(roc);\n        sampleToc.initializeGroupForm();\n        API.cache('sampleToc', sampleToc);\n        \n        const spectraDataSet = new SpectraDataSet(roc, sampleToc, {\n            defaultAttributes: {\n                pcaModel: false\n            }\n        });\n        spectraDataSet.initializeAnalysis({autoRefresh:false});\n        API.cache('spectraDataSet', spectraDataSet);\n    }\n}\n\nAPI.createData('spectraInDataset',[]);\n\nconst ranges = await API.createData('ranges', []);\nconst rangesManager = new RangesManager(ranges, {ensureLabel: true});\nAPI.cache('rangesManager', rangesManager);\n\nAPI.createData('preferences', {\n    first: 0.98,\n    second: 0.80,\n    mode: 1,\n    data: {keep: true},\n    display: {\n        selection: 'selected',\n        original: false,\n        trackingInfo: false,\n        correlation: '',\n        correlationIndex: false,\n        boxplot: false,\n        boxplotOptions: {\n            q13FillColor : '#000',\n            q13FillOpacity : 0.3,\n            q2StrokeColor : '#000',\n            q2StrokeWidth : 3,\n            minMaxFillColor : '#000',\n            minMaxFillOpacity : 0.15\n        },\n        autorefresh: true\n    },\n    normalization: {\n        from: 0,\n        to: 10,\n        numberOfPoints:1024\n    },\n    mbOptions: {\n        fillMode: '1',\n        from: 0,\n        to: 10,\n        stepSize: 0.5,\n        visible: true,\n    },\n    pca: {\n        scale: true,\n        ignoreZeroVariance: true,\n        x:0,\n        y:1,\n        ellipse:true,\n        ellipseCategory:false,\n        sd:2,\n        nbComponents: 4,\n    }\n});\n\nAPI.createData('mbSettings', {\n    numberOfBlock: 0,\n    numberOfBlockLoading: '0',\n    numberOfLoading: '0'\n});\n\nloadTwig(['org.cheminfo.sampleToc.chemical.default']);\n\n"]}]}}],"custom_filters":[{"sections":{"modules":[{"sections":{},"groups":{"modules":[[{}]]}}],"filtersLib":[{"sections":{},"groups":{"filters":[[{}]]}}],"filters":[{"sections":{},"groups":{"filter":[{"name":["smiles2molfile"],"script":["return {\n    filter:function filter(values, resolve) {\n        console.log(values);\n        if (values && values.smiles) {\n            resolve( OCLE.Molecule.fromSmiles(values.smiles).toMolfile());\n        }\n    }\n}"]}],"libs":[[{"lib":"OCLE","alias":"OCLE"}]]}}]},"groups":{}}],"actionfiles":[{"sections":{},"groups":{"action":[[{}]]}}]}