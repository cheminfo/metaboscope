{"version":"2.146.0","grid":{"layers":{"Default layer":{"name":"Default layer"},"Preferences":{"name":"Preferences"},"ManageSpectra":{"name":"ManageSpectra"},"LoadFiles":{"name":"LoadFiles"},"Meta":{"name":"Meta"},"Twig":{"name":"Twig"}},"xWidth":10,"yHeight":10},"modules":[{"url":"modules/types/client_interaction/dragdrop/","configuration":{"sections":{},"groups":{"group":[{"label":["Drag and drop your files here"],"dragoverlabel":[""],"hoverlabel":["Drop your files here"],"fileSelectLabel":["Select file"],"labelFontSize":[22],"checkOptions":[["promptAmbiguous"]],"inputOptions":[["allowDrop","allowPaste","allowFileInput"]]}],"vars":[[{"filter":"ext","extension":"*","filetype":"buffer","type":"","variable":"files"}]],"string_general":[{"askFilename":[[]]}],"string":[[{"filter":"ext","extension":"*","type":"","variable":"str"}]],"photo":[[{"variable":"photo"}]]}},"layers":{"Default layer":{"position":{"left":6,"top":0},"size":{"width":33,"height":10},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":39,"height":10},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":39,"height":15},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"LoadFiles":{"position":{"left":0,"top":66},"size":{"width":35,"height":10},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":6,"top":0},"size":{"width":33,"height":10},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Twig":{"position":{"left":6,"top":0},"size":{"width":33,"height":10},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":1,"vars_out":[{"event":"onRead","rel":"dataarray","jpath":["files"],"name":"dropped"}],"vars_in":[],"actions_in":[{}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const dropped=API.getData('dropped');\n\nconst spectra = API.getData('spectra');;\n\nfor (const file of dropped) {\n    switch (file.filename.replace(/.*\\./,'')) {\n        case 'dx':\n        case 'jdx':\n            loadJcamp(file.filename, file.content);\n            break;\n        case 'zip':\n            await processZip(file);\n            break;\n        case 'xls':\n        case 'xlsx':\n            await processXls(file);\n            break;\n    }\n}\n\nconsole.log('done');\nconsole.log(spectra.length);\nspectra.triggerChange();\n\n// API.stopLoading('loading');\n\n\nasync function processZip(file) {\n    const JSZip = await API.require('jszip');\n    const zipData=API.getData('zipData');\n\n    const jsZip = new JSZip();\n    // more files !\n    const zip = await jsZip.loadAsync(file.content, {base64: true})\n    \n    await loadBrukers(zip);\n\n    await loadJcamps(zip);\n}\n\nfunction loadJcamp(id, content) {\n    console.log('Loading',id);\n    // API.loading('loading', id);\n    const textDecoder=new TextDecoder('utf8');\n    let result={};\n\n    result._highlight=Math.random();\n    let converted = JcampConverter.convert(textDecoder.decode(content), {\n        keepRecordsRegExp: /.*/,\n    }).flatten[0];\n    result.id=id;\n    result.name=converted.title;\n    result.expno=Number(converted.meta.EXPNO);\n    if (converted.spectra.length !== 0) {\n        result.data = converted.spectra[0].data\n        result.pulprog=converted.meta.PULPROG.replace(/[ <>]/g,'') ? converted.meta.PULPROG.replace(/[ <>]/g,''): undefined;\n        spectra.push(result);\n    }\n}\n\nasync function loadJcamps(zip) {\n    let files=Object.keys(zip.files).filter( name => name.match(/\\.(jdx|dx)$/i));\n    files=await Promise.all(files.map( async (file) => {\n        let parts=file.split(\"/\");\n        let id=parts[0]+'/'+parts[1];\n        return loadJcamp( id,\n            await zip.file(file).async('arraybuffer')\n        )\n    }));\n}\n\nasync function loadBrukers(zip) {\n    let files=Object.keys(zip.files).filter( name => name.endsWith('1/1r'));\n    files=await Promise.all(files.map( async (file) => {\n        let result={};\n        let parts=file.split(\"/\");\n        result._highlight=Math.random();\n        result.id=parts[0]+'/'+parts[1];\n        result.name=parts[0];\n        result.expno=Number(parts[1]);\n        result.name1r=file;\n        result.name1i=file.replace(/1r$/,'1i');\n        result.nameProcs=file.replace(/1r$/,'procs');\n        result.nameAcqus=file.replace(/pdata\\/1\\/1r$/,'acqus');\n        result.procs=await zip.file(result.nameProcs).async('text');\n        result.acqus=await zip.file(result.nameAcqus).async('text');\n        result.pulprog=result.acqus.replace(/[.\\s\\S]*##\\$PULPROG=(.*)[.\\s\\S]*/m,'$1').replace(/[ <>]/g,'')\n        let content=await zip.file(file).async('arraybuffer');\n        \n        let parsed=BrukerConverter.convertFolder(\n            {\n                acqus: result.acqus,\n                procs: result.procs,\n                \"1r\": content\n            },\n            {xy:true}\n        );\n        let theData=parsed.spectra[0].data[0];\n        result.data={\n            x: Float64Array.from(theData.x), // float array don't take place in javascript memory\n            y: Float64Array.from(theData.y),\n        }\n        return result;\n    }));\n    \n    spectra.push(...files);\n}\n\nasync function processXls(file) {\n    await API.require('xlsx');\n    let workbook = XLSX.read(file.content, {\n            type: 'array'\n    });\n    let sheetNames = workbook.SheetNames;\n\n    let json = XLSX.utils.sheet_to_json(workbook.Sheets[sheetNames[0]]);\n    let columnNames=Object.keys(json[0]).map( (key,index) => {\n        return {\n            key,\n            columnID: index===0,\n            category: index===1,\n            meta: true\n        };\n    } );\n    API.createData('columnNames', columnNames);\n    API.cache('xls', json);\n}\n"]}],"libs":[[{"lib":"JcampConverter","alias":"JcampConverter"},{"lib":"BrukerConverter","alias":"BrukerConverter"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":64,"top":0},"size":{"width":60,"height":51},"zIndex":0,"display":false,"title":"Decompress the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":64,"top":0},"size":{"width":60,"height":51},"zIndex":0,"display":false,"title":"Decompress the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"ManageSpectra":{"position":{"left":0,"top":5},"size":{"width":43,"height":52},"zIndex":0,"display":false,"title":"Decompress the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"LoadFiles":{"position":{"left":0,"top":7},"size":{"width":67,"height":57},"zIndex":0,"display":true,"title":"Decompress the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":64,"top":0},"size":{"width":60,"height":51},"zIndex":0,"display":false,"title":"Decompress the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":64,"top":0},"size":{"width":60,"height":51},"zIndex":0,"display":false,"title":"Decompress the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":2,"vars_in":[{"rel":"inputValue","name":"dropped"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Decompress the zip file","zindex":1},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable","filterColumns"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Name","jpath":["name"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":171,"hideColumn":[]},{"name":"Exp no","jpath":["expno"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":77,"hideColumn":[]},{"name":"Puprog","jpath":["pulprog"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":102,"hideColumn":[]}]],"actionCols":[[{"name":"Add spectrum","tooltip":"Add spectrum","icon":"fa-plus","backgroundColor":[255,255,255,0],"color":[0,0,0,1],"action":"addDirectSpectrum","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":0,"top":11},"size":{"width":39,"height":68},"zIndex":0,"display":true,"title":"List of spectra in the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":11},"size":{"width":39,"height":41},"zIndex":0,"display":false,"title":"List of spectra in the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"ManageSpectra":{"position":{"left":140,"top":0},"size":{"width":29,"height":59},"zIndex":0,"display":true,"title":"List of spectra in the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"LoadFiles":{"position":{"left":106,"top":45},"size":{"width":41,"height":36},"zIndex":0,"display":true,"title":"List of spectra in the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":0,"top":11},"size":{"width":39,"height":58},"zIndex":0,"display":false,"title":"List of spectra in the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":0,"top":11},"size":{"width":39,"height":58},"zIndex":0,"display":false,"title":"List of spectra in the zip file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":3,"vars_in":[{"rel":"list","name":"spectra"}],"actions_in":[{}],"actions_out":[{"jpath":[]}],"vars_out":[{"event":"onRowActive","rel":"row","jpath":[],"name":"rowInfo"},{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"selectedSpectra"}],"toolbar":{"custom":[[{"title":"Add spectra","icon":"fa-plus","action":"addDirectSpectra","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"List of spectra in the zip file","zindex":1},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[0],"script":["<style>\n    #extendedForm {\n        padding: 10px;\n    }\n    #extendedForm .addRow {\n        color: green;\n        font-weight: bold;\n        font-size: 12px;\n        padding: .4em .6em;\n    }\n    #extendedForm .removeRow {\n        color: red;\n        font-weight: bold;\n        font-size: 12px;\n        padding: .4em .8em;\n    }\n    #extendedForm h1 {\n        font-size: 16px;\n        padding-top: 12px;\n        padding-bottom: 4px;\n        space\n    }\n    #extendedForm h2 {\n        font-size: 12px;\n        margin-top: 12px;\n        margin-bottom: 4px;\n        space\n    }\n    #extendedForm input[type=number]{\n        width: 60px;\n    }\n    #extendedForm input, #extendedForm select {\n        margin-top: 3px;\n        margin-bottom: 3px;\n    } \n</style>\n\n<div id='extendedForm'>\n    <form>\n    <h1>Data / Display</h1>\n     Display:\n        <input type='radio' name='display.original' value='true'> Original data\n        <input type='radio' name='display.original' value='false'> Processed data\n    <br>\n    Auto-refresh <input type=\"checkbox\" name=\"display.autorefresh\" checked> \n        \n        \n        <h1>Normalization</h1>\n    <table>\n        <tr>\n            <th align=\"left\">Range:</th>\n            <td>\n                from: <input type='number' name='normalization.from' size=\"5\"> - \n                to: <input type='number' name='normalization.to'>\n            </td>\n        </tr>\n        <tr>\n            <th align=\"left\">Number of points:</th>\n            <td>\n                <input type='number' name='normalization.numberOfPoints' size=\"6\">\n            </td>\n        </tr>\n        <tr>\n            <th align=\"left\">Filters</th>\n            <td>\n                <table>\n                    <tr>\n                        <th></th><th></th>\n                        <th>Name</th>\n                        <th>Options</th>\n                    </tr>\n                    <tr data-repeat='normalization.filters'>\n                        <td>\n                            <select data-field='name'>\n                                <option value=\"\"></option>\n                                <option value=\"centerMean\">Center Mean</option>\n                                <option value=\"scaleSD\">Divide by SD</option>\n                            </select>\n     \n                        </td>\n                        <td><input type='number' data-field='options' size=\"5\"></td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <th align=\"left\">Exclusions</th>\n            <td>\n                <table>\n                    <tr>\n                        <th></th><th></th>\n                        <th>From</th>\n                        <th>To</th>\n                    </tr>\n                    <tr data-repeat='normalization.exclusions'>\n                        <td><input type='number' data-field='from' size=\"5\"></td>\n                        <td><input type='number' data-field='to' size=\"5\"></td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n    <center>\n        <input type=\"submit\" value=\"Update data and chart\">\n    </center>\n    </form>\n\n</div>\n\n<script>\n    require(['vh/util/twigAdvancedForm'], function(AF) {\n        AF('extendedForm', {debug:false});\n    });\n</script>\n\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":92,"top":8},"size":{"width":69,"height":64},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":4,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"twigPreferences"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[1000],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":125,"top":27},"size":{"width":49,"height":35},"zIndex":0,"display":true,"title":"Preferences to generate the data","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":164,"top":2},"size":{"width":49,"height":48},"zIndex":0,"display":true,"title":"Preferences to generate the data","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Preferences to generate the data","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":110,"top":0},"size":{"width":41,"height":42},"zIndex":0,"display":false,"title":"Preferences to generate the data","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":110,"top":21},"size":{"width":41,"height":42},"zIndex":0,"display":false,"title":"Preferences to generate the data","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":110,"top":21},"size":{"width":41,"height":42},"zIndex":0,"display":false,"title":"Preferences to generate the data","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":5,"vars_in":[{"rel":"tpl","name":"twigPreferences"},{"rel":"form","name":"preferences"},{"rel":"value","name":"keepOriginal"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormSubmitted","rel":"form","jpath":[],"name":"UpdateChart"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Preferences to generate the data","zindex":1},{"url":"modules/types/science/spectra/spectra_displayer/","configuration":{"sections":{"graph":[{"sections":{},"groups":{"graph":[{"url":[""],"zoom":["x"],"wheelAction":["zoomY"],"wheelbaseline":[0],"fullOut":["both"],"legend":[null],"legendOptions":[["isSerieHideable","isSerieSelectable"]],"mouseTracking":[["track"]],"trackingAxis":["x"],"selectScatter":[[]],"independantYZoom":[[]]}]}}],"axis":[{"sections":{},"groups":{"xAxis":[{"checkboxes":[["main","sec","display","flip"]],"label":["δ (ppm)"],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"axismodification":["none"]}],"yAxis":[{"checkboxes":[["main","sec"]],"label":[""],"beforeSpacing":["0"],"afterSpacing":[0],"min":[""],"max":[""],"nbTicksPrimary":[5],"fitToAxisOnFromTo":[[]]}]}}],"series":[{"sections":{},"groups":{"series":[{"overflow":[[]],"stackVerticalSpacing":[0]}]}}],"variables":[{"sections":{},"groups":{"variables":[[{"variable":"chart","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]},{"variable":"correlationChart","axis":"0","adaptTo":"none","plotcolor":[1,1,255,1],"strokewidth":"1","strokestyle":"1","plotcontinuous":"continuous","peakpicking":[],"markers":[],"markerShape":"1","markerSize":2,"normalize":"none","optimizeSlots":[],"tracking":["yes"]}]]}}],"misc":[{"sections":{},"groups":{"misc":[{"highlightOptions":["{}"]}]}}]},"groups":{}},"layers":{"Default layer":{"position":{"left":40,"top":40},"size":{"width":84,"height":39},"zIndex":0,"display":true,"title":"Points that will be exported","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Points that will be exported","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Points that will be exported","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":40,"top":38},"size":{"width":69,"height":31},"zIndex":0,"display":false,"title":"Points that will be exported","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":40,"top":38},"size":{"width":69,"height":31},"zIndex":0,"display":false,"title":"Points that will be exported","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":40,"top":38},"size":{"width":37,"height":31},"zIndex":0,"display":false,"title":"Points that will be exported","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":6,"vars_in":[{"rel":"chart","name":"chart"},{"rel":"annotations","name":"filterAnnotations"},{"rel":"annotations","name":"boxPlotAnnotations"},{"rel":"annotations","name":"trackAnnotations"},{"rel":"chart","name":"correlationChart"},{"rel":"annotations","name":"correlationAnnotations"}],"actions_in":[{}],"vars_out":[{"event":"onTrackClick","rel":"trackData","jpath":[],"name":"clickedPoint"}],"actions_out":[{"event":"onTrackMouse","rel":"dataAndEvent","jpath":[],"name":"trackMove"},{"event":"onTrackClick","rel":"dataAndEvent","jpath":[],"name":"trackClicked"}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Show fullscreen"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Points that will be exported","zindex":1},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[["remove"]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Name","jpath":["name"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":105,"hideColumn":[]},{"name":"Expno","jpath":["expno"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":59,"hideColumn":[]},{"name":"Pulprog","jpath":["pulprog"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":55,"hideColumn":[]},{"name":"Category","jpath":["category"],"editor":"string","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":76,"hideColumn":[]},{"name":"☑️","jpath":["selected"],"editor":"boolean","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":34,"hideColumn":[]},{"name":"Color","jpath":["color"],"editor":"color","forceType":"color","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":36,"hideColumn":[]}]],"actionCols":[[{"backgroundColor":[255,255,255,0],"color":[0,0,0,1],"position":"end","clickMode":"text"}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":40,"top":2},"size":{"width":41,"height":37},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":5,"top":0},"size":{"width":51,"height":29},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":40,"top":2},"size":{"width":69,"height":35},"zIndex":0,"display":false,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":92,"top":23},"size":{"width":44,"height":35},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":0,"top":6},"size":{"width":75,"height":15},"zIndex":0,"display":true,"title":"List of spectra in dataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":7,"vars_in":[{"rel":"list","name":"spectraInDataset"}],"actions_in":[{}],"actions_out":[{"jpath":[]}],"vars_out":[{"event":"onHover","rel":"row","jpath":[],"name":"hoverSelectedSpectrum"},{"event":"onRowsSelect","rel":"rows","jpath":[],"name":"currentlySelectedSpectra"}],"toolbar":{"custom":[[{"title":"Remove all spectra","icon":"fa-eraser","action":"clearSelectedSamples","position":"begin","color":[100,100,100,1]},{"title":"Select category","icon":"fa-dot-circle","action":"selectCategory","position":"begin","color":[100,100,100,1]},{"title":"Download normalized matrix","icon":"fa-download","action":"downloadNormalizedMatrix","position":"begin","color":[100,100,100,1]},{"title":"Download post-processed matrix","icon":"fa-download","action":"downloadPostProcessedMatrix","position":"begin","color":[100,100,100,1]},{"title":"Recolor spectra based on category","icon":"fa-palette","action":"forceRecolor","position":"begin","color":[53,28,117,1]},{"title":"Select all spectra","icon":"fa-eye","action":"selectAllSpectra","position":"begin","color":[56,118,29,1]},{"title":"Append to selected spectra","icon":"fa-plus","action":"addSpectraToSelection","position":"begin","color":[56,118,29,1]},{"title":"Select only current spectra","icon":"fa-bullseye","action":"selectCurrentSpectraSelection","position":"begin","color":[180,95,6,1]},{"title":"Remove spectra from current selection","icon":"fa-minus","action":"hideSpectra","position":"begin","color":[153,0,0,1]},{"title":"Unselect all spectra","icon":"fa-eye-slash","action":"hideAllSpectra","position":"begin","color":[133,32,12,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"List of spectra in dataset","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<p style=\"font-size:1.5em\">\n{% if mouseTrack.normalizedChart.trueX %}\n{{rendertype(mouseTrack.normalizedChart.trueX,{numeral:'0.00'})}} ppm\n{% endif %}\n</p>"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":86,"top":30},"size":{"width":14,"height":7},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":86,"top":30},"size":{"width":14,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Meta":{"position":{"left":86,"top":30},"size":{"width":14,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Twig":{"position":{"left":86,"top":30},"size":{"width":14,"height":7},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":8,"vars_in":[{"rel":"value","name":"mouseTrack"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let cdb=new CDB();\nlet contentZip=await cdb.get('upload/BariatricRats.zip', {responseType:'arraybuffer'});\nlet contenXlsx=await cdb.get('upload/BariatricRats.xlsx', {responseType:'arraybuffer'});\nAPI.createData('dropped', [\n    {\n        content: contenXlsx,\n        filename: 'xlsx'\n    },\n    {\n        content: contentZip,\n        filename: 'zip'\n    }]\n);"]}],"libs":[[{"lib":"src/util/couchdbAttachments","alias":"CDB"}]],"buttons":[[{"name":"button1","label":"Load demo","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":159,"top":64},"size":{"width":15,"height":5},"zIndex":0,"display":true,"title":"Load an example","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load an example","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Load an example","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":104,"top":7},"size":{"width":70,"height":35},"zIndex":0,"display":true,"title":"Load an example","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Meta":{"position":{"left":141,"top":63},"size":{"width":15,"height":5},"zIndex":0,"display":false,"title":"Load an example","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Twig":{"position":{"left":141,"top":63},"size":{"width":15,"height":5},"zIndex":0,"display":false,"title":"Load an example","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":9,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Load an example","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":["<style>\n    #memoryInfo {\n        font-family: monospace;\n    }\n</style>\n<div id=\"memoryInfo\">\n    <b>Memory</b>: \n    Original data:\n    {{rendertype(memoryInfo.original+0.00001,{numeral:'0 b'})}}\n    - Normalized data: {{rendertype(memoryInfo.normalized,{numeral:'0 b'})}}\n    - Max allowed {{rendertype(memoryInfo.maxMemory,{numeral:'0 b'})}}\n    {% if memoryInfo.keepOriginal %}\n        &nbsp;<b style=\"color: green\">Original data present</b>\n    {% else %}\n        &nbsp;<b style=\"color: red\">Missing original data</b>\n    {% endif %}\n    \n</div>\n"],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":41,"top":0},"size":{"width":79,"height":2},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":41,"top":0},"size":{"width":79,"height":2},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Meta":{"position":{"left":41,"top":0},"size":{"width":79,"height":2},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Twig":{"position":{"left":41,"top":0},"size":{"width":79,"height":2},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":10,"vars_in":[{"rel":"value","name":"memoryInfo"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/button_action/","configuration":{"sections":{},"groups":{"group":[{"toggle":["click"],"label":[""],"onLabel":["Toggle action off"],"offLabel":["Toggle action on"],"title":["Download normalized matrix"],"css":["font-size: 11px;\nbackground-color: #E6E6E6;\nborder: 1px solid rgba(0, 0, 0, 0.2);\nheight: 30px;\npadding: .5em 1em;\nfont-weight: bold;"],"cssOn":["font-size: 11px;\nbackground-color: #E6E6E6;\nborder: 1px solid rgba(0, 0, 0, 0.2);\nheight: 30px;\npadding: .5em 1em;\nfont-weight: bold;"],"cssOff":["font-size: 11px;\nbackground-color: #E6E6E6;\nborder: 1px solid rgba(0, 0, 0, 0.2);\nheight: 30px;\npadding: .5em 1em;\nfont-weight: bold;"],"startState":["off"],"text":[""],"askConfirm":[[]],"confirmText":["Are you sure?"],"okLabel":["Ok"],"cancelLabel":["Cancel"],"contentType":["svg"],"content":["<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\t width=\"330\" height=\"330\" viewBox=\"0 0 330 330\" xml:space=\"preserve\">\n<g id=\"XMLID_24_\">\n\t<path id=\"XMLID_25_\" d=\"M154.389,265.602c0.351,0.35,0.719,0.683,1.103,0.997c0.169,0.138,0.347,0.258,0.52,0.388\n\t\tc0.218,0.164,0.432,0.333,0.659,0.484c0.212,0.142,0.432,0.265,0.649,0.395c0.202,0.121,0.4,0.248,0.608,0.359\n\t\tc0.224,0.12,0.453,0.221,0.681,0.328c0.215,0.102,0.427,0.21,0.648,0.301c0.223,0.092,0.45,0.167,0.676,0.247\n\t\tc0.235,0.085,0.468,0.175,0.709,0.248c0.226,0.068,0.456,0.119,0.685,0.176c0.246,0.062,0.489,0.131,0.739,0.181\n\t\tc0.263,0.052,0.528,0.083,0.794,0.121c0.219,0.031,0.435,0.073,0.658,0.095c0.492,0.048,0.986,0.075,1.48,0.075\n\t\tc0.494,0,0.988-0.026,1.48-0.075c0.225-0.022,0.444-0.064,0.667-0.096c0.262-0.037,0.524-0.068,0.784-0.12\n\t\tc0.255-0.05,0.503-0.121,0.754-0.184c0.223-0.057,0.448-0.105,0.669-0.172c0.246-0.075,0.483-0.167,0.724-0.253\n\t\tc0.221-0.08,0.444-0.152,0.662-0.242c0.225-0.093,0.44-0.202,0.659-0.306c0.225-0.106,0.452-0.206,0.672-0.324\n\t\tc0.21-0.112,0.408-0.239,0.611-0.361c0.217-0.13,0.437-0.252,0.648-0.394c0.222-0.148,0.431-0.314,0.643-0.473\n\t\tc0.179-0.134,0.362-0.258,0.536-0.4c0.365-0.3,0.714-0.617,1.049-0.949c0.016-0.016,0.033-0.028,0.049-0.044l70.002-69.998\n\t\tc5.858-5.858,5.858-15.355,0-21.213c-5.857-5.858-15.355-5.857-21.213-0.001l-44.396,44.393V15c0-8.284-6.716-15-15-15\n\t\tc-8.284,0-15,6.716-15,15v203.785l-44.392-44.391c-5.858-5.858-15.356-5.858-21.213,0c-5.858,5.858-5.858,15.355,0,21.213\n\t\tL154.389,265.602z\"/>\n\t<path id=\"XMLID_26_\" d=\"M315,300H15c-8.284,0-15,6.716-15,15s6.716,15,15,15h300c8.284,0,15-6.716,15-15S323.284,300,315,300z\"/>\n</g>\n</svg>\n"],"maskOpacity":[0.6]}]}},"layers":{"Default layer":{"position":{"left":134,"top":60},"size":{"width":14,"height":18},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":9,"top":40},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"LoadFiles":{"position":{"left":116,"top":46},"size":{"width":14,"height":18},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Meta":{"position":{"left":118,"top":61},"size":{"width":14,"height":18},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Twig":{"position":{"left":118,"top":61},"size":{"width":14,"height":18},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"}},"id":11,"vars_in":[],"actions_in":[{}],"actions_out":[{"event":"onClick","rel":"actionText","jpath":[],"name":"downloadPostProcessedMatrix"}],"vars_out":[],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":19},{"url":"modules/types/edition/slick_grid/","configuration":{"sections":{},"groups":{"group":[{"slickCheck":[["enableCellNavigation","rowNumbering","forceFitColumns","highlightScroll","forgetLastActive","editable","autoEdit"]],"copyPaste":[[]],"copyPasteOptions":[["newRows"]],"autoColumns":[[]],"toolbar":[[]],"colorjpath":[[]],"slick.defaultColumnWidth":[null],"slick.rowHeight":[null],"slick.headerRowHeight":[30],"slick.selectionModel":["row"],"idProperty":[""],"filterType":["pref"],"filterRow":["// Documentation: https://github.com/NPellet/visualizer/blob/46b40ca86345f8fa313563bf9c6ecb80ba323101/src/modules/types/edition/slick_grid/view.js#L1695-L1735"],"customJpaths":[""]}],"cols":[[{"name":"Key","jpath":["key"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":128,"hideColumn":[]},{"name":"ID column","jpath":["columnID"],"editor":"none","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":82,"hideColumn":[]},{"name":"Append meta","jpath":["meta"],"editor":"boolean","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":85,"hideColumn":[]},{"name":"Category","jpath":["category"],"editor":"boolean","forceType":"","formatter":"typerenderer","copyFormatter":"default","visibility":"both","rendererOptions":"","editorOptions":"","width":72,"hideColumn":[]}]],"actionCols":[[{"name":"id","tooltip":"Define column containing ID","icon":"fa-dot-circle","backgroundColor":[255,255,255,0],"color":[0,0,0,1],"action":"defineColumnID","position":"end","clickMode":"text","isAction":true}]],"groupings":[[{"getter":[]}]],"actionOutButtons":[[{}]],"data":[{"saveInView":[[]],"varname":[""],"data":["[]"]}]}},"layers":{"Default layer":{"position":{"left":125,"top":0},"size":{"width":49,"height":26},"zIndex":0,"display":true,"title":"List of available metadata","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":68,"top":7},"size":{"width":35,"height":46},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":93,"top":0},"size":{"width":41,"height":20},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Twig":{"position":{"left":110,"top":0},"size":{"width":41,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":12,"vars_in":[{"rel":"list","name":"columnNames"}],"actions_in":[{}],"actions_out":[{"jpath":[]}],"vars_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"List of available metadata","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["if (this.variable==='columnNames') {\n    this.action={\n        name:'updateMeta'\n    }\n}\n\nif (this.button) {\n    this.action={\n        name: this.button\n    }\n}\n\nconsole.log(this.action);\n\nswitch (this.action.name) {\n    case 'defineColumnID':\n        defineColumnID(this.action.value);\n        updateMeta();\n        break;\n    case 'updateMeta':\n        updateMeta();\n        break;\n}\n\nfunction defineColumnID(rowInfo) {\n    const columnNames = API.getData('columnNames');\n    columnNames.forEach( row => row.columnID=false );\n    rowInfo.columnID=true;\n    columnNames.triggerChange();\n}\n\nfunction updateMeta() {\n    const columnNames = API.getData('columnNames');\n    const xls = API.cache('xls');\n    if (! xls) return;\n    \n    let columnID = columnNames.filter( column => DataObject.resurrect(column.columnID)===true )[0].key;\n    let categories = columnNames.filter( column => DataObject.resurrect(column.category)===true ).map( column => DataObject.resurrect(column.key) );\n    let metaToAppend = columnNames.filter( column => DataObject.resurrect(column.meta)===true ).map( column => DataObject.resurrect(column.key) );\n    \n    \n    let categoriesByID = {};\n    xls.forEach( item => categoriesByID[item[columnID]]=item );\n    \n    \n    const spectraInDataset = API.getData('spectraInDataset');\n    \n    let numberNotifications=0;\n    \n\n    for (let spectrum of spectraInDataset) {\n        let metaID;\n        if (categoriesByID[spectrum.id]) {\n            metaID=spectrum.id;\n        } else if (categoriesByID[spectrum.expno]) {\n            metaID=spectrum.expno;\n        } else if (categoriesByID[spectrum.name]) {\n            metaID=spectrum.name;\n        }\n        \n        if (! metaID) {\n            numberNotifications++;\n            if (numberNotifications < 5) {\n               UI.showNotification('Meta for \"'+spectrum.id+'\" not found', 'warning'); \n            }\n            if (numberNotifications === 5) {\n                UI.showNotification('Over 5 missing meta information', 'error'); \n            }\n        } else {\n            let meta = categoriesByID[metaID];\n            let selectedMeta={};\n            metaToAppend.forEach( name => selectedMeta[name]=meta[name]);\n            console.log(selectedMeta);\n            spectrum.toc=selectedMeta;\n            // adding the category\n            spectrum.category = categories.map( name => meta[name] ).join('_');\n        }\n    }\n    \n    spectraInDataset.triggerChange();\n}\n\n\n\n"]}],"libs":[[{"lib":"src/util/ui","alias":"UI"}]],"buttons":[[{"name":"updateMeta","label":"updateMeta","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update meta information","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update meta information","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update meta information","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update meta information","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":9,"top":0},"size":{"width":81,"height":63},"zIndex":0,"display":true,"title":"Update meta information","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update meta information","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"}},"id":13,"vars_in":[{"rel":"inputValue","name":"columnNames"}],"actions_in":[{"rel":"execute","name":"updateMeta"},{"rel":"execute","name":"defineColumnID"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Update meta information","zindex":1},{"url":"modules/types/client_interaction/code_editor/","configuration":{"sections":{},"groups":{"group":[{"mode":["html"],"outputType":[null],"btnvalue":["Send script"],"iseditable":[["editable"]],"hasButton":[["button"]],"variable":[[]],"storeOnChange":[["store"]],"debouncing":[0],"script":["{%set data=hoverSelectedSpectrum %}\n\n<style>\n    #toc, #toc tbody  {\n        font-size: 12px;\n        font-family: Arial, Helvetica, sans-serif;\n    }\n    #toc, #toc td, #toc th {\n        padding-left: 5px;\n        padding-right: 5px;\n        padding-top: 5px;\n        padding-bottom: 5px;\n    }\n    #toc table {\n        border-collapse: collapse;\n    }\n    #toc > table > tbody > tr > th, #toc > table > tbody > tr > td {\n        border-top: 0.5px solid grey;\n        border-bottom: 0.5px solid grey;\n    }\n    #toc h1 {\n        font-size:20px;\n        text-align: center;\n    }\n    #toc td,  #toc th {\n        vertical-align: top;\n        text-align: left;\n    }\n</style>\n\n{% macro showProperties(object) %}\n    {% if object is iterable %}\n        <table>\n            {% for key, value in object %}\n            <tr>\n                <th>{{key}}</th>\n                <td>{{ _self.showProperties(value) }}</td>\n            </tr>\n            {% endfor %}  \n        </table>\n    {% else %}\n        {% if object is same as (false) %}\n            <span style=\"color:red\">✘</span>︎\n        {% elseif object is same as (true) %}\n             <span style=\"color:green\">✔</span>\n        {% else %}\n            {{object}}\n        {% endif %}\n    {% endif %}\n{% endmacro %}\n{% import _self as macros %}\n    \n\n<div id='toc'>\n \n    <h1>{{data.id}}</h1>\n    \n    <table>\n        {% if data.name %}\n            <tr>\n                <th>Name:</th>\n                <td>{{data.name}}</td>           \n            </tr>\n        {% endif %}\n        {% if data.expno %}\n            <tr>\n                <th>Experience number:</th>\n                <td>{{data.expno}}</td>           \n            </tr>\n        {% endif %}\n        {% if data.pulprog %}\n            <tr>\n                <th>Pulse program:</th>\n                <td>{{data.pulprog}}</td>           \n            </tr>\n        {% endif %}\n        {% if data.category %}\n            <tr>\n                <th>Category:</th>\n                <td>{{data.category}}</td>           \n            </tr>\n        {% endif %}\n        {% if data.color %}\n            <tr>\n                <th>Color:</th>\n                <td style=\"background-color: {{data.color}}\">{{data.color}}</td>           \n            </tr>\n        {% endif %}\n        {% if data.meta %}\n            <tr>\n                <th>Meta:</th>\n                <td>\n                    {{ macros.showProperties(data.meta) }}\n                </td>           \n            </tr>\n        {% endif %}\n    </table>\n</div>\n"]}],"ace":[{"useSoftTabs":[["yes"]],"tabSize":[4]}]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":22},"size":{"width":75,"height":54},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":14,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"event":"onEditorChange","rel":"data","jpath":[],"name":"twigTemplate"}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[[]],"debouncing":[0],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":82,"top":2},"size":{"width":42,"height":37},"zIndex":0,"display":true,"title":"Information about sample","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":88,"top":5},"size":{"width":61,"height":49},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":15,"vars_in":[{"rel":"value","name":"hoverSelectedSpectrum"},{"rel":"tpl","name":"twigTemplate"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Information about sample","zindex":1},{"url":"modules/types/display/template-twig/","configuration":{"sections":{},"groups":{"group":[{"selectable":[[]],"template":[""],"modifyInForm":[["yes"]],"debouncing":[500],"formOptions":[["keepFormValueIfDataUndefined"]]}]}},"layers":{"Default layer":{"position":{"left":50,"top":43},"size":{"width":69,"height":3},"zIndex":0,"display":true,"title":"Preferences","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":16,"top":57},"size":{"width":64,"height":9},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":16,"vars_in":[{"rel":"tpl","name":"displayTwigPreferences"},{"rel":"form","name":"preferences"},{"rel":"value","name":"ranges"},{"rel":"value","name":"keepOriginal"},{"rel":"value","name":"preferences"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"event":"onFormChanged","rel":"form","jpath":[],"name":"changedPreferences"},{"event":"onFormSubmitted","rel":"form","jpath":[],"name":"UpdateChart"}],"toolbar":{"custom":[[{"title":"Reload preferences","icon":"fa-tasks","action":"selectResultTemplate","position":"begin","color":[100,100,100,1]},{"title":"Save preferences as template","icon":"fa-save","action":"saveResultTemplate","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[[]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Preferences","zindex":22},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["const twigPreferences=`\n\n${Prefs.style}\n\n<div id='extendedForm'>\n    <form>\n    \n    ${Prefs.dataNormalization}\n\n    <h1>Export</h1>\n    <p>\n    Format: \n        <select name='export.format'>\n            <option value=\"tsv\">tsv</option>\n            <option value=\"csv\">csv</option>\n        </select>\n    </p>\n<!--\n    <center>\n         Auto-refresh <input type=\"checkbox\" name=\"display.autorefresh\" checked> \n        or <input type=\"submit\" value=\"Update data and chart\">\n    </center>\n-->\n    </form>\n</div>\n\n\n<script>\n    require(['vh/util/twigAdvancedForm'], function(AF) {\n        AF('extendedForm', {debug:false});\n    });\n</script>\n`;\n\n\nAPI.createData('twigPreferences', twigPreferences);\n\nAPI.createData('displayTwigPreferences', Prefs.displayTwigPreferences);\n\n\n"]}],"libs":[[{"lib":"vh/eln/sample/ml/viewsPreferences","alias":"Prefs"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":12,"top":0},"size":{"width":77,"height":53},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":17,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const spectraInDatasetModifications = await API.require('vh/eln/sample/ml/spectraInDatasetModifications');\n\nspectraInDatasetModifications();\n\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":32,"top":33},"size":{"width":43,"height":40},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":60,"top":0},"size":{"width":77,"height":16},"zIndex":0,"display":true,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Monitor modifications of spectraInDataset","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":18,"vars_in":[{"rel":"inputValue","name":"spectraInDataset"}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Monitor modifications of spectraInDataset","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[["yes"]],"asyncAwait":[["top"]],"script":["\nconsole.log('Load and process', this.action, this.variable);\n\nconst recreateCharts = await API.require('vh/eln/sample/ml/recreateCharts');\n\nawait recreateCharts(this.variable);\n\nAPI.doAction('changedSelectedSpectra');"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Update data and charts","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":111,"top":27},"size":{"width":24,"height":5},"zIndex":0,"display":false,"title":"Recreate the data and charts based on the preferences","bgColor":[255,255,255,0],"wrapper":false,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":60,"top":17},"size":{"width":77,"height":19},"zIndex":0,"display":true,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Update chart","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":19,"vars_in":[{"rel":"inputValue","name":"preferences"}],"actions_in":[{"rel":"execute","name":"UpdateChart"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Update chart","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const spectraDataSet=API.cache('spectraDataSet');\n\nconsole.log(this.action.name);\n\nswitch (this.action.name) {\n    default:\n        await spectraDataSet.processAction(this.action);\n}\n\nif (['addDirectSpectra','addDirectSpectrum'].includes(this.action.name)) {\n    API.doAction('updateMeta', '');\n    console.log('UPDATE META')\n}\n"]}],"libs":[[{"lib":"src/util/color","alias":"Color"},{"lib":"vh/eln/libs","alias":"libs"}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":32,"top":0},"size":{"width":84,"height":32},"zIndex":0,"display":false,"title":"Process all the actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Process all the actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":60,"top":37},"size":{"width":77,"height":31},"zIndex":0,"display":true,"title":"Process all the actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Process all the actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Process all the actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Process all the actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":20,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"clickedSample"},{"rel":"execute","name":"addDirectSpectra"},{"rel":"execute","name":"addDirectSpectrum"},{"rel":"execute","name":"refresh"},{"rel":"execute","name":"clearSelectedSamples"},{"rel":"execute","name":"hideSpectra"},{"rel":"execute","name":"hideAllSpectra"},{"rel":"execute","name":"addSpectraToSelection"},{"rel":"execute","name":"selectAllSpectra"},{"rel":"execute","name":"selectCurrentSpectraSelection"},{"rel":"execute","name":"forceRecolor"},{"rel":"execute","name":"selectCategory"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Process all the actions","zindex":1},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let value=this.action.value;\n\nswitch (this.action.name) {\n    case 'trackClicked': {\n        if (value.event.altKey && value.event.shiftKey) {\n\n            let key=Object.keys(value.data)[0];\n            let preferences=API.getData('preferences');\n            preferences.display.correlationIndex=value.data[key].indexClosest;\n            preferences.display.correlationX=value.data[key].xExact;\n            if (! String(preferences.display.correlation)) {\n                preferences.display.correlation=\"selected\";\n                preferences.display.selection=\"none\";\n            }\n            preferences.triggerChange();\n        }\n        break;\n    }\n    case 'trackMove': {\n        let displayPreferences = API.getData('preferences').display.resurrect();\n        const trackMove = this.action.value.data.chart;\n        if (! trackMove || ! displayPreferences.trackingInfo || displayPreferences.original==='true') {\n            API.createData('trackAnnotations', []);\n            return;\n        }\n        const spectraProcessor=API.cache('spectraProcessor');\n        const annotations=spectraProcessor.getTrackAnnotation(trackMove.indexBefore)\n        API.createData('trackAnnotations', annotations)\n        break;\n    }\n    case 'downloadNormalizedMatrix': {\n        let spectraProcessor = API.cache('spectraProcessor');\n        let preferences = API.getData('preferences').resurrect();\n        \n        let text = spectraProcessor.getNormalizedText({\n            fs: preferences.export.format === 'tsv' ? '\\t' : ','\n        });\n        \n        let mimetype =  preferences.export.format === 'tsv' ? \n            'text/tab-separated-values' : 'text/csv'\n        \n        const fileSaver=await API.require('file-saver');\n        let blob = new Blob([text], {type: mimetype+\";charset=utf-8\"});\n        fileSaver( blob, \"data.\"+preferences.export.format);    \n        break;\n    }\n    case 'downloadPostProcessedMatrix': {\n        const spectraProcessor = API.cache('spectraProcessor');\n        let postProcessingOptions=JSON.parse(JSON.stringify(API.getData('preferences').postProcessing));\n       // postProcessingOptions.scale.range = API.getData('ranges').resurrect().filter( (range) => range.label === postProcessingOptions.scale.range)[0];\n        let tsv=spectraProcessor.getPostProcessedText({postProcessing: postProcessingOptions});\n        let fileSaver=await API.require('file-saver');\n        var blob = new Blob([tsv], {type: \"text/tab-separated-values;charset=utf-8\"});\n        fileSaver( blob, \"data.tsv\");\n        break;\n    }\n    default:\n    \n}\n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Tracking and exportation actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Tracking and exportation actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":0,"top":30},"size":{"width":59,"height":38},"zIndex":0,"display":true,"title":"Tracking and exportation actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Tracking and exportation actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Tracking and exportation actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Tracking and exportation actions","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":21,"vars_in":[{}],"actions_in":[{"rel":"execute","name":"downloadNormalizedMatrix"},{"rel":"execute","name":"downloadPostProcessedMatrix"},{"rel":"execute","name":"trackMove"},{"rel":"execute","name":"trackClicked"}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Tracking and exportation actions","zindex":2},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["const spectraDataSet=API.cache('spectraDataSet');\nlet spectraProcessor = API.cache('spectraProcessor');\ndebugger;"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":71,"top":74},"size":{"width":44,"height":15},"zIndex":0,"display":true,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":22,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":""},{"url":"modules/types/client_interaction/code_executor/","configuration":{"sections":{},"groups":{"group":[{"display":[["editor","buttons"]],"execOnLoad":[[]],"asyncAwait":[["top"]],"script":["let spectraProcessor = API.cache('spectraProcessor');\nlet preferences = API.getData('preferences').resurrect();\n\nlet data = spectraProcessor.getNormalizedData();\n\nconst nmrium={\n    spectra: [],\n}\n\nfor (let i=0; i<data.ids.length; i++) {\n    console.log(data);\n    nmrium.spectra.push({\n        id: data.ids[i],\n        display: {\n            color: data.meta[i].color,\n        },\n        source: {\n                jcampURL: null,\n        },\n        data: {\n            x: data.x,\n            re: data.matrix[i],\n        },\n        info: {\n            nucleus: '1H',\n            isFid: false,\n            isComplex: false,\n            dimension: 1,\n            isFt: true,\n            title: data.ids[i],\n            solvent: \"water\",\n            experiment: \"1d\",\n        },\n        meta: data.meta[i],\n    })\n}\n\nconst fileSaver=await API.require('file-saver');\nlet blob = new Blob([JSON.stringify(nmrium)], {type: \"application/json;charset=utf-8\"});\nfileSaver( blob, \"data.nmrium\");    \n"]}],"libs":[[{}]],"buttons":[[{"name":"button1","label":"Execute","hide":[],"disable":[]}]]}},"layers":{"Default layer":{"position":{"left":175,"top":5},"size":{"width":51,"height":62},"zIndex":0,"display":false,"title":"Download NMRium file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Default layer"},"Preferences":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Download NMRium file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Preferences"},"ManageSpectra":{"position":{"left":173,"top":13},"size":{"width":48,"height":51},"zIndex":0,"display":true,"title":"Download NMRium file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"ManageSpectra"},"LoadFiles":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Download NMRium file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"LoadFiles"},"Meta":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Download NMRium file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Meta"},"Twig":{"position":{"left":0,"top":0},"size":{"width":20,"height":20},"zIndex":0,"display":false,"title":"Download NMRium file","bgColor":[255,255,255,0],"wrapper":true,"created":true,"name":"Twig"}},"id":23,"vars_in":[{}],"actions_in":[{}],"vars_out":[{"jpath":[]}],"actions_out":[{"jpath":[]}],"toolbar":{"custom":[[{"title":"","icon":"","action":"","position":"begin","color":[100,100,100,1]}]],"common":[{"toolbar":[["Open Preferences"]]}]},"css":[{"fontSize":[""],"fontFamily":[""]}],"title":"Download NMRium file"}],"variables":[{"jpath":[""]}],"aliases":[{"path":"../../lib/brukerconverter/1.1.2/brukerconverter","alias":"BrukerConverter"},{"path":"../../github/cheminfo-js/visualizer-helper/4521d084f993f0d8271d16002365a04532a50849","alias":"vh"},{"path":"http://localhost:9898/cheminfo-js/visualizer-helper/","alias":"vhxx"},{"path":"../../lib/ml/3.6.0/ml.min","alias":"ML"},{"path":"../../lib/xslx/0.15.1/xlsx.full.min","alias":"xlsx"},{"path":"../../lib/jcampconverter/7.6.3/jcampconverter","alias":"JcampConverter"},{"path":"../../lib/spectra-processor/2.5.0/spectra-processor","alias":"SpectraProcessor"},{"path":"http://localhost:9898/cheminfo/spectra-processor/dist/spectra-processor","alias":"SpectraProcessorxx"}],"configuration":{"title":"Create matrix from bruker files"},"actionscripts":[{"sections":{},"groups":{"action":[{"name":[null],"script":[null]}]}}],"init_script":[{"sections":{},"groups":{"general":[{"script":["const [\n    Track,\n    libs,\n    SpectraProcessor,\n    SpectraDataSet,\n] = await API.require(\n    [\n        'vh/util/track',\n        'vh/eln/libs',\n        'SpectraProcessor',\n        'vh/eln/sample/ml/SpectraDataSet',\n    ]\n);\n\n\nconst spectraDataSet = new SpectraDataSet(undefined, undefined, {\n    defaultAttributes: {\n        pcaModel: false\n    }\n});\nspectraDataSet.initializeAnalysis();\nAPI.cache('spectraDataSet', spectraDataSet);\n\nAPI.cache('spectraProcessor', new SpectraProcessor.SpectraProcessor({}));\n\nconst defaultPreferences = {\n    data: {keep: true},\n    display: {\n        selection: 'selected',\n        original: false,\n        trackingInfo: false,\n        correlation: '',\n        correlationIndex: false,\n        boxplot: false,\n        boxplotOptions: {\n            q13FillColor : '#000',\n            q13FillOpacity : 0.3,\n            q2StrokeColor : '#000',\n            q2StrokeWidth : 3,\n            minMaxFillColor : '#000',\n            minMaxFillOpacity : 0.15\n        },\n        autorefresh: true\n    },\n    normalization: {numberOfPoints: 1024},\n    postProcessing: {\n        filters: [],\n        scale: {\n            method: \"\",\n            targetID: \"\",\n            range: \"Full spectrum\",\n            relative: false,\n        },\n    },\n    export: {format: 'tsv'},\n};\n\n// Track('matrixGenerationPreferences', defaultPreferences, {varName:'preferences'});\nAPI.createData('preferences', defaultPreferences);\n\nAPI.createData('spectraInDataset', []);\n\nAPI.createData('spectra', []);\n\nAPI.require('vh/util/tips').then( Tips => {\n    Tips.showTips();\n    Tips.addPageHelp({iconSize:'fa-4x'});\n});\n\n"]}]}}],"custom_filters":[{"sections":{"modules":[{"sections":{},"groups":{"modules":[[{}]]}}],"filtersLib":[{"sections":{},"groups":{"filters":[[{}]]}}],"filters":[{"sections":{},"groups":{"filter":[{"name":[null],"script":[null]}],"libs":[[{}]]}}]},"groups":{}}],"actionfiles":[{"sections":{},"groups":{"action":[[{}]]}}]}